import{logger_default as e}from"./logger-BlLSmUdl.js";import{cache_default as t}from"./cache-CvppK6AM.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import{getCookies as r,setCookies as i}from"./puppeteer-utils-DKJNO2_A.js";import{load as a}from"cheerio";let o;const s=`https://www.cw.com.tw`,c={today:{pageUrl:()=>`/today`,limit:30},master:{pageUrl:e=>`/masterChannel.action?idMasterChannel=${e}`,limit:12},sub:{pageUrl:e=>`/subchannel.action?idSubChannel=${e}`,limit:12},author:{pageUrl:e=>`/author/${e}`,limit:10}},l=async(t,n)=>(o||=await n(`cw:cookie`,async()=>{let n=await t.newPage();return await n.setRequestInterception(!0),n.on(`request`,e=>{e.resourceType()===`document`||e.resourceType()===`script`?e.continue():e.abort()}),e.http(`Requesting ${s}/user/get/cookie-bar`),await n.goto(`${s}/user/get/cookie-bar`,{waitUntil:`domcontentloaded`}),o=await r(n),await n.close(),o}),o),u=async(n,r,o)=>{let u=`${s}${c[n].pageUrl(o.req.param(`channel`))}`,p=await l(r,t.tryGet),m=await r.newPage();await m.setRequestInterception(!0),m.on(`request`,e=>{e.resourceType()===`document`||e.resourceType()===`script`?e.continue():e.abort()}),await i(m,p,`cw.com.tw`),e.http(`Requesting ${u}`),await m.goto(u,{waitUntil:`domcontentloaded`}),await m.waitForSelector(`.caption`);let h=await m.evaluate(()=>document.documentElement.innerHTML);await m.close();let g=a(h),_=d(g,o.req.query(`limit`)?Number(o.req.query(`limit`)):c[n].limit),v=await f(_,r,t.tryGet);return{$:g,items:v}},d=(e,t)=>e(`.caption`).toArray().map(t=>(t=e(t),{title:t.find(`h3`).text(),link:t.find(`h3 a`).attr(`href`),pubDate:n(t.find(`time`).text())})).slice(0,t),f=(t,r,s)=>Promise.all(t.map(t=>s(t.link,async()=>{let s=await r.newPage();await s.setRequestInterception(!0),s.on(`request`,e=>{e.resourceType()===`document`||e.resourceType()===`script`?e.continue():e.abort()}),await i(s,o,`cw.com.tw`),e.http(`Requesting ${t.link}`),await s.goto(t.link,{waitUntil:`domcontentloaded`}),await s.waitForSelector(`.article__head .container`);let c=await s.evaluate(()=>document.documentElement.innerHTML);await s.close();let l=a(c),u=JSON.parse(l(`head script[type="application/ld+json"]`).eq(0).text());return l(`.article__head .breadcrumb, .article__head h1, .article__provideViews, .ad`).remove(),l(`img.lazyload`).each((e,t)=>{t.attribs[`data-src`]&&(t.attribs.src=t.attribs[`data-src`],delete t.attribs[`data-src`])}),t.title=l(`head title`).text(),t.category=l(`meta[name=keywords]`).attr(`content`).split(`,`),t.pubDate=n(u.datePublished),t.author=u.author.name.replace(`,`,` `)||u.publisher.name,t.description=l(`.article__head .container`).html()+l(`.article__content`).html(),t})));export{s as baseUrl$12,u as parsePage};