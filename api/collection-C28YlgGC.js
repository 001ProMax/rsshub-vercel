import"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CWQqZcqz.js";import"./helpers-RrXnNmv1.js";import{cache_default as e}from"./cache-CvppK6AM.js";import{parseDate as t}from"./parse-date-DHsdom8D.js";import"./md5-BJqXla8f.js";import{got_default as n}from"./got-BwctkUCD.js";import{header as r}from"./utils-WD29XLhf.js";import{generateData as i}from"./utils-DOhxgpCZ.js";import{load as a}from"cheerio";const o={path:`/collection/:id/:getAll?`,categories:[`social-media`],example:`/zhihu/collection/26444956`,parameters:{id:`收藏夹 id，可在收藏夹页面 URL 中找到`,getAll:`获取全部收藏内容，任意值为打开`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`www.zhihu.com/collection/:id`],target:`/collection/:id`}],name:`收藏夹`,maintainers:[`huruji`,`Colin-XKL`,`Fatpandac`],handler:s};async function s(o){let s=o.req.param(`id`),c=o.req.param(`getAll`),l=await n({method:`get`,url:`https://www.zhihu.com/api/v4/collections/${s}/items?offset=0&limit=20`,headers:{...r,Referer:`https://www.zhihu.com/collection/${s}`}}),u=l.data.data;if(c){let t=l.data.paging.totals,i=[...Array.from({length:Math.round(t/20)}).keys()].map(e=>e*20).slice(1),a=await Promise.all(i.map(t=>e.tryGet(`https://www.zhihu.com/api/v4/collections/${s}/items?offset=${t}&limit=20`,async()=>{let e=await n({method:`get`,url:`https://www.zhihu.com/api/v4/collections/${s}/items?offset=${t}&limit=20`,headers:{...r,Referer:`https://www.zhihu.com/collection/${s}`}});return e.data.data}))).then(e=>e.flat());u.push(...a)}let d=await n({method:`get`,url:`https://www.zhihu.com/collection/${s}`,headers:{...r,Referer:`https://www.zhihu.com/collection/${s}`}}),f=d.data,p=a(f),m=p(`.CollectionDetailPageHeader-title`).text()+` - 知乎收藏夹`,h=p(`.CollectionDetailPageHeader-description`).text(),g=e=>i([e.content])[0];return{title:m,link:`https://www.zhihu.com/collection/${s}`,description:h,item:u&&u.map(e=>e.content.type===`pin`?g(e):{title:e.content.type===`article`||e.content.type===`zvideo`?e.content.title:e.content.question.title,link:e.content.url,description:e.content.type===`zvideo`?`<img src=${e.content.video.url}/>`:e.content.content,pubDate:t((e.content.type===`article`?e.content.updated:e.content.updated_time)*1e3)})}}export{o as route};