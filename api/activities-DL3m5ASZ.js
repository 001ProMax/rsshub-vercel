import"./esm-shims-CtP6w_ML.js";import{config as e}from"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import{ofetch_default as t}from"./ofetch-CDAeBYLA.js";import"./helpers-RrXnNmv1.js";import{cache_default as n}from"./cache-7MGQxbL-.js";import{parseDate as r}from"./parse-date-B2cCVoGk.js";import{md5 as i}from"./md5-BdV0DUA8.js";import{got_default as a}from"./got-Cw4D6IS5.js";import{ViewType as o}from"./types-DygLf1a3.js";import{load as s}from"cheerio";import c from"sanitize-html";function l(e,t,n){t[n]=255&e>>>24,t[n+1]=255&e>>>16,t[n+2]=255&e>>>8,t[n+3]=255&e}function u(e,t){return(255&e[t])<<24|(255&e[t+1])<<16|(255&e[t+2])<<8|255&e[t+3]}function d(e,t){return(4294967295&e)<<t|e>>>32-t}function f(e){let t=Array.from({length:4}),n=Array.from({length:4});l(e,t,0),n[0]=m.zb[255&t[0]],n[1]=m.zb[255&t[1]],n[2]=m.zb[255&t[2]],n[3]=m.zb[255&t[3]];let r=u(n,0);return r^d(r,2)^d(r,10)^d(r,18)^d(r,24)}const p={x(e,t){let n=[];for(let r=e.length,i=0;0<r;r-=16){let r=Array.from({length:16});for(let n=e.slice(16*i,16*(i+1)),a=0;a<16;a++)r[a]=n[a]^t[a];t=p.r(r),n=n.concat(t),i++}return n},r(e){let t=Array.from({length:16}),n=Array.from({length:36});n[0]=u(e,0),n[1]=u(e,4),n[2]=u(e,8),n[3]=u(e,12);for(let e=0;e<32;e++){let t=f(n[e+1]^n[e+2]^n[e+3]^m.zk[e]);n[e+4]=n[e]^t}return l(n[35],t,0),l(n[34],t,4),l(n[33],t,8),l(n[32],t,12),t}},m={zk:[1170614578,1024848638,1413669199,-343334464,-766094290,-1373058082,-143119608,-297228157,1933479194,-971186181,-406453910,460404854,-547427574,-1891326262,-1679095901,2119585428,-2029270069,2035090028,-1521520070,-5587175,-77751101,-2094365853,-1243052806,1579901135,1321810770,456816404,-1391643889,-229302305,330002838,-788960546,363569021,-1947871109],zb:[20,223,245,7,248,2,194,209,87,6,227,253,240,128,222,91,237,9,125,157,230,93,252,205,90,79,144,199,159,197,186,167,39,37,156,198,38,42,43,168,217,153,15,103,80,189,71,191,97,84,247,95,36,69,14,35,12,171,28,114,178,148,86,182,32,83,158,109,22,255,94,238,151,85,77,124,254,18,4,26,123,176,232,193,131,172,143,142,150,30,10,146,162,62,224,218,196,229,1,192,213,27,110,56,231,180,138,107,242,187,54,120,19,44,117,228,215,203,53,239,251,127,81,11,133,96,204,132,41,115,73,55,249,147,102,48,122,145,106,118,74,190,29,16,174,5,177,129,63,113,99,31,161,76,246,34,211,13,60,68,207,160,65,111,82,165,67,169,225,57,112,244,155,51,236,200,233,58,61,47,100,137,185,64,17,70,234,163,219,108,170,166,59,149,52,105,24,212,78,173,45,0,116,226,119,136,206,135,175,195,25,92,121,208,126,139,3,75,141,21,130,98,241,40,154,66,184,49,181,46,243,88,101,183,8,23,72,188,104,179,210,134,250,201,164,89,216,202,220,50,221,152,140,33,235,214]},h=e=>{let t=`6fpLRqJO8M/c3jnYxFkUVC4ZIG12SiH=5v0mXDazWBTsuw7QetbKdoPyAl+hN9rgE`,n=``;for(let r of[0,6,12,18]){let i=e>>>r,a=i&63,o=t.charAt(a);n+=o}return n},g=e=>{let t=[];for(let n=0;n<e.length;n++)t.push(e.charCodeAt(n));t.unshift(0),t.unshift(Math.random()*127);for(let e=0;e<15;e++)t.push(14);let n=t.slice(0,16),r=[48,53,57,48,53,51,102,55,100,49,53,101,48,49,100,55],i=[];for(let[e,t]of n.entries())i.push(t^r[e]^42);let a=p.r(i),o=t.slice(16,48),s=p.x(o,a);return a.concat(s)},_=e=>{let t=g(e),n=0,r=``;for(let e=0;e<t.length;e++){let i=t[t.length-e-1],a=e%4,o=e%3,s=8*a,c=58>>>s,l=c&255,u=i^l,d=u<<8*o;n|=d,o===2&&(r+=h(n),n=0)}return r};var v=_;const y={"x-api-version":`3.0.91`},b=e=>e.split(`?`)[0].replace(`_b.jpg`,`.jpg`).replace(`_r.jpg`,`.jpg`).replace(`_720w.jpg`,`.jpg`),x=e=>{let t=s(e,null,!1);return t(`noscript, a[data-draft-type="mcn-link-card"]`).remove(),t(`a`).each((e,n)=>{let r=t(n).attr(`href`);if(r?.startsWith(`http://link.zhihu.com/?target=`)||r?.startsWith(`https://link.zhihu.com/?target=`)){let e=new URL(r),i=e.searchParams.get(`target`)||``;try{t(n).attr(`href`,decodeURIComponent(i))}catch{}}}),t(`img.content_image, img.origin_image, img.content-image, img.data-actualsrc, figure>img`).each((e,n)=>{n.attribs[`data-actualsrc`]?(t(n).attr({src:b(n.attribs[`data-actualsrc`]),width:null,height:null}),t(n).removeAttr(`data-actualsrc`)):n.attribs[`data-original`]?(t(n).attr({src:b(n.attribs[`data-original`]),width:null,height:null}),t(n).removeAttr(`data-original`)):t(n).attr({src:b(n.attribs.src),width:null,height:null})}),t.html()},S=t=>e.zhihu.cookies?.split(`;`).map(e=>e.trim()).find(e=>e.startsWith(t+`=`))?.slice(t.length+1)||``,C=async(e,r)=>{let{dc0:a,zseCk:o}=await n.tryGet(`zhihu:cookies:d_c0`,async()=>{if(S(`d_c0`)&&S(`__zse_ck`))return{dc0:S(`d_c0`),zseCk:S(`__zse_ck`)};let n=await t.raw(`https://static.zhihu.com/zse-ck/v3.js`),r=await n._data.text(),i=r.match(/__g\.ck\|\|"([\w+/=\\]*?)",_=/)?.[1],a=i?await t.raw(e,{headers:{cookie:`${n.headers.getSetCookie().map(e=>e.split(`;`)[0]).join(`; `)}; __zse_ck=${i}`}}):null,o=(a||n).headers.getSetCookie().find(e=>e.startsWith(`d_c0=`))?.split(`;`)[0].trim().slice(5)||``;return{dc0:o,zseCk:i}}),s=`101_3_3.0`,c=`${s}+${r}+${a}`,l=`2.0_`+v(i(c)),u=S(`z_c0`);return{cookie:`__zse_ck=${o}; d_c0=${a}${u?`;z_c0=${u}`:``}`,"x-zse-96":l,"x-app-za":`OS=Web`,"x-zse-93":s}},w={path:`/people/activities/:id`,categories:[`social-media`,`popular`],view:o.Articles,example:`/zhihu/people/activities/diygod`,parameters:{id:`作者 id，可在用户主页 URL 中找到`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`www.zhihu.com/people/:id`]}],name:`用户动态`,maintainers:[`DIYgod`],handler:T};async function T(e){let t=e.req.param(`id`),n=`/api/v3/moments/${t}/activities?limit=7&desktop=true`,i=await C(`https://www.zhihu.com/people/${t}`,n),o=await a(`https://www.zhihu.com${n}`,{headers:{...y,...i,Referer:`https://www.zhihu.com/people/${t}/activities`}}),s=o.data.data;return{title:`${s[0].actor.name}的知乎动态`,link:`https://www.zhihu.com/people/${t}/activities`,image:s[0].actor.avatar_url,description:s[0].actor.headline||s[0].actor.description,item:s.map(e=>{let t=e.target,n,i,a,o=[],l=``,u=``,d=``;switch(e.target.type){case`answer`:n=t.question.title,d=t.author.name,i=x(t.content),a=`https://www.zhihu.com/question/${t.question.id}/answer/${t.id}`;break;case`article`:n=t.title,d=t.author.name,i=x(t.content),a=`https://zhuanlan.zhihu.com/p/${t.id}`;break;case`pin`:n=c(t.excerpt_title),d=t.author.name;for(let e of t.content)switch(e.type){case`text`:l=`<p>${e.own_text}</p>`;break;case`image`:o.push(`<p><img src="${e.url.replace(`xl`,`r`)}"/></p>`);break;case`link`:u=`<p><a href="${e.url}" target="_blank">${e.title}</a></p>`;break;case`video`:u=`<p><video
                                controls="controls"
                                width="${e.playlist[1].width}"
                                height="${e.playlist[1].height}"
                                src="${e.playlist[1].url}"></video></p>`;break;default:throw Error(`Unknown type: ${e.type}`)}i=`${l}${u}${o.join(``)}`,a=`https://www.zhihu.com/pin/${t.id}`;break;case`question`:n=t.title,d=t.author.name,i=x(t.detail),a=`https://www.zhihu.com/question/${t.id}`;break;case`collection`:n=t.title,a=`https://www.zhihu.com/collection/${t.id}`;break;case`column`:n=t.title,i=`<p>${t.intro}</p><p><img src="${t.image_url}"/></p>`,a=`https://zhuanlan.zhihu.com/${t.id}`;break;case`topic`:n=t.name,i=`<p>${t.introduction}</p><p>话题关注者人数：${t.followers_count}</p>`,a=`https://www.zhihu.com/topic/${t.id}`;break;case`live`:n=t.subject,i=t.description.replaceAll(/\n|\r/g,`<br>`),a=`https://www.zhihu.com/lives/${t.id}`;break;case`roundtable`:n=t.name,i=t.description,a=`https://www.zhihu.com/roundtable/${t.id}`;break;default:i=`未知类型 ${e.target.type}，请点击<a href="https://github.com/DIYgod/RSSHub/issues">链接</a>提交issue`}return{title:`${s[0].actor.name}${e.action_text}: ${n}`,author:d,description:i,pubDate:r(e.created_time*1e3),link:a}})}}export{w as route};