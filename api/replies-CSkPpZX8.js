import"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CWQqZcqz.js";import"./helpers-RrXnNmv1.js";import{cache_default as e}from"./cache-CvppK6AM.js";import{got_default as t}from"./got-BwctkUCD.js";import{load as n}from"cheerio";const r={path:`/replies/:uid`,categories:[`social-media`],example:`/douban/replies/xiaoyaxiaoya`,parameters:{uid:`用户id，可在用户日记页 URL 中找到`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`日记最新回应`,maintainers:[`nczitzk`],handler:i};async function i(r){let i=`https://www.douban.com/people/${r.req.param(`uid`)}/notes`,a=await t({method:`get`,url:i}),o=n(a.data),s=o(`div.recent-replies-mod ul.comment-list li`).map((e,t)=>{t=o(t);let n=t.find(`p`),r=n.find(`a`).attr(`href`).match(/%2Fnote%2F(.*?)%2F%23(.*?)&type=note/),i=r[1],a=r[2];return n.remove(),{link:`https://www.douban.com/note/${i}/#${a}`}}).get(),c=await Promise.all(s.map(n=>e.tryGet(n.link,async()=>{let e=await t({method:`get`,url:n.link}),r=JSON.parse(e.data.match(/'comments':(.*)}],/)[1]+`}]`);for(let e of r)if(e.id===n.link.split(`#`)[1])return{link:n.link,title:`${e.author.name} 于 ${e.create_time} 的回应`,pubDate:new Date(e.create_time+` GMT+8`).toUTCString(),description:e.text,author:e.author.name};else e.replies.length>0&&r.push(...e.replies)})));return{title:o(`title`).text()+` - 最新回应`,link:i,item:c}}export{r as route};