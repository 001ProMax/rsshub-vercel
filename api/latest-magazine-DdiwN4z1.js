import{__dirname as e,init_esm_shims as t}from"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CWQqZcqz.js";import"./helpers-RrXnNmv1.js";import{art as n}from"./render-DE4LRFBD.js";import{got_default as r}from"./got-BwctkUCD.js";import i from"node:path";import{load as a}from"cheerio";t();const o=`https://magazinelib.com`,s={path:`/latest-magazine/:query?`,categories:[`reading`],example:`/magazinelib/latest-magazine/new+yorker`,parameters:{query:`query, search page querystring`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`Latest Magazine`,maintainers:[`EthanWng97`],handler:c,description:"For instance, when doing search at [https://magazinelib.com](https://magazinelib.com) and you get url `https://magazinelib.com/?s=new+yorker`, the query is `new+yorker`"};async function c(t){let s=t.req.param(`query`),c=`${o}/wp-json/wp/v2/posts/`,l=await r({method:`get`,url:c,searchParams:{search:s,per_page:30,_embed:1}}),u=s;u===void 0?u=``:(u=u.replaceAll(/[^\dA-Za-z]+/g,` `).toUpperCase(),u=` - ${u}`);let d=l.data.map(t=>{let r={};r.date=t.date_gmt,r.link=t.link,r.featuredMediaLink=t._links[`wp:featuredmedia`][0].href,r.title=t.title.rendered;let o=a(t.content.rendered),s=o(`.vk-att`);s.find(`img[src="https://magazinelib.com/wp-includes/images/media/default.png"]`).remove(),r.content=s.html();let c=t._embedded[`wp:featuredmedia`][0].source_url;return r.description=r.content+n(i.join(e,`templates/magazine-description-5b741265.art`),{imgUrl:c}),r.categories=t._embedded[`wp:term`][0].map(e=>e.name),r});return{title:`MagazineLib - Latest Magazines${u}`,link:`{host}/?s=${s}`,description:`MagazineLib - Latest Magazines${u}`,item:d.map(e=>({title:e.title,link:e.link,category:e.categories,pubDate:new Date(e.pubDate).toUTCString(),description:e.description}))}}export{s as route};