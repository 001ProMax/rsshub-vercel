import"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CWQqZcqz.js";import"./helpers-RrXnNmv1.js";import{cache_default as e}from"./cache-CvppK6AM.js";import{parseDate as t}from"./parse-date-DHsdom8D.js";import{got_default as n}from"./got-BwctkUCD.js";import{timezone as r}from"./timezone-CCdTtC9I.js";import{load as i}from"cheerio";const a={path:`/rail/:category?/:topic?`,categories:[`new-media`],example:`/ally/rail/hyzix/chengguijiaotong/`,parameters:{category:`分类，可在 URL 中找到；略去则抓取首页`,topic:`话题，可在 URL 中找到；并非所有页面均有此字段`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`rail.ally.net.cn/`,`rail.ally.net.cn/html/:category?/:topic?`]}],name:`世界轨道交通资讯网`,maintainers:[`Rongronggg9`],handler:o,url:`rail.ally.net.cn/`,description:`::: tip
  默认抓取前 20 条，可通过 \`?limit=\` 改变。
:::`};async function o(a){let{category:o,topic:s}=a.req.param(),c=`http://rail.ally.net.cn`,l=o?s?`${c}/html/${o}/${s}/`:`${c}/html/${o}/`:c,u=await n.get(l),d=i(u.data),f=d(`.container .regsiter a`).get().slice(1).reduce((e,t)=>e?`${e} - ${d(t).text()}`:d(t).text(),``);f=f||(o&&s?`${o} - ${s}`:o)||`首页`;let p=[d(`.left .hynewsO h2 a`).get(),d(`.left .list_content_c`).find(`.new_hy_focus_con_tit a, .new_hy_list_name a`).get(),d(`.left`).find(`.nnewslistpic a, .nnewslistinfo dd a`).get(),d(`.left .list_con .datacountTit a`).get(),d(`.container_left`).find(`dd a, h1 a, ul.slideshow li a`).get()].flat();p.length||(p=d(`.left a, .container_left a`).get());let m=p.map(e=>{e=d(e);let n=e.attr(`href`),i=n&&n.match(/\/html\/(\d{4})\/\w+_(\d{4})\/\d+\.html/);if(!i)return null;let a=e.text();return{title:a,link:n.startsWith(`/`)?`${c}${n}`:n,pubDate:r(t(`${i[1]}${i[2]}`),8)}}).filter(Boolean).reduce((e,t)=>e.length&&e.at(-1).link===t.link?e:[...e,t],[]).sort((e,t)=>t.pubDate-e.pubDate).slice(0,a.req.query(`limit`)||20);return m=await Promise.all(m.map(t=>e.tryGet(t.link,async()=>{let e=await n(t.link),r=i(e.data),a=``,o=r(`div.content_all`);o.length?o.eq(o.length-1).contents().each((e,t)=>{let n=r(t),i;t.name===`div`?(i=n.html(),i&&=i.trim(),a+=!i||i===`&nbsp;`?a?`<br>`:``:i):a+=n.toString().trim()}):a=r(`div.content div`).first().html(),a=a.replace(/\s*<br ?\/?>\s*$/,``);let s=r(`.content > em span`);return{title:r(`.content > h2`).text()||t.title,description:a,pubDate:t.pubDate,author:s.eq(1).text().replace(/^来源：/,``),link:t.link}}))),{title:`世界轨道交通资讯网 - ${f}`,link:l,item:m,description:d(`head > meta[name="description"]`).attr(`content`)}}export{a as route};