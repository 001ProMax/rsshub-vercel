import{__dirname as e,init_esm_shims as t}from"./esm-shims-CtP6w_ML.js";import{config as n}from"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CWQqZcqz.js";import"./helpers-RrXnNmv1.js";import{cache_default as r}from"./cache-CvppK6AM.js";import{art as i}from"./render-DE4LRFBD.js";import{parseDate as a}from"./parse-date-DHsdom8D.js";import{got_default as o}from"./got-BwctkUCD.js";import{invalid_parameter_default as s}from"./invalid-parameter-CvwVNf6G.js";import{config_not_found_default as c}from"./config-not-found-QwO11ree.js";import{renderItems as l}from"./common-utils-DA5COZq4.js";import u from"node:path";import{CookieJar as d}from"tough-cookie";t();const f=`https://www.instagram.com`,p=`https://instagram.com`,m=async e=>{let t=await e.getCookieString(p);return t.match(/csrftoken=([^;]+)/)?.[1]},h=async e=>({"X-ASBD-ID":198387,"X-CSRFToken":await m(e),"X-IG-App-ID":936619743392459,"X-IG-WWW-Claim":void 0}),g=async(e,t)=>{let n=await o.post(`${f}/api/v1/web/fxcal/ig_sso_users/`,{headers:{cookie:await e.getCookieString(p),...await h(e),"X-IG-WWW-Claim":`0`}}),r=n.headers[`x-ig-set-www-claim`];return r&&t.set(`instagram:wwwClaimV2`,r),n.data.status===`ok`},_=async(e,t,n)=>{let r,i=await n.get(`instagram:getIdByUsername:${e}`),a=await n.get(`instagram:userInfo:${i}`);if(!a)try{let a=await o(`${f}/api/v1/users/web_profile_info/`,{cookieJar:t,headers:{...await h(t),"X-IG-WWW-Claim":await n.get(`instagram:wwwClaimV2`)??void 0},searchParams:{username:e}});if(a.url.includes(`/accounts/login/`))throw new c(`Invalid cookie`);r=a.data.data.user,i=r.id,await n.set(`instagram:getIdByUsername:${e}`,i,31536e3),await n.set(`instagram:userInfo:${i}`,r)}catch(e){throw e.message.includes(`Cookie not in this host's domain`)?new c(`Invalid cookie`):e}return a=typeof a==`string`?JSON.parse(a):a,a||r},v=(e,t,r,i)=>i.tryGet(`instagram:feed:${e}`,async()=>{let e=await o(`${f}/api/v1/feed/user/${t}/username/`,{headers:{cookie:await r.getCookieString(p),...await h(r),"X-IG-WWW-Claim":await i.get(`instagram:wwwClaimV2`)},searchParams:{count:30}});if(e.url.includes(`/accounts/login/`))throw new c(`Invalid cookie.
                Please also check if your account is being blocked by Instagram.`);return e.data.items},n.cache.routeExpire,!1),y=(e,t,r,i)=>i(`instagram:tags:${e}`,async()=>{let n=await o(`${f}/api/v1/tags/web_info/`,{headers:{cookie:await r.getCookieString(p),...await h(r)},searchParams:{tag_name:e}});return n.data.data[t].sections.flatMap(e=>e.layout_content.medias.map(e=>e.media))},n.cache.routeExpire,!1),b=async(e,t)=>{let n=await o(`${f}/api/v1/tags/logged_out_web_info/`,{headers:{cookie:await t.getCookieString(p),...await h(t),"X-IG-WWW-Claim":`0`},searchParams:{tag_name:e}}),r=n.headers[`set-cookie`];if(r)for await(let e of r)await t.setCookie(e,p);return n.data.data.hashtag},x=t=>{let n=(t,n)=>i(u.join(e,`templates/video-fb8df18d.art`),{summary:n,image:t.display_url,video:{url:t.video_url,height:t.dimensions.height,width:t.dimensions.width}}),r=(t,n)=>i(u.join(e,`templates/images-105c7ff0.art`),{summary:n,images:[{url:t.display_url,height:t.dimensions.height,width:t.dimensions.width}]});return t.map(({node:e})=>{let t=e.__typename,i=e.edge_media_to_caption.edges[0]?.node.text??``,o=``;switch(t){case`GraphSidecar`:o=e.edge_sidecar_to_children?e.edge_sidecar_to_children.edges.map(({node:e},t)=>{let a=e.__typename;switch(a){case`GraphVideo`:return n(e,t===0?i:``);case`GraphImage`:return r(e,t===0?i:``);default:throw Error(`Instagram: Unhandled carousel type: ${a}`)}}).join(``):r(e,i);break;case`GraphVideo`:o=n(e,i);break;case`GraphImage`:o=r(e,i);break;default:throw Error(`Instagram: Unhandled feed type: ${t}`)}return{title:i.split(`
`)[0],id:e.id,pubDate:a(e.taken_at_timestamp,`X`),author:e.owner.username,link:`${f}/p/${e.shortcode}/`,summary:i,description:o}})},S={path:`/2/:category/:key`,categories:[`social-media`],example:`/instagram/2/user/stefaniejoosten`,parameters:{category:`Feed category, see table below`,key:`Username / Hashtag name`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`User Profile / Hashtag`,maintainers:[`TonyRL`],handler:C,description:`::: tip
You may need to setup cookie for a less restrictive rate limit and private profiles.
:::


| User timeline | Hashtag |
| ------------- | ------- |
| user          | tags    |`};async function C(e){let t=[`user`,`tags`],{category:i,key:a}=e.req.param(),{cookie:o}=n.instagram;if(!t.includes(i))throw new s(`Such feed is not supported.`);let u=await r.get(`instagram:cookieJar`),m=await r.get(`instagram:wwwClaimV2`),h=!u;if(h){if(u=new d,o)for await(let e of o.split(`; `))await u.setCookie(e,p)}else u=d.fromJSON(u);if(!m&&o&&!await g(u,r))throw new c(`Invalid cookie`);let S,C,w,T,E;switch(i){case`user`:{let e=await _(a,u,r),t=e.biography,n=e.full_name,i=e.id,s=e.username;S=`${n} (@${s}) - Instagram`,w=t,T=e.profile_pic_url_hd??e.hd_profile_pic_url_info?.url??e.profile_pic_url,C=`${f}/${s}`,E=o?await v(i,s,u,r):[...e.edge_felix_video_timeline.edges,...e.edge_owner_to_timeline_media.edges];break}case`tags`:{let e=a;if(S=`#${e} - Instagram`,C=`${f}/explore/tags/${e}`,o)E=await y(e,`recent`,u,r.tryGet);else{let t=await b(e,u);E=[...t.edge_hashtag_to_media.edges,...t.edge_hashtag_to_top_posts.edges]}break}default:break}return await r.set(`instagram:cookieJar`,u.toJSON(),31536e3),{title:S,link:C,description:w,item:o?l(E):x(E),icon:`${f}/static/images/ico/xxhdpi_launcher.png/99cf3909d459.png`,logo:T,image:T,allowEmpty:!0}}export{S as route};