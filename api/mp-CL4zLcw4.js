import{__dirname as e,init_esm_shims as t}from"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import{ofetch_default as n}from"./ofetch-CDAeBYLA.js";import{cache_default as r}from"./cache-7MGQxbL-.js";import{art as i}from"./render-DlHIMz-Z.js";import{parseDate as a}from"./parse-date-B2cCVoGk.js";import o from"node:path";import*as s from"cheerio";import c from"crypto-js";t();const l={path:`/mp/:xpt`,categories:[`new-media`,`popular`],example:`/sohu/mp/c29odXptdGhnbjZ3NEBzb2h1LmNvbQ==`,parameters:{xpt:`搜狐号 xpt ，可在URL中找到或搜狐号 ID`},radar:[{source:[`mp.sohu.com/profile`],target:(e,t)=>`/sohu/mp/${new URL(t).searchParams.get(`xpt`)}`}],name:`最新`,maintainers:[`HenryQW`],handler:m,description:"搜狐号 ID 可以通过以下方式获取：\n  1.  通过浏览器搜索相关搜狐号 `果壳 site: mp.sohu.com`。\n  2.  通过浏览器控制台执行 `window.globalConst.mkeyConst_mkey`，返回的即为搜狐号 ID。"};function u(e=32){let t=``,n=`ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678`,r=n.length;for(let i=0;i<e;i++)t+=n.charAt(Math.floor(Math.random()*r));return t}const d=`1612268936507kas0gk`;function f(e){let t=c.enc.Utf8.parse(`www.sohu.com6666`),n=c.AES.decrypt(e,t,{mode:c.mode.ECB,padding:c.pad.Pkcs7});return n.toString(c.enc.Utf8)}function p(t){return r.tryGet(t.link,async()=>{let r=await n(t.link),a=s.load(r);if(a(`.original-title, .lookall-box`).remove(),t.author=t.author||a(`span[data-role="original-link"] a`).text(),/window\.sohu_mp\.article_video/.test(a(`script`).text())){let n=a(`script`).text().match(/\s*url: "(.*?)",/)?.[1];t.description=i(o.join(e,`templates/video-e51936ec.art`),{poster:a(`script`).text().match(/cover: "(.*?)",/)?.[1],src:n,type:n?.split(`.`).pop()?.toLowerCase()})}else{let e=a(`#mp-editor`);e.find(`#backsohucom, p[data-role="editor-name"]`).each((e,t)=>{a(t).remove()}),e.find(`img`).each((e,t)=>{let n=a(t);n.attr(`data-src`)&&!n.attr(`src`)&&(n.attr(`src`,f(n.attr(`data-src`))),n.removeAttr(`data-src`))}),t.description=e.html()}return t})}async function m(e){let t=e.req.param(`xpt`),r=/^\d+$/.test(t);if(r)return h(e);let i=await n.raw(`https://mp.sohu.com/profile`,{query:{xpt:t}}),o=i.headers?.getSetCookie().find(e=>e.startsWith(`SUV`))?.split(`;`)[0],c=s.load(i._data),l=JSON.parse(c(`script:contains("CBDRenderConst")`).text().trim().match(/CBDRenderConst\s=\s(.*)/)?.[1]||`{}`),f=JSON.parse(c(`script:contains("contentData")`).toArray().map(e=>c(e).text().match(/contentData = (.*)/)?.[1]).sort((e,t)=>t.length-e.length)[0]||`{}`),m=JSON.parse(c(`script:contains("column_2_text")`).text().match(/({.*})/)?.[1]),g=m[Object.keys(m).find(e=>e.startsWith(`FeedSlideloadAuthor`))],_=JSON.parse(c(`script:contains("globalConst")`).text().match(/globalConst\s=\s(.*)/)?.[1]||`{}`),v=JSON.parse(c(`script:contains("originalRequest")`).text().match(/originalRequest\s=\s(.*)/)?.[1]||`{}`),y=await n(`https://odin.sohu.com/odin/api/blockdata`,{method:`POST`,headers:{Cookie:Object.entries({SUV:o,itssohu:`true`,reqtype:`pc`,t:Date.now()}).map(([e,t])=>`${e}=${t}`).join(`; `)},body:{pvId:l.COMMONCONFIG.pvId||`${Date.now()}_${u(7)}`,pageId:`${Date.now()}_${d.slice(0,-5)}_${u(3)}`,mainContent:{productType:f.businessType||`13`,productId:f.id||`324`,secureScore:f.secureScore||`5`,categoryId:f.categoryId||`47`,adTags:f.adTags||`11111111`,authorId:f.account.id||121135924},resourceList:[{tplCompKey:g.param.data2.reqParam.tplCompKey||`FeedSlideloadAuthor_2_0_pc_1655965929143_data2`,isServerRender:g.param.data2.reqParam.isServerRender||!1,isSingleAd:g.param.data2.reqParam.isSingleAd||!1,configSource:g.param.data2.reqParam.configSource||`mp`,content:{productId:g.param.data2.reqParam.content.productId||`325`,productType:g.param.data2.reqParam.content.productType||`13`,size:20,pro:g.param.pro||`0,1,3,4,5`,feedType:g.param.feedType||`XTOPIC_SYNTHETICAL`,view:``,innerTag:g.param.data2.reqParam.content.innerTag||`work`,spm:g.param.data2.reqParam.content.spm||`smpc.channel_248.block3_308_hHsK47_2_fd`,page:1,requestId:`${Date.now()}_${u(13)}_${f.id}`},adInfo:{},context:{mkey:_.mkeyConst_mkey}}]}}),b=y.data[g.param.data2.reqParam.tplCompKey].list.map(e=>({title:e.title,description:e.brief,link:`https://www.sohu.com/a/${e.id}_${e.authorId}`,author:e.authorName,pubDate:a(e.postTime,`x`)})),x=await Promise.all(b.map(e=>p(e)));return{title:`搜狐号 - ${_.title}`,link:v.url,item:x}}async function h(e){let t=e.req.param(`xpt`),r=`https://v2.sohu.com/author-page-api/author-articles/pc/${t}`,i=await n(r),o=i.data.pcArticleVOS.map(e=>({title:e.title,link:e.link.startsWith(`http`)?e.link:`https://${e.link}`,pubDate:a(e.publicTime)})),s=await Promise.all(o.map(e=>p(e)));return{title:`搜狐号 - ${t}`,item:s}}export{l as route};