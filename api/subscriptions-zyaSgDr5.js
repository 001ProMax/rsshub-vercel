import{__dirname as e,init_esm_shims as t}from"./esm-shims-CtP6w_ML.js";import{config as n}from"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CWQqZcqz.js";import"./helpers-RrXnNmv1.js";import{cache_default as r}from"./cache-CvppK6AM.js";import{art as i}from"./render-DE4LRFBD.js";import{parseDate as a}from"./parse-date-DHsdom8D.js";import{got_default as o}from"./got-BwctkUCD.js";import{config_not_found_default as s}from"./config-not-found-QwO11ree.js";import c from"node:path";import l from"markdown-it";t();const u=l({html:!0}),d={path:`/subscriptions`,categories:[`anime`],example:`/iwara/subscriptions`,parameters:{},features:{requireConfig:[{name:`IWARA_USERNAME`,description:``},{name:`IWARA_PASSWORD`,description:``}],requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`ecchi.iwara.tv/`]}],name:`User Subscriptions`,maintainers:[`FeCCC`],handler:f,url:`ecchi.iwara.tv/`,description:`::: warning
  This route requires username and password, therefore it's only available when self-hosting, refer to the [Deploy Guide](https://docs.rsshub.app/deploy/config#route-specific-configurations) for route-specific configurations.
:::`};async function f(){if(!n.iwara||!n.iwara.username||!n.iwara.password)throw new s(`Iwara subscription RSS is disabled due to the lack of <a href="https://docs.rsshub.app/deploy/config#route-specific-configurations">relevant config</a>`);let t=`https://www.iwara.tv`,l=n.iwara.username,d=n.iwara.password,f=await r.tryGet(`iwara:token`,async()=>{let e=await o({method:`post`,url:`https://api.iwara.tv/user/login`,headers:{"content-type":`application/json`},body:JSON.stringify({email:l,password:d})});return{authorization:`Bearer `+e.data.token}},30*24*60*60,!1),p=`https://api.iwara.tv/videos?page=0&limit=30&subscribed=true`,m=`https://api.iwara.tv/images?page=0&limit=30&subscribed=true`,h=await o({method:`post`,url:`https://api.iwara.tv/user/token`,headers:f}),g={authorization:`Bearer `+h.data.accessToken},_=await o({method:`get`,url:p,headers:g}),v=await o({method:`get`,url:m,headers:g}),y=_.data.results.map(e=>{let n=e.private===!0?`https://i.iwara.tv/image/original/`:`https://i.iwara.tv/image/thumbnail/`,r=e.file?n+e.file.id.toString().padStart(2,`0`)+`/thumbnail-`+e.thumbnail.toString().padStart(2,`0`)+`.jpg`:``;return{title:e.title,author:e.user.name,link:t+`/video/`+e.id,category:`Video`,imageUrl:r,pubDate:a(e.createdAt),private:e.private}}),b=v.data.results.map(e=>{let n=e.thumbnail?`https://i.iwara.tv/image/thumbnail/`+e.thumbnail.id+`/`+e.thumbnail.id+`.jpg`:``;return{title:e.title,author:e.user.name,link:t+`/image/`+e.id,category:`Image`,imageUrl:n,pubDate:a(e.createdAt)}}),x=[...y,...b],S=await Promise.all(x.map(t=>r.tryGet(t.link,async()=>{let n=i(c.join(e,`templates/subscriptions-f52aca80.art`),{type:t.category,imageUrl:t.imageUrl});if(t.private===!0)return n+=`private`,{title:t.title,author:t.author,link:t.link,category:t.category,pubDate:t.pubDate,description:n};let r=t.link.replace(`www.iwara.tv`,`api.iwara.tv`),a=await o({method:`get`,url:r,headers:g}),s=a.data.body?u.render(a.data.body):``;return n+=s,{title:t.title,author:t.author,link:t.link,category:t.category,pubDate:t.pubDate,description:n}})));return{title:`Iwara Subscription`,link:t,item:S}}export{d as route};