import"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CDAeBYLA.js";import"./helpers-RrXnNmv1.js";import"./render-DlHIMz-Z.js";import"./md5-BdV0DUA8.js";import{got_default as e}from"./got-Cw4D6IS5.js";import{ViewType as t}from"./types-DygLf1a3.js";import{getVideoUrl as n,utils_default as r}from"./utils-DBHllTyA.js";const i=[`0`,`1`,`4`,`168`,`3`,`1`,`3`,`129`,`4`,`36`,`188`,`234`,`223`,`160`,`211`,`217`,`119`,`155`,`5`,`181`,`2`,`5`,`7`,`0`,`0`],a=[`全站`,`番剧`,`国产动画`,`国创相关`,`纪录片`,`动画`,`音乐`,`舞蹈`,`游戏`,`知识`,`科技`,`运动`,`汽车`,`生活`,`美食`,`动物圈`,`鬼畜`,`时尚`,`娱乐`,`影视`,`电影`,`电视剧`,`综艺`,`原创`,`新人`],o=[`all`,`bangumi`,`guochan`,`guochuang`,`documentary`,`douga`,`music`,`dance`,`game`,`knowledge`,`tech`,`sports`,`car`,`life`,`food`,`animal`,`kichiku`,`fashion`,`ent`,`cinephile`,`movie`,`tv`,`variety`,`origin`,`rookie`],s=[`x/rid`,`pgc/web`,`pgc/season`,`x/rid`,`pgc/season`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`x/rid`,`pgc/season`,`pgc/season`,`pgc/season`,`x/type`,`x/type`],c={path:`/ranking/:rid_index?/:embed?/:redirect1?/:redirect2?`,name:`排行榜`,maintainers:[`DIYgod`,`hyoban`],categories:[`social-media`,`popular`],view:t.Videos,example:`/bilibili/ranking/0`,parameters:{rid_index:{description:`排行榜分区 id 序号`,default:`0`,options:Array.from({length:i.length},(e,t)=>({value:String(t),label:a[t]})).filter((e,t)=>!s[t].startsWith(`pgc/`))},embed:`默认为开启内嵌视频, 任意值为关闭`,redirect1:`留空，用于兼容之前的路由`,redirect2:`留空，用于兼容之前的路由`},handler:d};function l(e){let t=i.indexOf(e);if(t===-1)throw Error(`Invalid rid`);return t}function u(e){if(e<0||e>=i.length)throw Error(`Invalid rid index`);let t=i[e],n=s[e],r=a[e],c=o[e],l=``;switch(n){case`x/rid`:l=`https://api.bilibili.com/x/web-interface/ranking?rid=${t}&type=all`;break;case`pgc/web`:l=`https://api.bilibili.com/pgc/web/rank/list?day=3&season_type=${t}`;break;case`pgc/season`:l=`https://api.bilibili.com/pgc/season/rank/web/list?day=3&season_type=${t}`;break;case`x/type`:l=`https://api.bilibili.com/x/web-interface/ranking?rid=0&type=${c}`;break;default:throw Error(`Invalid rid type`)}return{apiURL:l,referer:`https://www.bilibili.com/v/popular/rank/${c}`,ridChinese:r,ridType:n,link:`https://www.bilibili.com/v/popular/rank/${c}`}}async function d(t){let i=t.req.param();if(i.redirect1||i.redirect2){let e=i.redirect2?`/`+i.redirect2:``;return t.set(`redirect`,`/bilibili/ranking/${l(i.rid_index)}${e}`),null}let a=t.req.param(`rid_index`)||`0`,o=!t.req.param(`embed`),{apiURL:s,referer:c,ridChinese:d,link:f,ridType:p}=u(Number(a));if(p.startsWith(`pgc/`))throw Error(`This type of ranking is not supported yet`);let m=await e({method:`get`,url:s,headers:{Referer:c}}),h=m.data.data||m.data.result,g=h.list||[];return{title:`bilibili 排行榜-${d}`,link:f,item:g.map(e=>({title:e.title,description:r.renderUGCDescription(o,e.pic,e.description||e.title,e.aid,void 0,e.bvid),pubDate:e.create&&new Date(e.create).toUTCString(),author:e.author,link:!e.create||new Date(e.create).getTime()/1e3>r.bvidTime&&e.bvid?`https://www.bilibili.com/video/${e.bvid}`:`https://www.bilibili.com/video/av${e.aid}`,image:e.pic,attachments:e.bvid?[{url:n(e.bvid),mime_type:`text/html`}]:void 0}))}}export{c as route};