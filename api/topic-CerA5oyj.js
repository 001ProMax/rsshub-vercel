import"./esm-shims-CtP6w_ML.js";import{config as e}from"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CDAeBYLA.js";import"./helpers-RrXnNmv1.js";import{cache_default as t}from"./cache-7MGQxbL-.js";import{parseDate as n}from"./parse-date-B2cCVoGk.js";import{got_default as r}from"./got-Cw4D6IS5.js";import{ViewType as i}from"./types-DygLf1a3.js";import a from"dayjs";import{load as o}from"cheerio";const s=`https://api.ruguoapp.com/1.0/mediaMeta/play?type=ORIGINAL_POST`,c=(e,t)=>e.posts.map(e=>{let r,i,a,o,s;switch(e.type){case`ORIGINAL_POST`:o=e.content,s=`https://m.okjike.com/originalPosts/${e.id}`;break;default:o=`未知类型，请前往GitHub提交issue`,s=`https://github.com/DIYgod/RSSHub/issues`}let c=``,l=``;if(e.user&&(l=e.user.screenName,t.req.param(`showUid`)&&(c+=`<span>用户昵称：${l} <br> Username：${e.user.username}</span><br>`)),e.linkInfo){let t=e.linkInfo.originalLinkUrl||e.linkInfo.linkUrl;new URL(t).host===`mp.weixin.qq.com`&&(s=t);let n=e.linkInfo.audio||e.audio;if(n){let e=n.image.picUrl||n.image.thumbnailUrl,i=t,a=n.title,o=n.author;r=`${a} - ${o}`,c+=`
            <img src="${e}">
            <a href="${i}">${r}</a>
        `}let o=e.linkInfo.video||e.video;if(o){let n=o.image.picUrl||o.image.thumbnailUrl,r=t,a=Math.floor(o.duration/6e4);i=e.linkInfo.title,c+=`
            <img src="${n}">
            <a href="${r}">${i||`观看视频`} - 约${a}分钟</a>
        `}if(!n&&!o&&t){a=e.linkInfo.title;let n=a||`访问原文`,r=e.linkInfo.pictureUrl,i=`<img src="${r}">`;c+=`
            ${r?i:``}
            <a href="${t}">${n}</a>
        `}}if(c+=c?`<br>${o}`:o,e.pictures)for(let t of e.pictures)if(t.format===`gif`)c+=`<img src="${t.picUrl.split(`?imageMogr2/`)[0]}">`;else{let e=/\.[\da-z]+?\?imageMogr2/.test(t.picUrl)?t.picUrl.split(`?imageMogr2/`)[0]:t.picUrl.replace(/thumbnail\/.+/,``);c+=`<br><img src="${e}">`}e.video&&(c+=`<br><video src="${e.video.url}" controls></video>`);let u=r||i||o||a||`无题`;return{title:u,description:c.trim().replaceAll(`
`,`<br>`),pubDate:n(e.createdAt),author:l,link:s}}),l=async(n,i)=>{let a=await t.tryGet(i,async()=>{let e=await r(i),t=e.data,n=o(t),a=n(`[type = "application/json"]`).html(),c=JSON.parse(a).props.pageProps;return c.posts=await Promise.all(c.posts.map(async e=>{if(!e.video)return e;let t=`${s}&id=${e.id}`,n=await r(t);return e.video=n.data,e})),c},!1,e.cache.routeExpire);if(a.length===0)return{title:`主题 ID 不存在，或该主题暂无内容`};let c=a.topic;return a.result={title:`${c.content} - 即刻圈子`,link:i,description:c.briefIntro,image:c.squarePicture.picUrl||c.squarePicture.middlePicUrl||c.squarePicture.thumbnailUrl},a},u=/(https?:\/\/[^\s"'<>]+)/g,d={path:`/topic/:id/:showUid?`,categories:[`social-media`,`popular`],view:i.SocialMedia,example:`/jike/topic/556688fae4b00c57d9dd46ee`,parameters:{id:`圈子 id, 可在即刻 web 端圈子页或 APP 分享出来的圈子页 URL 中找到`,showUid:{description:`是否在内容中显示用户信息，设置为 1 则开启`,options:[{value:`1`,label:`显示`}]}},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`web.okjike.com/topic/:id`],target:`/topic/:id`}],name:`圈子`,maintainers:[`DIYgod`,`prnake`],handler:f};async function f(e){let n=e.req.param(`id`),i=`https://m.okjike.com/topics/${n}`,s=await l(e,i);if(s){let i=s.result;return i.item=c(s,e),(n===`553870e8e4b0cafb0a1bef68`||n===`55963702e4b0d84d2c30ce6f`)&&(i.item=await Promise.all(i.item.map(async e=>{let n={...e},i=/https:\/\/www\.okjike\.com\/medium\/[\dA-Za-z]*/.exec(n.description);if(i){let e=i[0];n.description=await t.tryGet(e,async()=>{let{data:t}=await r(e),n=o(t),i=n(`ul.main > li.item`),a=i.find(`a`).map((e,t)=>n(t).attr(`href`)),s=i.find(`span.text`).map((e,t)=>n(t).text()),c=``;for(let[e,t]of a.entries())c+=`${e+1}、<a href="${t}">${s[e]}</a><br>`;return c=c.replace(/<br>$/,``),c})}return n.description=n.description.replaceAll(u,e=>`<a href="${e}">${e}</a>`),n.title=`${s.topic.content} ${a(e.pubDate).format(`MM月DD日`)}`,n}))),i}}export{d as route};