import{__dirname as e,init_esm_shims as t}from"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CWQqZcqz.js";import"./helpers-RrXnNmv1.js";import{art as n}from"./render-DE4LRFBD.js";import{got_default as r}from"./got-BwctkUCD.js";import i from"node:path";import a from"crypto";import o from"dayjs";import s from"dayjs/plugin/customParseFormat.js";import{load as c}from"cheerio";import l from"city-timezones";import u from"dayjs/plugin/utc.js";import d from"dayjs/plugin/timezone.js";o.extend(s),o.extend(u),o.extend(d);const f={expandOdd:e=>{e.prototype.odd=function(){let t=[];return this.each((e,n)=>{e%2==1&&t.push(n)}),e(t)}},expandEven:e=>{e.prototype.even=function(){let t=[];return this.each((e,n)=>{e%2==0&&t.push(n)}),e(t)}},expandReverse:e=>{e.prototype.reverse=function(){let t=[];return this.each((e,n)=>{t.push(n)}),t.reverse(),e(t)}},generateGuid:e=>{let t=a.createHash(`sha512`);t.update(e);let n=t.digest(`hex`).toUpperCase();return n},parseDatetime:(e,t,n,r,i)=>{let a=`YYYY/MM/DD`,s=`YYYY/MM/DD HH:mm`,c=`MM/DD/YYYY`,u=`MM/DD/YYYY HH:mm`,d;switch(i){case`ja`:d=o(e,a,!0).isValid()?a:o(e,s,!0).isValid()?s:void 0;break;case`en`:d=o(e,c,!0).isValid()?c:o(e,u,!0).isValid()?u:void 0;break}if(t){let e=[[`郵便局`],[`都`,`道`,`府`,`県`]];if(e[0].some(e=>t.includes(e))||e[1].some(e=>n.includes(e)))r=`Asia/Tokyo`;else{let e=t.replace(` EMS`,``).replace(` INT`,``);try{try{r=l.lookupViaCity(e)[0].timezone}catch{r=l.lookupViaCity(n)[0].timezone}}catch{}}}return d?[o.tz(e,d,r).valueOf(),r]:[new Date(e).getTime(),r]}};var p=f;t();let m=`日本郵便`;const h=`https://trackings.post.japanpost.jp/services/srv/search/direct?`;async function g(t){let a=t.req.param(`reqCode`),o=`reqCodeNo1=`+a,s=`ja`;t.req.param(`locale`)===`en`&&(s=`en`,m=`Japanpost`);let l=`&locale=`+s,u=h+o+l,d=await r({method:`get`,url:u}),f=c(d.data);p.expandEven(f),p.expandOdd(f);let g=f(`.tableType01`).eq(1).find(`tr`).slice(2),_=f(`.tableType03`).eq(0).find(`tr`).slice(1),v;if(_.length&&(v=_.map((e,t)=>{let n=f(t).find(`td`);return{officeType:n.eq(0).text().trim(),officeName:n.eq(1).html().trim(),officeTel:n.eq(2).html().trim()}}).get()),!g.length){let e=f(`.tableType01`).eq(0).find(`tr`).eq(2).find(`td`).eq(1).text().trim();throw Error(e)}let y=g.even(),b=g.odd(),x=f(`.tableType01`).eq(0).find(`tr`).eq(1).find(`td`).eq(1).text().trim(),S=f(`.tableType01`).eq(0).find(`tr`).eq(1).find(`td`).eq(2).text().trim(),C=s===`ja`?`付加サービス：`:`Additional services: `,w,T;return{title:`${m} ${a} ${x}`,link:u,description:`${m} ${a} ${x}`,language:s,icon:`https://www.post.japanpost.jp/favicon.ico`,logo:`https://www.post.japanpost.jp/favicon.ico`,item:y.map((t,r)=>{let o=f(r).find(`td`),c=o.eq(1).text().trim(),l=o.eq(4).text().trim(),d=o.eq(3).text().trim(),m=b.eq(t).find(`td`).eq(0).text().trim(),h=`${c} ${d} ${l}`,g=o.eq(2).text().trim(),_=n(i.join(e,`templates/track_item_desc-8ae6c583.art`),{packageStatus:c,packageTrackRecord:g,packageOfficeZipCode:m,packageOffice:d,packageRegion:l,index:t,officeItemList:v,serviceText:C,packageService:S}),y=o.eq(0).text().trim(),x=p.generateGuid(a+h+_+y),E;return[E,T]=p.parseDatetime(y,d,l,T,s),w&&E<=w&&(E=w+1e3),w=E,{title:h,description:_,pubDate:new Date(E),link:u,guid:x.slice(0,32)}}).get()}}const _={name:`Track & Trace Service`,path:`/track/:reqCode/:locale?`,example:`/japanpost/track/EJ123456789JP/en`,url:`trackings.post.japanpost.jp/services/srv/search/`,handler:g,categories:[`other`],maintainers:[`tuzi3040`],parameters:{reqCode:`Package Number`,locale:"Language, default to japanese `ja`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportRadar:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},description:`| Japanese | English |
| -------- | ------- |
| ja       | en      |`,zh:{name:`邮件追踪查询`,description:`| 日语 | 英语 |
| ---- | ---- |
| ja   | en   |`},ja:{name:`郵便追跡サービス`,description:`| 日本語 | 英語 |
| ---- | ---- |
| ja   | en   |`}};export{_ as route};