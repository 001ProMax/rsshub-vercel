import"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CWQqZcqz.js";import"./helpers-RrXnNmv1.js";import"./cache-CvppK6AM.js";import"./parse-date-DHsdom8D.js";import{got_default as e}from"./got-BwctkUCD.js";import{finishArticleItem as t}from"./wechat-mp-DRebaZz-.js";import{load as n}from"cheerio";const r={path:`/tgchannel/:id/:mpName?/:searchQueryType?`,categories:[`new-media`],example:`/wechat/tgchannel/lifeweek`,parameters:{id:`公众号绑定频道 id`,mpName:`欲筛选的公众号全名（URL-encoded，精确匹配），在频道订阅了多个公众号时可选用`,searchQueryType:`搜索查询类型，见下表`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`公众号（Telegram 频道来源）`,maintainers:[`LogicJake`,`Rongronggg9`],handler:i,description:`| 搜索查询类型 | 将使用的搜索关键字 |            适用于           |
| :----------: | :----------------: | :-------------------------: |
|      \`0\`     |     (禁用搜索)     |       所有情况 (默认)       |
|      \`1\`     |     公众号全名     | 未启用 efb-patch-middleware |
|      \`2\`     |     #公众号全名    | 已启用 efb-patch-middleware |

::: tip
  启用搜索有助于在订阅了过多公众号的频道里有效筛选，不易因为大量公众号同时推送导致一些公众号消息被遗漏，但必须正确选择搜索查询类型，否则会搜索失败。
:::

::: warning
  该方法需要通过 efb 进行频道绑定，具体操作见 [https://github.com/DIYgod/RSSHub/issues/2172](https://github.com/DIYgod/RSSHub/issues/2172)
:::`};async function i(r){let i=r.req.param(`id`),a=r.req.param(`mpName`)??``,o=r.req.param(`searchQueryType`)??`0`;o!==`0`&&o!==`1`&&o!==`2`&&(o=`0`),o=+o;let s=`https://t.me/s/${i}`,c=a&&o?o===2?`?q=%23${a}`:`?q=${a}`:``,{data:l}=await e.get(`${s}${c}`),u=n(l),d=u(`.tgme_widget_message_wrap`).slice(-20),f=await Promise.all(d.map(async(e,n)=>{if(n=u(n),c){let e=n.find(`mark.highlight`).get();if(e){for(let t of e){t=u(t);let e=t.html();t.replaceWith(e)}n=u(n.html())}}let r=``,i=!1,o=n.find(`.tgme_widget_message_text > br:nth-of-type(1)`).get(0),s=o&&o.prev,l=s&&s.prev;if(s&&s.type===`text`){l&&l.type===`tag`&&l.name===`a`&&l.attribs.href&&l.attribs.href.startsWith(`?q=%23`)&&(i=!0,r+=u(l).text());let e=s.data.indexOf(` `),t=s.data.indexOf(`:`);if(s.data.length>1&&t!==-1&&(e!==-1||i)){let n=i?0:e+1;r+=s.data.slice(n,t)}r.startsWith(`#`)&&(r=r.slice(1))}let d=i?3:2,f=n.find(`.tgme_widget_message_text > a:nth-of-type(${d})`);if(f.length===0)return;let p=f.text(),m=f.attr(`href`);if(a&&r!==a)return;!a&&r&&(p=r+`: `+p);let h=new Date(n.find(`.tgme_widget_message_date time`).attr(`datetime`)).toUTCString(),g={title:p,pubDate:h,link:m};if(m!==void 0)try{return await t(g)}catch{g.description=n.find(`.tgme_widget_message_text`).html()}return g}).get());return f.reverse(),{title:a||u(`.tgme_channel_info_header_title`).text(),link:`https://t.me/s/${i}`,item:f.filter(Boolean),allowEmpty:!!a}}export{r as route};