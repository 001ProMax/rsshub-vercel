import{__dirname as e,init_esm_shims as t}from"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CWQqZcqz.js";import"./helpers-RrXnNmv1.js";import{cache_default as n}from"./cache-CvppK6AM.js";import{art as r}from"./render-DE4LRFBD.js";import{parseDate as i}from"./parse-date-DHsdom8D.js";import{got_default as a}from"./got-BwctkUCD.js";import o from"node:path";import{load as s}from"cheerio";t();const c={path:`/:category{.+}?`,name:`Unknown`,maintainers:[],handler:l};async function l(t){let{category:c=``}=t.req.param(),l=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`),10):50,u=`https://www.jiemian.com`,d=new URL(c?`${c}.html`:``,u).href,{data:f}=await a(d),p=s(f),m=p(`a`).toArray().reduce((e,t)=>{t=p(t);let n=t.prop(`href`),r=n?n.startsWith(`/`)?new URL(n,u).href:n:void 0;return r&&/\/(article|video)\/\w+\.html/.test(r)&&(e[r]={title:t.text(),link:r}),e},{});m=await Promise.all(Object.values(m).slice(0,l).map(t=>n.tryGet(t.link,async()=>{let{data:n}=await a(t.link),c=s(n),l=c(`div.article-img img`).first(),u=c(`#video-player`).first();return t.title=c(`div.article-header h1`).eq(0).text(),t.description=r(o.join(e,`templates/description-55895928.art`),{image:l?{src:l.prop(`src`),alt:l.next(`p`).text()||t.title}:void 0,video:u?{src:u.prop(`data-url`),poster:u.prop(`data-poster`),width:u.prop(`width`),height:u.prop(`height`)}:void 0,intro:c(`div.article-header p`).text(),description:c(`div.article-content`).html()}),t.author=c(`span.author`).first().find(`a`).toArray().map(e=>c(e).text()).join(`/`),t.category=c(`meta.meta-container a`).toArray().map(e=>c(e).text()),t.pubDate=i(c(`div.article-info span[data-article-publish-time]`).prop(`data-article-publish-time`),`X`),t.upvotes=c(`span.opt-praise__count`).text()?Number.parseInt(c(`span.opt-praise__count`).text(),10):0,t.comments=c(`span.opt-comment__count`).text()?Number.parseInt(c(`span.opt-comment__count`).text(),10):0,t})));let h=p(`title`).text(),g=h.split(/_/),_=p(`div.logo img`).prop(`src`),v=new URL(p(`link[rel="icon"]`).prop(`href`),u).href;return{item:m,title:h,link:d,description:p(`meta[name="description"]`).prop(`content`),language:p(`html`).prop(`lang`),image:_,icon:v,logo:v,subtitle:g[0],author:g.pop()}}export{c as route};