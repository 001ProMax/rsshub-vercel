import{__dirname as e,init_esm_shims as t}from"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CWQqZcqz.js";import"./helpers-RrXnNmv1.js";import{cache_default as n}from"./cache-CvppK6AM.js";import{art as r}from"./render-DE4LRFBD.js";import{parseDate as i}from"./parse-date-DHsdom8D.js";import{got_default as a}from"./got-BwctkUCD.js";import o from"node:path";import{load as s}from"cheerio";t();const c={path:`/:what?/:id?/:needTorrents?/:needImages?`,name:`Unknown`,maintainers:[],handler:l};async function l(t){let c=t.req.param(`id`)??``,l=t.req.param(`what`)??``,u=/t|y/i.test(t.req.param(`needTorrents`)??`true`),d=/t|y/i.test(t.req.param(`needImages`)??`true`),f=`https://e-hentai.org`,p=`${f}/${c?l===`search`?`?${c}`:l===`category`?c:`${l}/${c}`:l}`,m=await a({method:`get`,url:p}),h=s(m.data);h(`.itd`).parent().remove();let g=h(`table.gltc tbody tr`).slice(1,t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`))+1:d?16:26).toArray().map(e=>(e=h(e),{title:e.find(`div.glink`).text(),author:e.find(`td.glhide div a`).text(),link:e.find(`td.glname a`).attr(`href`),pubDate:i(e.find(`div.ir`).prev().text()),category:e.find(`div.gt`).toArray().map(e=>h(e).attr(`title`).replace(/^:/,``)),description:d?``:`<img src="${e.find(`div.glthumb div img`).attr(`data-src`)??e.find(`div.glthumb div img`).attr(`src`)}">`,enclosure_url:u&&e.find(`div.gldown a img[title="Show torrents"]`).length>0?e.find(`.gldown a`).attr(`href`):void 0}));return g=await Promise.all(g.map(async t=>{if(t.enclosure_url){let e=``,r=await n.get(t.enclosure_url);if(!r){let i=await a({method:`get`,url:t.enclosure_url}),o=s(i.data);o(`h1, input[name="torrent_info"]`).remove(),e=o(`form`).parent().html(),r=o(`table tbody tr td a`).toArray().map(e=>(e=o(e),{link:e.attr(`href`),title:e.text()})),n.set(t.enclosure_url,r)}t.description+=e,t.enclosure_url=r[0].link,t.enclosure_type=`application/x-bittorrent`}if(d){let i=await n.get(t.link);if(!i){let e=await a({method:`get`,url:t.link}),r=s(e.data);i=await Promise.all(r(`.gdtm a`).toArray().map(e=>n.tryGet(r(e).attr(`href`),async()=>{let t=await a({method:`get`,url:r(e).attr(`href`)}),n=s(t.data);return n(`#img`).attr(`src`)}))),n.set(t.link,i)}t.description+=r(o.join(e,`templates/images-c6c5dab2.art`),{images:i})}return t})),{title:`${c||l||`Front Page`} - E-Hentai Galleries`,link:p,item:g}}export{c as route};