import"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CWQqZcqz.js";import"./helpers-RrXnNmv1.js";import{cache_default as e}from"./cache-CvppK6AM.js";import{got_default as t}from"./got-BwctkUCD.js";import*as n from"node:url";import r from"querystring";const i=`http://jw.scut.edu.cn`,a=i+`/dist/`,o=i+`/zhinan/cms/toNews.do`,s=i+`/zhinan/jw/api/v2/findNewsTrends.do`,c=i+`/zhinan/jw/api/v2/getArticleInfo.do`,l=e=>`${i}/zhinan/cms/article/view.do?type=posts&id=${e}`,u=e=>`${i}/dist/#/detail/index?id=${e}&type=news`,d=e=>{let t=8,n=e.getTimezoneOffset()/60;return new Date(e.getTime()-60*60*1e3*(t+n))},f=e=>{let t=new Date(e);return t.setHours(8),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),d(t)},p=e=>!!e.link,m=e=>e.replaceAll(`src="/`,`src="${n.resolve(i,`.`)}`).replaceAll(`href="/`,`href="${n.resolve(i,`.`)}`),h=e=>{if(!e.success)throw Error(`article api error`)},g=e=>e?`<p><img src="${e}"></p>`:``,_=e=>`<p>链接：<a href="${l(e)}">电脑版</a>&nbsp;|&nbsp;<a href="${u(e)}">手机版</a></p>`,v=e=>g(e.bannerUrl)+m(e.content)+_(e.id),y={path:`/jwc/news`,categories:[`university`],example:`/scut/jwc/news`,parameters:{},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`教务处新闻动态`,maintainers:[`imkero`],handler:b};async function b(){let n=r.stringify({pageNo:1,pageSize:20}),i=await t({method:`post`,url:`${s}?${n}`,headers:{Referer:a}});h(i.data);let u=i.data.data.list,d=await Promise.all(u.map(async n=>{let i=l(n.id),o=await e.get(i);if(o)return JSON.parse(o);let s=r.stringify({id:n.id,categoryType:``}),u=await t({method:`post`,url:`${c}?${s}`,headers:{Referer:a}});h(u.data);let d=u.data.data;d.id=n.id;let m=null;p(d)||(m=v(d));let g={title:d.name,link:i,description:m,pubDate:f(d.createDate).toUTCString()};return e.set(i,JSON.stringify(g)),g}));return{title:`华南理工大学教务处新闻动态`,link:o,item:d}}export{y as route};