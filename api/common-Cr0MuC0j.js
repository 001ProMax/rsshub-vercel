import{__dirname as e,init_esm_shims as t}from"./esm-shims-CtP6w_ML.js";import{rand_user_agent_default as n}from"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import{ofetch_default as r}from"./ofetch-CDAeBYLA.js";import{cache_default as i}from"./cache-7MGQxbL-.js";import{art as a}from"./render-DlHIMz-Z.js";import{parseDate as o}from"./parse-date-B2cCVoGk.js";import{ViewType as s}from"./types-DygLf1a3.js";import c from"node:path";import{load as l}from"cheerio";t();const u={path:`/:category/:topic?`,categories:[`traditional-media`,`popular`],view:s.Articles,example:`/reuters/world/us`,parameters:{category:{description:`find it in the URL, or tables below`,options:[{value:`world`,label:`World`},{value:`business`,label:`Business`},{value:`legal`,label:`Legal`},{value:`markets`,label:`Markets`},{value:`breakingviews`,label:`Breakingviews`},{value:`technology`,label:`Technology`},{value:`graphics`,label:`Graphics`},{value:`authors`,label:`Authors`}],default:`world`},topic:"find it in the URL, or tables below, leave empty for `All`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`reuters.com/:category/:topic?`,`reuters.com/`]}],name:`Category/Topic/Author`,maintainers:[`LyleLee`,`HenryQW`,`proletarius101`,`black-desk`,`nczitzk`,`pseudoyu`],handler:d,description:`-   \`:category\`:

      | World | Business | Legal | Markets | Breakingviews | Technology | Graphics |
      | ----- | -------- | ----- | ------- | ------------- | ---------- | -------- |
      | world | business | legal | markets | breakingviews | technology | graphics |

  -   \`world/:topic\`:

      | All | Africa | Americas | Asia Pacific | China | Europe | India | Middle East | United Kingdom | United States | The Great Reboot | Reuters Next |
      | --- | ------ | -------- | ------------ | ----- | ------ | ----- | ----------- | -------------- | ------------- | ---------------- | ------------ |
      |     | africa | americas | asia-pacific | china | europe | india | middle-east | uk             | us            | the-great-reboot | reuters-next |

  -   \`business/:topic\`:

      | All | Aerospace & Defense | Autos & Transportation | Energy | Environment | Finance | Healthcare & Pharmaceuticals | Media & Telecom | Retail & Consumer | Sustainable Business | Charged | Future of Health | Future of Money | Take Five | Reuters Impact |
      | --- | ------------------- | ---------------------- | ------ | ----------- | ------- | ---------------------------- | --------------- | ----------------- | -------------------- | ------- | ---------------- | --------------- | --------- | -------------- |
      |     | aerospace-defense   | autos-transportation   | energy | environment | finance | healthcare-pharmaceuticals   | media-telecom   | retail-consumer   | sustainable-business | charged | future-of-health | future-of-money | take-five | reuters-impact |

  -   \`legal/:topic\`:

      | All | Government | Legal Industry | Litigation | Transactional |
      | --- | ---------- | -------------- | ---------- | ------------- |
      |     | government | legalindustry  | litigation | transactional |

  -   \`authors/:topic\`:

      | Default | Jonathan Landay | any other authors |
      | ------- | --------------- | ----------------- |
      | reuters | jonathan-landay | their name in URL |

  More could be found in the URL of the category/topic page.`};async function d(t){let s=new Set([`authors`,`tags`]),u=[`world`],d=t.req.param(`category`),f=t.req.param(`topic`)??(d===`authors`?`reuters`:``),p=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`)):20,m=t.req.query(`sophi`)===`true`&&f!==``&&u.includes(d),h=`/${d}/${f?`${f}/`:``}`,g=n({browser:`chrome`,os:`windows`,device:`desktop`}),_={"User-Agent":g,Accept:`application/json, text/plain, */*`,"Accept-Language":`en-US,en;q=0.9`,Referer:`https://www.reuters.com/`};try{let{title:n,description:u,rootUrl:f,response:g}=await(async()=>{if(s.has(d)){let e=`https://www.reuters.com/pf/api/v3/content/fetch/articles-by-topic-v1`,t=await r(e,{query:{query:JSON.stringify({offset:0,size:p,topic_url:h,website:`reuters`})},headers:_});return{title:`${t.result.topics[0].name} | Reuters`,description:t.result.topics[0].entity_id,rootUrl:e,response:t}}else{let e=`https://www.reuters.com/pf/api/v3/content/fetch/articles-by-section-alias-or-id-v1`,t=await r(e,{query:{query:JSON.stringify({offset:0,size:p,section_id:h,website:`reuters`,...m?{fetch_type:`sophi`,sophi_page:`*`,sophi_widget:`topic`}:{}})},headers:_});return{title:t.result.section.title,description:t.result.section.section_about,rootUrl:e,response:t}}})(),v=g.result.articles.map(e=>({title:e.title,link:new URL(e.canonical_url,f).href,guid:e.id,pubDate:o(e.published_time),updated:o(e.updated_time),author:e.authors.map(e=>e.name).join(`, `),category:e.kicker.names,description:e.description}));v=v.filter((e,t)=>v.findIndex(t=>e.guid===t.guid)===t);let y=await Promise.allSettled(v.map(n=>t.req.query(`fulltext`)===`true`?i.tryGet(n.link,async()=>{let t=await r(n.link,{headers:_}),i=l(t.data);if(t.url.startsWith(`https://www.reuters.com/investigates/`)){let e=JSON.parse(i(`script[type="application/ld+json"]`).text());return i(`.special-report-article-container .container, #slide-dek, #slide-end, .share-in-article-container`).remove(),n.title=e.headline,n.pubDate=o(e.dateCreated),n.author=e.creator,n.category=e.keywords,n.description=i(`.special-report-article-container`).html(),n}let s=i(`script#fusion-metadata`).text().match(/Fusion.globalContent=({[\S\s]*?});/);if(s){let t=JSON.parse(s[1]);return n.title=t.result.title||n.title,n.description=a(c.join(e,`templates/description-073fbea1.art`),{result:t.result}),n.pubDate=o(t.result.display_time),n.author=t.result.authors.map(e=>e.name).join(`, `),n.category=t.result.taxonomy.keywords,n}return i(`.title`).remove(),i(`.article-metadata`).remove(),n.title=i(`meta[property="og:title"]`).attr(`content`),n.pubDate=o(t.data.match(/"datePublished":"(.*?)","dateModified/)[1]),n.author=t.data.match(/{"@type":"Person","name":"(.*?)"}/g).map(e=>e.match(/"name":"(.*?)"/)[1]).join(`, `),n.description=i(`article`).html(),n}):n));return v=y.filter(e=>e.status===`fulfilled`).map(e=>e.value),{title:n,description:u,image:`https://www.reuters.com/pf/resources/images/reuters/logo-vertical-default-512x512.png?d=116`,link:`https://www.reuters.com${h}`,item:v}}catch{let e=f?`https://www.reuters.com/arc/outboundfeeds/v4/mobile/section${h}?outputType=json`:`https://www.reuters.com/arc/outboundfeeds/v4/mobile/section/${d}/?outputType=json`,t=await r(e,{headers:_});if(t.wireitems?.length){let e=t.wireitems.map(e=>{let n=e.templates.find(e=>e.template===`story_with_image`)?.story;return n?{title:n.hed,link:e.templates.find(e=>e.template===`story_with_image`)?.template_action?.url,guid:n.usn,pubDate:o(n.updated_at),updated:o(n.updated_at),description:n.lede,author:n.authors?.map(e=>e.name).join(`, `),category:[t.analytics?.topic_channel,t.analytics?.topic_sub_channel].filter(Boolean)}:null}).filter(Boolean);return{title:t.analytics?.title||`${t.wire_name} | Reuters`,description:t.analytics?.content_title,image:`https://www.reuters.com/pf/resources/images/reuters/logo-vertical-default-512x512.png?d=116`,link:t.canonical_action?.url||`https://www.reuters.com${h}`,category:[t.analytics?.topic_channel,t.analytics?.topic_sub_channel].filter(Boolean),item:e.slice(0,p)}}}}export{u as route};