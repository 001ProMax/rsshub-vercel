import"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CWQqZcqz.js";import"./helpers-RrXnNmv1.js";import{cache_default as e}from"./cache-CvppK6AM.js";import{parseDate as t}from"./parse-date-DHsdom8D.js";import{got_default as n}from"./got-BwctkUCD.js";import{load as r}from"cheerio";const i={path:`/:path{.+}?`,radar:[{source:[`rfi.fr/*path`],target:`/:path`}],name:`Unknown`,maintainers:[],handler:a,url:`rfi.fr/*path`};async function a(i){let a=`https://www.rfi.fr/`,o=i.req.param(`path`)??`en`,s=`${a}${o.endsWith(`/`)?o:`${o}/`}`,c=await n(s),l=r(c.data);l(`aside[data-org-type="aside-content--highlighted"], aside[data-org-type="aside-content--sponsors"]`).remove();let u=l(`.article__title a`).toArray().map(e=>(e=l(e),{title:e.text(),link:new URL(e.attr(`href`),s).href}));return u=await Promise.all(u.map(i=>e.tryGet(i.link,async()=>{let e=await n(i.link),a=r(e.data);a(`.m-interstitial, .m-em-quote svg, .o-self-promo`).remove();let o=JSON.parse(a(`script[type="application/ld+json"]`).text()||`[]`).find(e=>e[`@type`]===`NewsArticle`);return i.description=a(`.t-content__chapo`).prop(`outerHTML`)+a(`.t-content__main-media`).prop(`outerHTML`)+a(`.t-content__body`).html(),i.pubDate=t(o?.datePublished),i.updated=t(o?.dateModified),i.author=o?.author.map(e=>e.name).join(`, `),i.category=o?.keywords.split(`,`),o?.audio&&(i.itunes_item_image=o.audio.thumbnailUrl,i.itunes_duration=o.audio.duration.match(/P0DT(\d+)H(\d+)M(\d+)S/).slice(1).map(e=>Number.parseInt(e)).reduce((e,t)=>e*60+t),i.enclosure_url=o.audio.contentUrl,i.enclosure_type=`audio/mpeg`),i}))),{title:l(`title`).text(),description:l(`meta[name="description"]`).attr(`content`),link:s,image:l(`meta[property="og:image"]`).attr(`content`),icon:new URL(l(`link[rel="apple-touch-icon"]`).attr(`href`),s).href,logo:new URL(l(`link[rel="apple-touch-icon"]`).attr(`href`),s).href,item:u,language:l(`html`).attr(`lang`)}}export{i as route};