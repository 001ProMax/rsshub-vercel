import{__dirname as e,init_esm_shims as t}from"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CWQqZcqz.js";import"./helpers-RrXnNmv1.js";import{cache_default as n}from"./cache-CvppK6AM.js";import{art as r}from"./render-DE4LRFBD.js";import{parseDate as i}from"./parse-date-DHsdom8D.js";import{got_default as a}from"./got-BwctkUCD.js";import o from"node:path";import{load as s}from"cheerio";t();const c={path:`/:source?/:id?`,categories:[`anime`],example:`/kemono`,parameters:{source:`Source, see below, Posts by default`,id:`User id, can be found in URL`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`kemono.su/:source/user/:id`,`kemono.su/`]}],name:`Posts`,maintainers:[`nczitzk`],handler:l,description:`Sources

| Posts | Patreon | Pixiv Fanbox | Gumroad | SubscribeStar | DLsite | Discord | Fantia |
| ----- | ------- | ------------ | ------- | ------------- | ------ | ------- | ------ |
| posts | patreon | fanbox       | gumroad | subscribestar | dlsite | discord | fantia |

::: tip
  When \`posts\` is selected as the value of the parameter **source**, the parameter **id** does not take effect.
  There is an optinal parameter **limit** which controls the number of posts to fetch, default value is 25.
:::`};async function l(t){let c=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`)):25,l=t.req.param(`source`)??`posts`,d=t.req.param(`id`),f=l===`posts`,p=`https://kemono.su`,m=`${p}/api/v1`,h=`${m}/discord/channel/lookup/${d}`,g=f?`${m}/posts`:`${m}/${l}/user/${d}`,_={cookie:`__ddg2=sBQ4uaaGecmfEUk7`},v=await a({method:`get`,url:l===`discord`?h:g,headers:_}),y,b,x;if(l===`discord`)b=`Posts of ${d} from Discord | Kemono`,y=await Promise.all(v.data.map(t=>n.tryGet(t.id,async()=>{let n=await a({method:`get`,url:`${p}/api/v1/discord/channel/${t.id}?o=0`,headers:_});return n.data.filter(e=>e.content||e.attachments).slice(0,c).map(n=>({title:n.content,description:r(o.join(e,`templates/discord-10e8038a.art`),{i:n}),author:`${n.author.username}#${n.author.discriminator}`,pubDate:i(n.published),category:t.name,guid:`kemono:${l}:${n.server}:${n.channel}:${n.id}`,link:`https://discord.com/channels/${n.server}/${n.channel}/${n.id}`}))}))),y=y.flat();else{let t=f?``:await u(g,_);b=f?`Kemono Posts`:`Posts of ${t} from ${l} | Kemono`,x=f?`${p}/favicon.ico`:`https://img.kemono.su/icons/${l}/${d}`;let n=f?v.data.posts:v.data;y=n.filter(e=>e.content||e.attachments).slice(0,c).map(n=>{n.files=[],`path`in n.file&&n.files.push({name:n.file.name,path:n.file.path,extension:n.file.path.replace(/.*\./,``).toLowerCase()});for(let e of n.attachments)n.files.push({name:e.name,path:e.path,extension:e.path.replace(/.*\./,``).toLowerCase()});let a=r(o.join(e,`templates/source-7bbf197e.art`),{i:n}),c=s(a),l=c(`img, a, audio, video`).map(function(){return c(this).prop(`outerHTML`)}),u=``;n.content&&(u+=`<div>${n.content}</div>`),c=s(u);let d=0,f=/downloads.fanbox.cc/;c(`a`).each(function(){let e=c(this).attr(`href`);f.test(e)&&(d++,c(this).replaceWith(l[d]))}),u=(l.length>0?l[0]:``)+c.html();for(let e of l.slice(d+1))u+=e;let h={};return s(u)(`audio source, video source`).each(function(){let e=c(this).attr(`src`)??``,t={m4a:`audio/mp4`,mp3:`audio/mpeg`,mp4:`video/mp4`}[e.replace(/.*\./,``).toLowerCase()]||null;t!==null&&(h={enclosure_url:new URL(e,p).toString(),enclosure_type:t})}),{title:n.title,description:u,author:t,pubDate:i(n.published),guid:`${m}/${n.service}/user/${n.user}/post/${n.id}`,link:`${p}/${n.service}/user/${n.user}/post/${n.id}`,...h}})}return{title:b,image:x,link:f?`${p}/posts`:l===`discord`?`${p}/${l}/server/${d}`:`${p}/${l}/user/${d}`,item:y}}async function u(e,t){let n=await a({method:`get`,url:`${e}/profile`,headers:t});return n.data.name}export{c as route};