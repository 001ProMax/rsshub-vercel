import{__dirname as e,init_esm_shims as t}from"./esm-shims-CtP6w_ML.js";import{config as n}from"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CWQqZcqz.js";import"./helpers-RrXnNmv1.js";import{cache_default as r}from"./cache-CvppK6AM.js";import{art as i}from"./render-DE4LRFBD.js";import{parseDate as a}from"./parse-date-DHsdom8D.js";import{got_default as o}from"./got-BwctkUCD.js";import s from"node:path";import{load as c}from"cheerio";import l from"p-map";t();const u={path:`/comic/:id/:chapterCnt?`,categories:[`anime`],example:`/copymanga/comic/dianjuren/5`,parameters:{id:`漫画ID`,chapterCnt:"返回章节的数量，默认为 `10`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`漫画更新`,maintainers:[`btdwv`,`marvolo666`],handler:d};async function d(t){let u=t.req.param(`id`),d=Number(t.req.param(`chapterCnt`)||10),f=`www.mangacopy.com`,p=`https://${f}`,m=`https://${f}`,h=`${m}/api/v3/comic/${u}/group/default/chapters`,g=500,_=await r.tryGet(h,async()=>{let e=!1,t=[],n=0;do{e=!1;let{data:r}=await o(h,{headers:{platform:1},searchParams:{limit:g,offset:n}}),{code:i,results:a}=r;if(i!==200)break;a.limit+a.offset<a.total&&(e=!0),n+=g,t=[...t,...a.list]}while(e);return t=t.map(({comic_path_word:e,uuid:t,name:n,size:r,datetime_created:i,ordered:o})=>({link:`${p}/comic/${e}/chapter/${t}`,guid:`https://copymanga.site/comic/${e}/chapter/${t}`,uuid:t,title:n,size:r,pubDate:a(i,`YYYY-MM-DD`),ordered:o})).sort((e,t)=>t.ordered-e.ordered),t},n.cache.routeExpire,!1),{bookTitle:v,bookIntro:y}=await r.tryGet(`${p}/comic/${u}`,async()=>{let{data:e}=await o(`${p}/comic/${u}`),t=c(e);return{bookTitle:t(`.comicParticulars-title-right > ul > li > h6`).text(),bookIntro:t(`.intro`).text()}}),b=async t=>{let{data:{code:n,results:r}}=await o(`${m}/api/v3/comic/${u}/chapter/${t.uuid}`,{headers:{webp:1}}),a=n===210?[]:r.chapter.contents.map(e=>({url:e.url.replace(`.c800x.`,`.c1500x.`)}));return{link:t.link,guid:t.guid,title:t.title,description:i(s.join(e,`templates/comic-da154ac8.art`),{size:t.size,contents:a}),pubDate:t.pubDate}},x=await l(_.slice(0,d),e=>r.tryGet(e.link,()=>b(e)),{concurrency:3}),S=[...x,..._.slice(d)];return{title:`拷贝漫画 - ${v}`,link:`${p}/comic/${u}`,description:y,item:S}}export{u as route};