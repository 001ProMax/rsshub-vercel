import{__dirname as e,init_esm_shims as t}from"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CWQqZcqz.js";import"./helpers-RrXnNmv1.js";import{cache_default as n}from"./cache-CvppK6AM.js";import{art as r}from"./render-DE4LRFBD.js";import{parseDate as i}from"./parse-date-DHsdom8D.js";import{got_default as a}from"./got-BwctkUCD.js";import o from"node:path";import s from"crypto-js";const c=`https://api.creative-comic.tw`,l=`web_desktop`,u=`freeforccc2020reading`,d=(e,t)=>a(`${c}/book/${e}/info`,{headers:{device:l,uuid:t}}),f=(e,t)=>a(`${c}/book/chapter/${e}`,{headers:{device:l,uuid:t}}),p=(e,t)=>a(`${c}/book/${e}/chapter`,{headers:{device:l,uuid:t}}),m=async(e,t)=>{let{data:n}=await a(`https://storage.googleapis.com/ccc-www/fs/chapter_content/encrypt/${e}/${t}`,{headers:{device:l},responseType:`buffer`});return Buffer.from(n).toString(`base64`)},h=(e,t)=>a(`${c}/book/chapter/image/${e}`,{headers:{device:l,uuid:t}}),g=e=>e(`creative-comic:uuid`,async()=>{let{data:e}=await a(`${c}/guest`,{headers:{device:l}});return e.data}),_=(e,t)=>s.AES.decrypt(e,s.enc.Hex.parse(t.key),{iv:s.enc.Hex.parse(t.iv),mode:s.mode.CBC,padding:s.pad.Pkcs7}).toString(s.enc.Utf8),v=e=>{let t=s.SHA512(e).toString();return{key:t.substring(0,64),iv:t.substring(30,62)}},y=(e,t=u)=>{let n=v(t),r=_(e,n),i=r.split(`:`);return{key:i[0],iv:i[1]}};t();const b={path:`/book/:id/:coverOnly?/:quality?`,categories:[`anime`],example:`/creative-comic/book/117`,parameters:{id:`漫畫 ID，可在 URL 中找到`,coverOnly:"僅獲取封面，非 `true` 時將獲取**全部**頁面，預設 `true`",quality:"閱讀品質，標準畫質 `1`，高畫質 `2`，預設 `1`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`creative-comic.tw/book/:id/*`],target:`/:id`}],name:`漫畫`,maintainers:[`TonyRL`],handler:x};async function x(t){let{id:a,coverOnly:s=`true`,quality:l=`1`}=t.req.param(),u=await g(n.tryGet),{data:{data:v}}=await d(a,u),{data:{data:b}}=await p(a,u),x=await Promise.all(b.chapters.sort((e,t)=>t.idx-e.idx).slice(0,t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`),10):3).map(async t=>{let a;if(s!==`true`&&s!==`1`){let{data:{data:e}}=await f(t.id,u);(e.chapter.free_day===null||e.chapter.free_day===0)&&(a=await Promise.all(e.chapter.proportion.map(async e=>{let{data:t}=await h(e.id,u);t=t.data.key;let r=y(t),i=await m(e.id,l);return n.tryGet(`${c}/fs/chapter_content/encrypt/${e.id}/${l}`,()=>_(i,r))})))}return{title:t.vol_name,description:r(o.join(e,`templates/chapter-a1c569be.art`),{chapter:t,pages:a,cover:t.image1}),pubDate:i(t.online_at),updated:i(t.updated_at),link:`https://www.creative-comic.tw/reader_comic/${t.id}`,author:v.author.map(e=>e.name).join(`, `),category:v.tags.map(e=>e.name)}}));return{title:`${v.name} | CCC創作集`,description:`${v.brief} ${v.description}`,link:v.share_link,image:v.image1,item:x,language:`zh-hant`}}export{b as route};