import{__dirname as e,init_esm_shims as t}from"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CDAeBYLA.js";import"./helpers-RrXnNmv1.js";import{cache_default as n}from"./cache-7MGQxbL-.js";import{art as r}from"./render-DlHIMz-Z.js";import{got_default as i}from"./got-Cw4D6IS5.js";import{ViewType as a}from"./types-DygLf1a3.js";import o from"node:path";import{load as s}from"cheerio";t();const c={"User-Agent":`Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1`},l={path:`/:userid`,categories:[`social-media`,`popular`],view:a.Audios,example:`/changba/skp6hhF59n48R-UpqO3izw`,parameters:{userid:`用户ID, 可在对应分享页面的 URL 中找到`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!0,supportScihub:!1},radar:[{source:[`changba.com/s/:userid`]}],name:`用户`,maintainers:[`kt286`,`xizeyoupan`,`pseudoyu`],handler:u};async function u(t){let a=t.req.param(`userid`),l=`https://changba.com/wap/index.php?s=${a}`,u=await i({method:`get`,url:l,headers:c}),d=u.data,f=s(d),p=f(`.user-work .work-info`).get(),m=f(`div.user-main-info > span.txt-info > a.uname`).text(),h=f(`div.user-main-info > .poster > img`).attr(`data-src`),g=await Promise.all(p.map(async t=>{let a=s(t),l=a(`a`).attr(`href`),u=await n.tryGet(l,async()=>{let e=await i({method:`get`,url:l,headers:c}),t=/workid: '\d+'/,n;try{n=e.data.match(t)[0]}catch{return null}return n=n.split(`'`)[1],n},60*60*24);if(!u)return null;let d=`https://upscuw.changba.com/${u}.mp3`,f=r(o.join(e,`templates/work_description-7637ee4a.art`),{desc:a(`div.des`).text(),mp3url:d}),p=a(`div.work-cover`).attr(`style`).replace(`)`,``).split(`url(`)[1];return{title:a(`.work-title`).text(),description:f,link:l,author:m,itunes_item_image:p,enclosure_url:d,enclosure_type:`audio/mpeg`}}));return g=g.filter(Boolean),{title:m+` - 唱吧`,link:l,description:f(`meta[name="description"]`).attr(`content`)||m+` - 唱吧`,item:g,image:h,itunes_author:m,itunes_category:`唱吧`}}export{l as route};