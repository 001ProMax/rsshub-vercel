import{__dirname as e,init_esm_shims as t}from"./esm-shims-CtP6w_ML.js";import{cache_default as n}from"./cache-CvppK6AM.js";import{art as r}from"./render-DE4LRFBD.js";import{parseRelativeDate as i}from"./parse-date-DHsdom8D.js";import{got_default as a}from"./got-BwctkUCD.js";import{timezone as o}from"./timezone-CCdTtC9I.js";import s from"node:path";import{load as c}from"cheerio";import{base32 as l}from"rfc4648";t();const u=`https://www.zaobao.com`,d=a.extend({headers:{Referer:u}}),f=async(t,a)=>{let l=await d.get(u+a),f=c(l.data),h=f(`.card-listing .card`);h.length===0&&(h=f(`.clearfix`).find(`.list-block`));let g=f(`meta[property="og:title"]`).attr(`content`),_=await Promise.all(h.toArray().map(t=>{let a=f(t),l=a.find(`a`).addBack(`a`)[0].attribs.href;if(l[0]!==`/`){let e=a.find(`a`).text(),t=a.find(`.meta-published-date`);t.length===0&&(t=a.find(`.datestamp`));let n,r;if(t.length!==0){n=t.text().trim();let e=n.split(`/`);e.reverse(),n=e.join(`-`),r=i(n),r=r===n?void 0:o(r,8)}return{title:e,description:e,pubDate:r,link:l}}return l=u+l,n.tryGet(l,async()=>{let t=await d.get(l),n=c(t.data),i,a;if(n(`#seo-article-page`).text()===``){i=n(`h1.article-title`).text();let e=n(`head script[type='application/ld+json']`).eq(1).text().replaceAll(/[\u0000-\u001F\u007F-\u009F]/g,``);a=new Date(JSON.parse(e)?.datePublished)}else{let e=n(`#seo-article-page`).text().replaceAll(/[\u0000-\u001F\u007F-\u009F]/g,``),t=JSON.parse(e);i=t[`@graph`][0]?.headline,a=new Date(t[`@graph`][0]?.datePublished)}n(`.overlay-microtransaction`).remove(),n(`#video-freemium-player`).remove(),n(`script`).remove(),n(`.bff-google-ad`).remove();let o=n(`.articleBody`);o.length===0&&(p(n(`.article-body`)),o=n(`.article-body`));let u=o.html(),f=m(n);return{title:i,description:r(s.join(e,`templates/zaobao-1e13b3a5.art`),{articleBody:u,imageDataArray:f}),pubDate:a,link:l}})}));return{title:g,resultList:_}},p=e=>{for(let[t,n]of e.children().toArray().sort((t,n)=>{let r=Buffer.from(l.parse(`GM======`)).toString();return t=Buffer.from(l.parse(e.find(t).data(`s`).substring(r))).toString(),n=Buffer.from(l.parse(e.find(n).data(`s`).substring(r))).toString(),t-n}).entries())e.find(n).attr(`s`,t),e.append(n)},m=e=>{let t=[],n=[`.inline-figure-img`,`.body-content .loadme picture img`,`.inline-figure-gallery`,`#carousel-article`];for(let r of n)if(e(r).length){let n=e(r===`#carousel-article`?`#carousel-article .carousel-inner`:r).html();n&&(n=n.replaceAll(/\/\/.*\.com\/s3fs-public/g,`//static.zaobao.com/s3fs-public`).replaceAll(`s3/files`,`s3fs-public`),t.push({type:r===`.body-content .loadme picture img`?`data`:`normalHTML`,html:n,...r===`.body-content .loadme picture img`&&{src:e(`.body-content .loadme picture source`).attr(`data-srcset`),title:e(r).attr(`title`)}}))}return t};export{f as parseList$9};