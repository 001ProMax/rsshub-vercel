import{__dirname as e,init_esm_shims as t}from"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CWQqZcqz.js";import"./helpers-RrXnNmv1.js";import{cache_default as n}from"./cache-CvppK6AM.js";import{art as r}from"./render-DE4LRFBD.js";import{parseDate as i}from"./parse-date-DHsdom8D.js";import{got_default as a}from"./got-BwctkUCD.js";import{timezone as o}from"./timezone-CCdTtC9I.js";import s from"node:path";import{load as c}from"cheerio";import l from"sanitize-html";import u from"p-map";const d=`http://www.kcna.kp`,f=(e,t)=>{let n=e(t);return n.find(`.fSpecCs`).each((t,n)=>{n.parent.name===`nobr`&&e(n).unwrap(),n.name=`b`,n.attribs={}}),t.html()},p=(e,t)=>n.tryGet(t,async()=>{let e=await a(t),n=c(e.data),r=``;return n(`.content img`).each((e,t)=>{let n=t.attribs.src;n&&(r+=r?`<br><img src="${n}">`:`<img src="${n}">`)}),r}),m=(e,t)=>n.tryGet(t,async()=>{let e=await a(t),n=c(e.data),r=n(`script[type="text/javascript"]:not([src])`).html(),i=r.match(/<[^>]*source[^>]+src[^>]+>/g);return i&&=i.map(e=>e.replaceAll(`'`,`"`).replaceAll(/src="([^"]+)"/g,`src="${d}$1"`)),`<video controls preload="metadata">${i.join(`
`)}</video>`});t();const h={path:`/:lang/:category?`,categories:[`traditional-media`],example:`/kcna/en`,parameters:{lang:`Language, refer to the table below`,category:`Category, refer to the table below`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`www.kcna.kp/:lang`,`www.kcna.kp/:lang/category/articles/q/1ee9bdb7186944f765208f34ecfb5407.kcmsf`,`www.kcna.kp/:lang/category/articles.kcmsf`],target:`/:lang`}],name:`News`,maintainers:[`Rongronggg9`],handler:g,description:"| Language | 조선어 | English | 中国语 | Русский | Español | 日本語 |\n| -------- | ------ | ------- | ------ | ------- | ------- | ------ |\n| `:lang`  | `kp`   | `en`    | `cn`   | `ru`    | `es`    | `jp`   |\n\n| Category                                                         | `:category`                        |\n| ---------------------------------------------------------------- | ---------------------------------- |\n| WPK General Secretary **Kim Jong Un**'s Revolutionary Activities | `54c0ca4ca013a92cc9cf95bd4004c61a` |\n| Latest News (default)                                            | `1ee9bdb7186944f765208f34ecfb5407` |\n| Top News                                                         | `5394b80bdae203fadef02522cfb578c0` |\n| Home News                                                        | `b2b3bcc1b0a4406ab0c36e45d5db58db` |\n| Documents                                                        | `a8754921399857ebdbb97a98a1e741f5` |\n| World                                                            | `593143484cf15d48ce85c26139582395` |\n| Society-Life                                                     | `93102e5a735d03979bc58a3a7aefb75a` |\n| External                                                         | `0f98b4623a3ef82aeea78df45c423fd0` |\n| News Commentary                                                  | `12c03a49f7dbe829bceea8ac77088c21` |"};async function g(t){let{lang:d,category:h=`1ee9bdb7186944f765208f34ecfb5407`}=t.req.param(),g=`http://www.kcna.kp`,_=`${g}/${d}/category/articles/q/${h}.kcmsf`,v=await a(_),y=c(v.data),b=l(y(`head > title`).text(),{allowedTags:[],allowedAttributes:{}}),x=y(`.article-link li a`).map((e,t)=>{t=y(t);let n=t.find(`.publish-time`),r=n.text().match(/\d+\.\d+\.\d+/);return n.remove(),{title:t.text(),link:g+t.attr(`href`),pubDate:o(i(r[0]),9)}}).get(),S=await u(x,l=>n.tryGet(l.link,async()=>{let n=await a(l.link),u=c(n.data);l.title=u(`article-main-title`).text()||l.title;let d=u(`.publish-time`),h=d.text().match(/\d+\.\d+\.\d+/);d.remove(),l.pubDate=h?o(i(h[0]),9):l.pubDate;let _=f(u,u(`.article-content-body .content-wrapper`)),v=u(`.media-icon a`).map((e,t)=>g+t.attribs.href).get(),y,b;return await Promise.all(v.map(async e=>{e.includes(`/photo/`)?y=await p(t,e):e.includes(`/video/`)&&(b=await m(t,e))})),l.description=r(s.join(e,`templates/news-b7c0d7df.art`),{description:_,photo:y,video:b}),l}),{concurrency:3});return{title:b,link:_,item:S}}export{h as route};