import{__dirname as e,init_esm_shims as t}from"./esm-shims-CtP6w_ML.js";import{config as n}from"./config-DYqAlsU3.js";import{art as r}from"./render-DlHIMz-Z.js";import i from"node:path";import{google as a}from"googleapis";t();const{OAuth2:o}=a.auth;let s=0;const c={};if(n.youtube&&n.youtube.key){let e=n.youtube.key.split(`,`);for(let[t,n]of e.entries())n&&(c[t]=a.youtube({version:`v3`,auth:n}),s=t+1)}let l=-1;const u=async e=>{let t;for(let n=0;n<s;n++){l++;try{t=await e(c[l%s]);break}catch{}}return t};let d;n.youtube&&n.youtube.clientId&&n.youtube.clientSecret&&n.youtube.refreshToken&&(d=new o(n.youtube.clientId,n.youtube.clientSecret,`https://developers.google.com/oauthplayground`),d.setCredentials({refresh_token:n.youtube.refreshToken}));const f=(e,t,r)=>r.tryGet(`youtube:getPlaylistItems:${e}`,async()=>{let n=await u(n=>n.playlistItems.list({part:t,playlistId:e,maxResults:50}));return n},n.cache.routeExpire,!1),p=(e,t,n)=>n.tryGet(`youtube:getPlaylist:${e}`,async()=>{let n=await u(n=>n.playlists.list({part:t,id:e}));return n}),m=(e,t,n)=>n.tryGet(`youtube:getChannelWithId:${e}`,async()=>{let n=await u(n=>n.channels.list({part:t,id:e}));return n}),h=(e,t,n)=>n.tryGet(`youtube:getChannelWithUsername:${e}`,async()=>{let n=await u(n=>n.channels.list({part:t,forUsername:e}));return n}),g=e=>e.maxres||e.standard||e.high||e.medium||e.default,_=e=>e.replaceAll(/\r\n|\r|\n/g,`<br>`),v=(t,n,a,o)=>r(i.join(e,`templates/description-e0f4b632.art`),{embed:t,videoId:n,img:a,description:o}),y=async(e,t)=>{let r=await t.get(`youtube:accessToken`,!1);if(!r){let e=await d.getAccessToken();r=e.token,await t.set(`youtube:accessToken`,r,3600)}return d.setCredentials({access_token:r,refresh_token:n.youtube.refreshToken}),t.tryGet(`youtube:getSubscriptions`,()=>b(e),n.cache.routeExpire,!1)};async function b(e,t){let n=await a.youtube(`v3`).subscriptions.list({auth:d,part:e,mine:!0,maxResults:50,pageToken:t??void 0});if(n.data.nextPageToken){let t=await b(e,n.data.nextPageToken);n.data.items=[...n.data.items,...t.data.items]}return n}const x=e=>/^UC[\w-]{21}[AQgw]$/.test(e),S=(e,t)=>t.tryGet(`youtube:getLive:${e}`,async()=>{let t=await u(t=>t.search.list({part:`snippet`,channelId:e,eventType:`live`,type:`video`}));return t}),C=e=>`https://www.youtube-nocookie.com/embed/${e}?controls=1&autoplay=1&mute=0`,w=(e,t=!0)=>t&&(e.startsWith(`UC`)||e.startsWith(`UU`))?`UULF`+e.slice(2):e,T={getPlaylistItems:f,getPlaylist:p,getChannelWithId:m,getChannelWithUsername:h,getThumbnail:g,formatDescription:_,renderDescription:v,getSubscriptions:y,getSubscriptionsRecusive:b,isYouTubeChannelId:x,getLive:S,getVideoUrl:C,getPlaylistWithShortsFilter:w};var E=T;export{C as getVideoUrl$1,E as utils_default$9};