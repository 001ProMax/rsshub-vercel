import"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CDAeBYLA.js";import"./helpers-RrXnNmv1.js";import{cache_default as e}from"./cache-7MGQxbL-.js";import{got_default as t}from"./got-Cw4D6IS5.js";import{rss_parser_default as n}from"./rss-parser-CSgwUI7l.js";import r from"dayjs";import{load as i}from"cheerio";import a from"dayjs/plugin/utc.js";import o from"dayjs/plugin/timezone.js";r.extend(a),r.extend(o);const s=`phoronix:redirect`,c=`phoronix:web-articles`,l=`phoronix:articles`,u=`https://www.phoronix.com`,d=`${u}/rss.php`,f=async()=>{let e=await n.parseURL(d);return{title:e.title,link:e.link,description:e.description,item:e.items,language:e.language,icon:`https://www.phoronix.com/android-chrome-192x192.png`,image:`https://www.phoronix.com/android-chrome-192x192.png`,logo:`https://www.phoronix.com/phxcms7-css/phoronix.png`,category:[`Linux Hardware Reviews`,`Linux hardware benchmarks`,`Linux Hardware`,`Linux benchmarking`,`Desktop Linux`,`GNU/Linux benchmarks`,`Open Source AMD`,`Linux How To`,`X.Org drivers`,`Ubuntu hardware`,`Phoronix Test Suite`]}},p=e=>{let t=i(e.body);return{title:t(`title`).text(),link:e.url,description:t(`meta[name="Description"]`).attr(`content`),item:[...new Set(t(`#main a`).toArray().map(e=>e.attribs.href))].filter(e=>e&&(e.startsWith(`/review/`)||e.startsWith(`/news/`))).map(e=>({link:`${u}${e}`})),language:`en-us`,icon:`https://www.phoronix.com/android-chrome-192x192.png`,image:`https://www.phoronix.com/android-chrome-192x192.png`,logo:`https://www.phoronix.com/phxcms7-css/phoronix.png`,category:t(`meta[name="keywords"]`).attr(`content`).split(`, `)}},m=n=>e.tryGet(`${c}:${n}`,async()=>{try{return p(await t(n))}catch(e){if((e.name===`HTTPError`||e.name===`FetchError`)&&e.response.statusCode===404)return`404`;throw e}}),h=async(n,r)=>{let i=new URL(`/scan.php`,u);i.searchParams.set(`page`,n),r&&(n===`category`?i.searchParams.set(`item`,r):i.searchParams.set(`q`,r));let a,o=await e.tryGet(`${s}:${i.toString()}`,async()=>(a=await t(i.toString()),a.url));if(a){let t=p(a);return e.set(`${c}:${o}`,t),t}return await m(o)},g=async(e,t)=>{let n=t?`${u}/${e}/${t}`:`${u}/${e}`,r=await m(n);return r===`404`&&(r=await h(e,t)),r},_={path:`/:category?/:topic?`,categories:[`new-media`,`popular`],example:`/phoronix/linux/KDE`,parameters:{category:`Category`,topic:"Topic. You may find available parameters from their navigator links. E.g. to subscribe to `https://www.phoronix.com/reviews/Operating+Systems`, fill in the path `/phoronix/reviews/Operating+Systems`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`phoronix.com/:category?/:topic?`]}],name:`News & Reviews`,maintainers:[`oppliate`,`Rongronggg9`],handler:v};async function v(n){let{category:a,topic:o}=n.req.param(),s;switch(a){case`category`:case`news_topic`:s=await h(a,o);break;case`rss`:s=await f();break;default:s=a?await g(a,o):await f();break}return s.item=await Promise.all(s.item.map(n=>e.tryGet(`${l}:${n.link}`,async()=>{let a=await t(n.link),o=a.body,s=i(o),c=s(`.content`),l=s(`.author > a`),d=l.slice(0,-2).toArray().map(e=>s(e).text()),f=[];n.link.includes(`/news/`)?f.push(`News`):n.link.includes(`/review/`)&&f.push(`Review`);let p=l.eq(-2);p.length&&f.push(p.text());let m;if(!n.pubDate){let e=p.length&&p[0].nextSibling?.nodeValue;e&&(e=e.replaceAll(/on|at|\./g,``).trim(),m=/\d{4}$/.test(e)?r.utc(`${e} 08:00 UTC`).tz(`America/Indiana/Indianapolis`,!0):r(e),m.isValid()||(m=e))}let h=s(`.pagination > a`).toArray().map(e=>`${u}${e.attribs.href}`).slice(0,-1);if(h.length){let n=await Promise.all(h.map(n=>e.tryGet(n,async()=>{let e=await t(n),r=e.data,a=i(r),o=a(`.content`);return o.html()})));c.append(n)}let g=c.find(`img`),_=g.first();if(_.attr(`src`)?.startsWith(`/assets/categories/`)){let e=_.parent();e.text().trim()?_.remove():e.remove()}return g.each((e,t)=>{t.attribs.src=t.attribs.src.replace(/_med$/,``)}),{title:n.title||s(`article h1`).text(),pubDate:n.pubDate||m,author:d.join(`, `),link:n.link,summary:s(`meta[name="twitter:description"]`).attr(`content`),description:c.html(),image:s(`meta[name="twitter:image"]`).attr(`content`),category:n.category||f}}))),s}export{_ as route};