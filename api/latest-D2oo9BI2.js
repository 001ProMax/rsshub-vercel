import{__dirname as e,init_esm_shims as t}from"./esm-shims-CtP6w_ML.js";import{config as n}from"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import{ofetch_default as r}from"./ofetch-CDAeBYLA.js";import"./helpers-RrXnNmv1.js";import{cache_default as i}from"./cache-7MGQxbL-.js";import{art as a}from"./render-DlHIMz-Z.js";import{got_default as o}from"./got-Cw4D6IS5.js";import{ViewType as s}from"./types-DygLf1a3.js";import c from"node:path";import l from"crypto";import{load as u}from"cheerio";import{KJUR as d,hextob64 as f}from"jsrsasign";const p=`-----BEGIN PRIVATE KEY-----MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCLci8q2u3NGFyFlMUwjCP91PsvGjHdRAq9fmqZLxvue+n+RhzNxnKKYOv35pLgFKWXsGq2TV+5Xrv6xZgNx36IUkqbmrO+eCa8NFmti04wvMfG3DCNdKA7Lue880daNiK3BOhlQlZPykUXt1NftMNS/z+e70W+Vpv1ZxCx5BipqZkdoceM3uin0vUQmqmHqjxi5qKUuov90dXLaMxypCA0TDsIDnX8RPvPtqKff1p2TMW2a0XYe7CPYhRggaQMpmo0TcFutgrM1Vywyr2TPxYR+H/tpuuWRET7tUIQykBYoO1WKfL2dX6cxarjAJfnYnod3sMzppHouyp8Pt7gHVG7AgMBAAECggEAEFshSy6IrADKgWSUyH/3jMNZfwnchW6Ar/9O847CAPQJ2yhQIpa/Qpnhs58Y5S2myqcHrUBgFPcWp3BbyGn43naAh8XahWHEcVjWl/N6BV9vM1UKYN0oGikDR3dljCBDbCIoPBBO3WcFOaXoIpaqPmbwCG1aSdwQyPUA0UzG08eDbuHK6L5jvbe3xv5kLpWTVddrocW+SakbZRAX1Ykp7IujOce235nM7GOfoq4b8jmK5CLg6VIZGQV20wnn9YxuFOndRSjneFberzfzBMhVLpPsQ16M2xDLpZaDTggZnq2L6nZygds8Hda++ga3WbD3TcgjJNYuENu1S88IowYhSQKBgQDFqRA+38mo6KsxVDCNWcuEk2hSq8NEUzRHJpS7/QjZmEIYpFzDXgSGwhZJ0WNsQtaxJeBbc7B/OOqh8TL1reLl5AdTimS1OLHWVf/MUsLVS7Y82hx/hpYWxZnRSq41oI3P8FO/53FiQMYo2wbwqF6uQjB1y8h58aqL3OYpTH/5xQKBgQC0mobALJ+bU4nCPzkVDZuD6RyNWPwS1aE3+925wDSN2rJ0iLIb4N5czWZmHb66VlAtfGbp2q+amsCV4r6UR19A/y8k9SFB0mdtxix6mjEfaGhVJm4B1mkvsn0OHMAanKkohUvCjROQc3sziyp2gqSEQ98G7//VMPx/3dhgyQpVfwKBgQCycsqu6N0n+D6t/0MCKiJaI7bYhCd7JN8aqVM4UN5PjG2Hz8PLwbK2cr0qkbaAA+vN7NMb3Vtn0FvMLnUCZqVlRTP0EQqQrYmoZuXUcpdhd8QkNgnqe/g+wND4qcKTucquA1uo8mtj9/Su5+bhGDC6hBk6D+uDZFHDiX/loyIavQKBgQCXF6AcLjjpDZ52b8Yloti0JtXIOuXILAlQeNoqiG5vLsOVUrcPM7VUFlLQo5no8kTpiOXgRyAaS9VKkAO4sW0zR0n9tUY5dvkokV6sw0rNZ9/BPQFTcDlXug99OvhMSzwJtlqHTNdNRg+QM6E2vF0+ejmf6DEz/mN/5e0cK5UFqQKBgCR2hVfbRtDz9Cm/P8chPqaWFkH5ulUxBpc704Igc6bVH5DrEoWo6akbeJixV2obAZO3sFyeJqBUqaCvqG17Xei6jn3Hc3WMz9nLrAJEI9BTCfwvuxCOyY0IxqAAYT28xYv42I4+ADT/PpCq2Dj5u43X0dapAjZBZDfVVis7q1Bw-----END PRIVATE KEY-----`;async function m(e){if(!n.caixin.cookie||!/(\d+)\.html/.test(e))return;let t=e.match(/(\d+)\.html/)[1],i=l.randomUUID().replaceAll(`-`,``).toUpperCase(),a=n.caixin.cookie.split(`;`).find(e=>e.includes(`SA_USER_UID`))?.split(`=`)[1],o=`id=${t}&uid=${a}&${i}=nonce`,s=new d.crypto.Signature({alg:`SHA256withRSA`});s.init(p),s.updateString(o);let c=f(s.sign()),u=e.includes(`weekly`),m=await r(`https://gateway.caixin.com/api/newauth/checkAuthByIdJsonp`,{params:{type:1,page:u?0:1,rand:Math.random(),id:t},headers:{"X-Sign":encodeURIComponent(c),"X-Nonce":encodeURIComponent(i),Cookie:n.caixin.cookie}}),{content:h=``,pictureList:g}=JSON.parse(m.data.match(/resetContentInfo\((.*)\)/)[1]);return h+(g?g.map(e=>`<img src="${e.url}" id="picture_${e.id}" alt="${e.desc}"><dl><dt>${e.desc}</dt></dl>`).join(``):``)}t();const h=async t=>{if(/\.blog\.caixin\.com$/.test(new URL(t.link).hostname))return g(t);{let{data:n}=await o(t.link),r=u(n);return t.description=a(c.join(e,`templates/article-4c9fbe32.art`),{item:t,$:r}),t.audio&&(t.itunes_item_image=t.audio_image_url,t.enclosure_url=t.audio,t.enclosure_type=`audio/mpeg`),t}},g=async e=>{let t=await o(e.link),n=u(t.data),r=n(`#the_content`).removeAttr(`style`);return r.find(`img`).removeAttr(`style`),r.find(`p`).filter((e,t)=>t.children[0].data===String.fromCodePoint(160)).remove(),e.description=r.html(),e},_={path:`/latest`,categories:[`traditional-media`,`popular`],view:s.Articles,example:`/caixin/latest`,parameters:{},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`caixin.com/`]}],name:`最新文章`,maintainers:[`tpnonthealps`],handler:v,url:`caixin.com/`,description:"说明：此 RSS feed 会自动抓取财新网的最新文章，但不包含 FM 及视频内容。订阅用户可根据文档设置环境变量后，在url传入`fulltext=`以解锁全文。"};async function v(e){let{data:t}=await o(`https://gateway.caixin.com/api/dataplatform/scroll/index`),n=t.data.articleList.map(e=>({title:e.title,link:e.url,pubDate:e.time,category:e.channelObject.name})).filter(e=>!e.link.startsWith(`https://fm.caixin.com/`)&&!e.link.startsWith(`https://video.caixin.com/`)&&!e.link.startsWith(`https://datanews.caixin.com/`)),r=await Promise.all(n.map(t=>i.tryGet(`caixin:latest:${t.link}`,async()=>{let n=await h(t);if(e.req.query(`fulltext`)===`true`){let e=await m(t.link);t.description=e===``?n.description:e}else t.description=n.description;return t.guid=`caixin:latest:${t.link}`,{...n,...t}})));return{title:`财新网 - 最新文章`,link:`https://www.caixin.com/`,item:r}}export{_ as route};