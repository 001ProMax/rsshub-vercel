import"./esm-shims-CtP6w_ML.js";import{config as e}from"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CDAeBYLA.js";import"./helpers-RrXnNmv1.js";import{cache_default as t}from"./cache-7MGQxbL-.js";import{parseDate as n}from"./parse-date-B2cCVoGk.js";import{got_default as r}from"./got-Cw4D6IS5.js";import{ViewType as i}from"./types-DygLf1a3.js";import{timezone as a}from"./timezone-1BLOtscE.js";import{fallback as o,queryToBoolean as s}from"./readable-social-Dld9apEb.js";import{utils_default$10 as c}from"./utils-BZW6UCpZ.js";import l from"querystring";const u={path:`/user/:uid/:routeParams?`,categories:[`social-media`,`popular`],view:i.SocialMedia,example:`/weibo/user/1195230310`,parameters:{uid:"用户 id, 博主主页打开控制台执行 `$CONFIG.oid` 获取",routeParams:"额外参数；请参阅上面的说明和表格；特别地，当 `routeParams=1` 时开启微博视频显示"},features:{requireConfig:[{name:`WEIBO_COOKIES`,optional:!0,description:``}],requirePuppeteer:!1,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`m.weibo.cn/u/:uid`,`m.weibo.cn/profile/:uid`],target:`/user/:uid`},{source:[`weibo.com/u/:uid`],target:`/user/:uid`},{source:[`www.weibo.com/u/:uid`],target:`/user/:uid`}],name:`博主`,maintainers:[`DIYgod`,`iplusx`,`Rongronggg9`,`Konano`],handler:d,description:`::: warning
  部分博主仅登录可见，未提供 Cookie 的情况下不支持订阅，可以通过打开 \`https://m.weibo.cn/u/:uid\` 验证
:::`};async function d(i){let u=i.req.param(`uid`),d=`1`,f=`0`,p=`0`,m=`1`,h=`0`;if(i.req.param(`routeParams`))if(i.req.param(`routeParams`)===`1`||i.req.param(`routeParams`)===`0`)d=i.req.param(`routeParams`);else{let e=l.parse(i.req.param(`routeParams`));d=o(void 0,s(e.displayVideo),!0)?`1`:`0`,f=o(void 0,s(e.displayArticle),!1)?`1`:`0`,p=o(void 0,s(e.displayComments),!1)?`1`:`0`,m=o(void 0,s(e.showRetweeted),!1)?`1`:`0`,h=o(void 0,s(e.showBloggerIcons),!1)?`1`:`0`}let g=await t.tryGet(`weibo:user:index:${u}`,async()=>{let t=await r({method:`get`,url:`https://m.weibo.cn/api/container/getIndex?type=uid&value=${u}`,headers:{Referer:`https://m.weibo.cn/u/${u}`,"MWeibo-Pwa":1,"X-Requested-With":`XMLHttpRequest`,Cookie:e.weibo.cookies}});return t.data},e.cache.routeExpire,!1),_=g.data.userInfo.screen_name,v=g.data.userInfo.description,y=g.data.userInfo.profile_image_url,b=g.data.tabsInfo.tabs.find(e=>e.tab_type===`weibo`).containerid,x=await t.tryGet(`weibo:user:cards:${u}:${b}`,async()=>{let t=await r({method:`get`,url:`https://m.weibo.cn/api/container/getIndex?type=uid&value=${u}&containerid=${b}`,headers:{Referer:`https://m.weibo.cn/u/${u}`,"MWeibo-Pwa":1,"X-Requested-With":`XMLHttpRequest`,Cookie:e.weibo.cookies}});return t.data.data.cards},e.cache.routeExpire,!1),S=await Promise.all(x.filter(e=>!(e.mblog===void 0||m===`0`&&e.mblog.retweeted_status)).map(async e=>{let{bid:r}=e.mblog;if(r===``){let t=new URL(e.scheme);r=t.searchParams.get(`mblogid`),e.mblog.bid=r}let o=`weibo:user:${r}`,s=await t.tryGet(o,()=>c.getShowData(u,r));s&&s.text?(e.mblog.text=s.text,e.mblog.created_at=n(s.created_at),e.mblog.pics=s.pics,e.mblog.retweeted_status&&s.retweeted_status&&(e.mblog.retweeted_status.created_at=s.retweeted_status.created_at)):e.mblog.created_at=a(e.mblog.created_at,8);let l=e.mblog.retweeted_status;if(l&&l.isLongText){let n=await t.tryGet(`weibo:retweeted:${l.user.id}:${l.bid}`,()=>c.getShowData(l.user.id,l.bid));n!==void 0&&n.text&&(e.mblog.retweeted_status.text=n.text)}let m=c.formatExtended(i,e.mblog,u),g=m.description;return d===`1`&&(g=e.mblog.retweeted_status?c.formatVideo(g,e.mblog.retweeted_status):c.formatVideo(g,e.mblog)),p===`1`&&(g=await c.formatComments(i,g,e.mblog,h)),f===`1`&&(g=await(e.mblog.retweeted_status?c.formatArticle(i,g,e.mblog.retweeted_status):c.formatArticle(i,g,e.mblog))),{...m,description:g,isPinned:e.profile_type_id?.startsWith(`proweibotop`)}})),C=S.filter(e=>e.isPinned),w=S.filter(e=>!e.isPinned);if(C.length>0&&w.length>0){let e=Math.min(...w.map(e=>e.pubDate).filter(Boolean));S=w;for(let t of C)t.pubDate>e&&S.unshift(t)}return c.sinaimgTvax({title:`${_}的微博`,link:`https://weibo.com/${u}/`,description:v,image:y,item:S,allowEmpty:!0})}export{u as route};