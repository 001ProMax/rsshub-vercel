import"./esm-shims-wKwH419_.js";import"./config-CCdhzIDL.js";import{logger_default as e}from"./logger-tpjCqWRm.js";import"./proxy-Dk31iDML.js";import"./dist-CTnfpkZH.js";import{parseDuration as t}from"./helpers-DzX-lcQO.js";import"./cache-BqH0BkVy.js";import"./render-CxhTJIsl.js";import{parseDate as n}from"./parse-date-Bgabdhlb.js";import"./md5-4BNsOP-F.js";import"./ofetch-CeSje37P.js";import{got_default as r}from"./got-CgIPcr_1.js";import{ViewType as i}from"./types-A5bA50Mg.js";import"./puppeteer-CF91ore1.js";import{getVideoUrl as a,utils_default as o}from"./utils-BssngW95.js";import{cache_default as s}from"./cache-BCmdnIdy.js";import c from"json-bigint";const l={path:`/user/video/:uid/:embed?`,categories:[`social-media`],view:i.Videos,example:`/bilibili/user/video/2267573`,parameters:{uid:`用户 id, 可在 UP 主主页中找到`,embed:`默认为开启内嵌视频, 任意值为关闭`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`space.bilibili.com/:uid`],target:`/user/video/:uid`}],name:`UP 主投稿`,maintainers:[`DIYgod`,`Konano`,`pseudoyu`],handler:u};async function u(i){let l=i.req.param(`uid`),u=!i.req.param(`embed`),d=await s.getCookie(),f=await s.getWbiVerifyString(),p=o.getDmImgList(),m=o.getDmImgInter(),h=await s.getRenderData(l),[g,_]=await s.getUsernameAndFaceFromUID(l),v=o.addWbiVerifyInfo(o.addRenderData(o.addDmVerifyInfoWithInter(`mid=${l}&ps=30&tid=0&pn=1&keyword=&order=pubdate&platform=web&web_location=1550101&order_avoided=true`,p,m),h),f),y=await r(`https://api.bilibili.com/x/space/wbi/arc/search?${v}`,{headers:{Referer:`https://space.bilibili.com/${l}/video?tid=0&pn=1&keyword=&order=pubdate`,Cookie:d}}),b=y.data,x;if(b.code)try{let e=o.addDmVerifyInfo(`host_mid=${l}&platform=web&features=itemOpusStyle,listOnlyfans,opusBigCover,onlyfansVote`,o.getDmImgList()),i=await r(`https://api.bilibili.com/x/polymer/web-dynamic/v1/feed/space?${e}`,{headers:{Referer:`https://space.bilibili.com/${l}/`,Cookie:d}}),s=c.parse(i.body);if(s?.code===-352)throw Error(`Request failed, please try again.`);let f=s?.data?.items.filter(e=>e.modules.module_dynamic?.major?.type===`MAJOR_TYPE_ARCHIVE`);f&&f.length>0&&(x=f.map(e=>{let r=e?.modules?.module_dynamic?.major?.archive,i=e?.modules?.module_author,s=r?.aid,c=r?.bvid,l={title:r?.title??``,description:!s&&!c?``:o.renderUGCDescription(u,r.cover,r.desc,s,void 0,c),pubDate:i?.pub_ts?n(i.pub_ts,`X`):void 0,link:i?.pub_ts&&i.pub_ts>o.bvidTime&&c?`https://www.bilibili.com/video/${c}`:`https://www.bilibili.com/video/av${s}`,author:g??void 0,attachments:c?[{url:a(c),mime_type:`text/html`,duration_in_seconds:t(r?.duration_text)}]:void 0};return l}))}catch{throw e.error(JSON.stringify(b.data)),Error(`Got error code ${b.code} while fetching: ${b.message}`)}return{title:`${g} 的 bilibili 空间`,link:`https://space.bilibili.com/${l}`,description:`${g} 的 bilibili 空间`,image:_??void 0,logo:_??void 0,icon:_??void 0,item:x??(b.data&&b.data.list&&b.data.list.vlist&&b.data.list.vlist.map(e=>({title:e.title,description:o.renderUGCDescription(u,e.pic,e.description,e.aid,void 0,e.bvid),pubDate:new Date(e.created*1e3).toUTCString(),link:e.created>o.bvidTime&&e.bvid?`https://www.bilibili.com/video/${e.bvid}`:`https://www.bilibili.com/video/av${e.aid}`,author:g,comments:e.comment,attachments:e.bvid?[{url:a(e.bvid),mime_type:`text/html`}]:void 0})))}}export{l as route};