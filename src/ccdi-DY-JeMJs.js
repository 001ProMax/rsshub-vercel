import"./esm-shims-CGUM9TC6.js";import"./config-C9m9eBw5.js";import"./logger-CC3afzWM.js";import{parseDate as e}from"./parse-date-D4osZfpm.js";import{getSubPath as t}from"./common-utils-CI-xkOWZ.js";import"./dist-0j_z2rfc.js";import"./helpers-nWIDkd0K.js";import{cache_default as n}from"./cache-GwMhal7i.js";import"./ofetch-ZUQ1sEMc.js";import{got_default as r}from"./got-CB83B8oA.js";import{timezone as i}from"./timezone-BrNu6iXe.js";import{load as a}from"cheerio";import{Cookie as o,CookieJar as s}from"tough-cookie";const c=new s,l=`中央纪委国家监委网站`,u=`https://www.ccdi.gov.cn`,d=/(?<key>[A-Z_]+)=(?<value>(?:.*?(?=; max-age)|[\dA-Fa-f]+))/gm,f=async e=>{let t,n=[];for(;(t=d.exec(e))!==null;){t.index===d.lastIndex&&d.lastIndex++;let{key:e,value:r}=t.groups;n.push(new o({key:e,value:r}))}await Promise.all(n.map(e=>c.setCookie(e,u)))},p=async(t,n,i)=>{let o=await r(t,{cookieJar:c}),s=o.data;await f(s);let u=a(s),d=u(n).slice(0,i.req.query(`limit`)?Number.parseInt(i.req.query(`limit`)):20).toArray().map(n=>(n=u(n),{title:n.find(`a`).first().text().trim(),link:new URL(n.find(`a`).first().attr(`href`),t).href,pubDate:e(n.find(`.more`).text(),`YYYY-MM-DD`)})),p=u(`.other_Location`).text().replace(/(.+)首页/,l);return{list:d,title:p}},m=async()=>{let e=await c.getCookies(u),t=e.find(e=>e.key===`HOY_TR`);if(t){let e=t.value,n=e.split(`,`),r=n[0],i=[...n[1]],a=[...n[2]];a[0]=r.charAt(Number.parseInt(i[0],16));let s=new o({key:`HOY_TR`,value:r+`,`+i.join(``)+`,`+a.join(``)+`,0`});await c.setCookie(s,u)}},h=async t=>(await m(),n.tryGet(t.link,async()=>{let n=await r(t.link,{cookieJar:c}),o=n.data;await f(o);let s=a(o),u=s(`.daty, .source-box`).text().trim();return t.author=u.match(/来源：(.*)发布时间/s)?.[1].trim()??l,t.pubDate=i(e(u.match(/发布时间：(.*)分享/s)?.[1].trim()??t.pubDate),8),s(`.content, .bom-box`).find(`img`).each((e,n)=>{s(n).attr(`src`,new URL(s(n).attr(`src`),t.link).href),s(n).removeAttr(`oldsrc`).removeAttr(`alt`)}),t.description=s(`.content, .bom-box`).html(),t})),g={path:`/ccdi/*`,name:`Unknown`,maintainers:[],handler:_};async function _(e){let n=t(e).replaceAll(/(^\/ccdi|\/$)/g,``);n=n===``?`/yaowenn/`:n.endsWith(`/`)?n:n+`/`;let r=`${u}${n}`,{list:i,title:a}=await p(r,`.list_news_dl2 li`,e),o=await Promise.all(i.map(e=>h(e)));return{title:a,link:r,item:o}}export{g as route};