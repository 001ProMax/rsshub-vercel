import{__dirname as e,init_esm_shims as t}from"./esm-shims-CGUM9TC6.js";import{parseDate as n}from"./parse-date-D4osZfpm.js";import{cache_default as r}from"./cache-GwMhal7i.js";import{art as i}from"./render-DOz85fGU.js";import{got_default as a}from"./got-CB83B8oA.js";import o from"node:path";t();const s=[`misskey.io`,`madost.one`,`mk.nixnet.social`],c=(t,r,a=!1)=>t.map(t=>{let c=t.renote&&Object.keys(t.renote).length>0,l=t.reply&&Object.keys(t.reply).length>0,u=c?t.renote:t,d=u.user.host??r,f=a?String(u.user.name):`${u.user.name} (${u.user.username}@${d})`,p=i(o.join(e,`templates/note-b4364264.art`),{text:u.text,files:u.files,reply:t.reply,site:r}),m=``;if(l&&t.reply){let e=t.reply.user.host??r,n=a?t.reply.user.name:`${t.reply.user.name} (${t.reply.user.username}@${e})`;m=`Reply to ${n}: "${u.text??``}"`}else m=c?`Renote: ${f}: "${u.text??``}"`:`${f}: "${u.text??``}"`;let h=u.id;if(c){let e=t.user.host??r,n=u.user.host??r;(e!==n||!s.includes(n))&&(h=t.id)}let g=`https://${d}/notes/${h}`,_=n(u.createdAt);return{title:m,description:p,pubDate:_,link:g,author:f}});async function l(e,t,{withRenotes:n=!1,mediaOnly:i=!1}){let o=`https://${t}/api/users/search-by-username-and-host`,s=`misskey_username/${t}/${e}`,c=await r.tryGet(s,async()=>{let n=await a({method:`post`,url:o,json:{username:e,host:t,detail:!0,limit:1}}),r=n.data.find(t=>t.username===e);if(!r)throw Error(`username ${e} not found`);return r}),l=c.id,u=c.avatarUrl,d=`https://${t}/api/users/notes`,f=await a({method:`post`,url:d,json:{userId:l,withChannelNotes:!0,withRenotes:n,withReplies:!i,withFiles:i,limit:10,offset:0}}),p=f.data;return{site:t,accountId:l,accountData:p,avatarUrl:u}}var u={parseNotes:c,getUserTimelineByUsername:l,allowSiteList:s};export{u as utils_default};