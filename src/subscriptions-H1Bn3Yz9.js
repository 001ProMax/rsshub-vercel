import"./esm-shims-CGUM9TC6.js";import{config as e}from"./config-C9m9eBw5.js";import"./logger-CC3afzWM.js";import{parseDate as t}from"./parse-date-D4osZfpm.js";import"./dist-0j_z2rfc.js";import{cache_default as n}from"./cache-GwMhal7i.js";import"./render-DOz85fGU.js";import"./ofetch-ZUQ1sEMc.js";import"./not-found-CRS5K6wf.js";import{config_not_found_default as r}from"./config-not-found-BVqhRP9D.js";import{utils_default as i}from"./utils-C9CiiwcR.js";import a from"p-map";const o={path:`/subscriptions/:embed?`,categories:[`social-media`],example:`/youtube/subscriptions`,parameters:{embed:`Default to embed the video, set to any value to disable embedding`},features:{requireConfig:[{name:`YOUTUBE_KEY`,description:``},{name:`YOUTUBE_CLIENT_ID`,description:``},{name:`YOUTUBE_CLIENT_SECRET`,description:``},{name:`YOUTUBE_REFRESH_TOKEN`,description:``}]},radar:[{source:[`www.youtube.com/feed/subscriptions`,`www.youtube.com/feed/channels`],target:`/subscriptions`}],name:`Subscriptions`,maintainers:[`TonyRL`],handler:s,url:`www.youtube.com/feed/subscriptions`};async function s(o){if(!e.youtube||!e.youtube.key||!e.youtube.clientId||!e.youtube.clientSecret||!e.youtube.refreshToken)throw new r(`YouTube RSS is disabled due to the lack of <a href="https://docs.rsshub.app/deploy/config#route-specific-configurations">relevant config</a>`);let s=!o.req.param(`embed`),c=(await i.getSubscriptions(`snippet`,n)).data.items.map(e=>e.snippet.resourceId.channelId),l=await a(c,async e=>(await i.getChannelWithId(e,`contentDetails`,n)).data.items[0].contentDetails.relatedPlaylists.uploads,{concurrency:30}),u=await a(l,async e=>(await i.getPlaylistItems(e,`snippet`,n))?.data.items,{concurrency:30});u=u.flat(),u=u.filter(e=>e&&!e.error&&e.snippet.title!==`Private video`&&e.snippet.title!==`Deleted video`).map(e=>{let n=e.snippet,r=n.resourceId.videoId,a=i.getThumbnail(n.thumbnails);return{title:n.title,description:i.renderDescription(s,r,a,i.formatDescription(n.description)),pubDate:t(n.publishedAt),link:`https://www.youtube.com/watch?v=${r}`,author:n.videoOwnerChannelTitle,image:a.url}});let d={title:`Subscriptions - YouTube`,description:`YouTube Subscriptions`,link:`www.youtube.com/feed/subscriptions`,item:u};return o.set(`json`,{...d,channelIds:c,playlistIds:l}),d}export{o as route};