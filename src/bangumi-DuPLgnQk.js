import"./esm-shims-CGUM9TC6.js";import"./config-C9m9eBw5.js";import"./logger-CC3afzWM.js";import{parseDate as e}from"./parse-date-D4osZfpm.js";import{getSubPath as t}from"./common-utils-CI-xkOWZ.js";import"./dist-0j_z2rfc.js";import"./helpers-nWIDkd0K.js";import{cache_default as n}from"./cache-GwMhal7i.js";import"./ofetch-ZUQ1sEMc.js";import{got_default as r}from"./got-CB83B8oA.js";const i={path:`/*`,categories:[`anime`],radar:[{source:[`bangumi.moe/`]}],name:`Latest`,example:`/bangumi.moe`,maintainers:[`nczitzk`],handler:a,url:`bangumi.moe/`};async function a(i){let a=t(i)===`/`,o=`https://bangumi.moe`,s,c=[];if(a){let e=`${o}/api/torrent/latest`;s=await r({method:`get`,url:e})}else{let e=`${o}/api/tag/search`,a=`${o}/api/torrent/search`,l=t(i).split(`/`).slice(2);c=await Promise.all(l.map(t=>n.tryGet(t,async()=>{let n=await r({method:`post`,url:e,json:{name:decodeURIComponent(t),keywords:!0,multi:!0}});return n.data.found?n.data.tag.map(e=>e._id)[0]:``}))),s=await r({method:`post`,url:a,json:{tag_id:c}})}let l=s.data.torrents?.slice(0,i.req.query(`limit`)?Number.parseInt(i.req.query(`limit`)):30).map(t=>({title:t.title,link:`${o}/torrent/${t._id}`,description:t.introduction,pubDate:e(t.publish_time),enclosure_url:t.magnet,enclosure_type:`application/x-bittorrent`,category:t.tag_ids}))??[];return l=await Promise.all(l.map(e=>n.tryGet(e.link,async()=>{let t=await r({method:`post`,url:`${o}/api/tag/fetch`,json:{_ids:e.category}});e.category=[];for(let n of t.data)for(let t of n.synonyms)e.category.push(t);return e}))),{title:`萌番组 Bangumi Moe`,link:a||l.length===0?o:`${o}/search/${c.join(`+`)}`,item:l,allowEmpty:!0}}export{i as route};