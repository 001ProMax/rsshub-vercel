import{__dirname as e,init_esm_shims as t}from"./esm-shims-CGUM9TC6.js";import"./config-C9m9eBw5.js";import"./logger-CC3afzWM.js";import{parseDate as n}from"./parse-date-D4osZfpm.js";import{getSubPath as r}from"./common-utils-CI-xkOWZ.js";import"./dist-0j_z2rfc.js";import{cache_default as i}from"./cache-GwMhal7i.js";import{art as a}from"./render-DOz85fGU.js";import{ofetch_default as o}from"./ofetch-ZUQ1sEMc.js";import{timezone as s}from"./timezone-BrNu6iXe.js";import c from"node:path";import{load as l}from"cheerio";t();const u={path:`/stats/*`,name:`国家统计局 通用`,url:`www.stats.gov.cn`,categories:[`government`],maintainers:[`bigfei`,`nczitzk`,`reply2future`],example:`/gov/stats/sj/zxfb`,handler:d,radar:[{title:`国家统计局 通用`,source:[`www.stats.gov.cn/*path`],target:`/gov/stats/*path`}],description:"::: tip\n路径处填写对应页面 URL 中 `http://www.stats.gov.cn/` 后的字段。下面是一个例子。\n\n若订阅 [数据 > 数据解读](http://www.stats.gov.cn/sj/sjjd/)\n则将对应页面 URL `http://www.stats.gov.cn/sj/sjjd/` 中 `http://www.stats.gov.cn/` 后的字段 `sj/sjjd` 作为路径填入。\n此时路由为 [`/gov/stats/sj/sjjd`](https://rsshub.app/gov/stats/sj/sjjd)\n\n若订阅 [新闻 > 时政要闻 > 中央精神](http://www.stats.gov.cn/xw/szyw/zyjs/)\n则将对应页面 URL `http://www.stats.gov.cn/xw/szyw/zyjs/` 中 `http://www.stats.gov.cn/`\n后的字段 `xw/szyw/zyjs` 作为路径填入。此时路由为 [`/gov/stats/xw/szyw/zyjs`](https://rsshub.app/gov/stats/xw/szyw/zyjs)\n:::"};async function d(t){let u=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`)):15,d=`http://www.stats.gov.cn`,{headers:f}=await o.raw(d),p=f?.getSetCookie().find(e=>e.startsWith(`wzws_sessionid=`))?.split(`;`)[0],m=r(t)===`/stats`?`/sj/zxfb/`:r(t).replace(/^\/stats(.*)/,`$1`),h=`${d}${m.endsWith(`/`)?m:m+`/`}`,g=await o(h,{headers:{Cookie:p,Referer:h}}),_=l(g),v=_(_(`a.pchide`).length===0?`a[title]`:`.list-content a.pchide`).slice(0,u).toArray().map(e=>(e=_(e),{title:e.attr(`title`),link:new URL(e.attr(`href`),h).href}));return v=await Promise.all(v.map(t=>i.tryGet(t.link,async()=>{let r=await o(t.link,{headers:{Cookie:p,Referer:d}}),i=l(r);if(/(news\.cn|www\.gov\.cn)/.test(t.link)){if(i(`.year`).text())t.pubDate=s(n(`${i(`.year`).text()}/${i(`.day`).text()} ${i(`.time`).text()}`,`YYYY/MM/DD HH:mm:ss`),8),t.author=i(`.source`).text().replace(/来源：/,``).trim();else{i(`.pages_print`).remove();let e=i(`.info, .pages-date`).text().split(`来源：`);t.pubDate=s(n(e[0].trim()),8),t.author=e.pop()}return t.title=t.title||i(`h1`).first().text()||i(`h2`).first().text(),t.description=i(`#detail, .xlcontent, .pages_content`).html(),t}return t.author=r.match(/来源：(.*?)</)?.[1]?.trim(),i(`.pchide`).remove(),t.title=t.title||i(`div.detail-title h1`).text(),t.pubDate=s(n(i(`div.detail-title-des h2 p, .info`).first().text().trim()),8),t.description=a(c.join(e,`templates/description-c9fe7148.art`),{description:i(`.TRS_Editor`).html()||i(`.TRS_UEDITOR`).html(),attachments:i(`a[oldsrc]`).toArray().map(e=>(e=_(e),{link:new URL(e.attr(`href`),t.link).href,name:e.text().trim()}))}),t}))),{title:_(`title`).text(),link:h,item:v}}export{u as route};