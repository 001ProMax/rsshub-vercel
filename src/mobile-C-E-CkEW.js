import"./esm-shims-CGUM9TC6.js";import"./config-C9m9eBw5.js";import{logger_default as e}from"./logger-CC3afzWM.js";import{parseDate as t}from"./parse-date-D4osZfpm.js";import"./dist-0j_z2rfc.js";import{cache_default as n}from"./cache-GwMhal7i.js";import{ofetch_default as r}from"./ofetch-ZUQ1sEMc.js";import*as i from"cheerio";const a={path:`/mobile`,categories:[`new-media`],example:`/sohu/mobile`,parameters:{},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`m.sohu.com/limit`],target:`/mobile`}],name:`首页新闻`,maintainers:[`asqwe1`],handler:o,description:`订阅手机搜狐网的首页新闻`};async function o(){let t=await r(`https://m.sohu.com/limit`),a=i.load(t),o=a(`script:contains("WapHomeRenderData")`).text(),u=o?.match(/window\.WapHomeRenderData\s*=\s*({.*})/s);if(!u?.[1])throw Error(`WapHomeRenderData 数据未找到`);let d=JSON.parse(u[1]),f=s(d).filter(e=>e.id&&e.url?.startsWith(`//`)).map(e=>({title:e.title,link:new URL(e.url.split(`?`)[0],`https://m.sohu.com`).href})),p=await Promise.all(f.map(t=>n.tryGet(t.link,async()=>{try{let e=await r(t.link),n=i.load(e),a=``,o=``;if(t.link.includes(`/xtopic/`)){let e=n(`.tpl-top-text-item-content`).prop(`href`)?.split(`?`)[0]?.replace(`www.sohu.com/`,`m.sohu.com/`),t=await r(`https:${e}`),s=i.load(t);a=l(s),o=c(s)}return{...t,description:a||l(n)||t.title,pubDate:o||c(n)}}catch(n){return e.error(`获取详情失败: ${t.link}`,n),t}})));return{title:`手机搜狐新闻`,link:`https://m.sohu.com/limit`,item:p.filter(Boolean)}}function s(e){let t=[];for(let n of Object.keys(e))if(n.startsWith(`PlateBlock`)){let r=e[n];r?.param?.newsData?.list&&t.push(...r.param.newsData.list),r?.param?.focusData?.list&&t.push(...r.param.focusData.list),r?.param?.feedData0?.list&&t.push(...r.param.feedData0.list),r?.param?.feedData1?.list&&t.push(...r.param.feedData1.list)}return t}function c(e){let n=[`.time`,`#videoPublicTime`],r;for(let i of n){let n=e(i).first().text().trim();if(!n)continue;if(r=t(n),r)return r}let i=e(`meta[name="share_img"]`).toArray().map(t=>e(t).attr(`src`)).find(e=>e.includes(`images01`));if(r=i?t(i?.match(/images01\/(\d{8})\//i)?.[1]):``,r)return r}function l(e){let t=e(`#articleContent`);if(t.length)return t.first().html()?.trim();let n=e(`#videoPlayer div`);if(n.length)return`<video controls preload="auto" poster="${n.attr(`data-thumbnail`)}"><source src="${n.attr(`data-url`)}" /></video>`;let r=e(`script:contains("imageList")`).text();if(r){let e=JSON.parse(r.match(/(\[.*\])/s)?.[1].replaceAll(/("description": ".*"),/g,`$1`)||`[]`);return e.map(e=>`<img src="${e.url}" alt="${e.description||``}" />`).join(``)}return``}export{a as route};