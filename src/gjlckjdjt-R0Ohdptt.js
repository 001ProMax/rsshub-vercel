import{__dirname as e,init_esm_shims as t}from"./esm-shims-CGUM9TC6.js";import"./config-C9m9eBw5.js";import"./logger-CC3afzWM.js";import{parseDate as n}from"./parse-date-D4osZfpm.js";import"./dist-0j_z2rfc.js";import"./helpers-nWIDkd0K.js";import{cache_default as r}from"./cache-GwMhal7i.js";import{art as i}from"./render-DOz85fGU.js";import"./ofetch-ZUQ1sEMc.js";import{got_default as a}from"./got-CB83B8oA.js";import o from"node:path";import{load as s}from"cheerio";t();const c={path:`/forestry/gjlckjdjt/:category?`,categories:[`government`],example:`/gov/forestry/gjlckjdjt`,parameters:{category:`分类，见下表，默认为全部`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`国家林草科技大讲堂`,maintainers:[`nczitzk`],handler:l,description:`| 分类     | id   |
| -------- | ---- |
| 经济林   | jjl  |
| 林木良种 | lmlz |
| 林下经济 | lxjj |
| 生态修复 | stxf |
| 用材林   | ycl  |
| 其他     | qt   |`};async function l(t){let{category:c=`gjlckjdjt`}=t.req.param(),l=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`),10):30,u=`http://www.forestry.gov.cn`,d=new URL(`${c}.jhtml`,u).href,{data:f}=await a(d),p=s(f),m=p(`a.items`).slice(0,l).toArray().map(t=>{t=p(t);let r=t.find(`p.name`).text(),a=new URL(t.prop(`href`),u).href,s=a.match(/\/\d{8}\//);return{title:r,link:a,description:i(o.join(e,`templates/description-e2cc2c72.art`),{image:{src:t.find(`img`).prop(`src`),alt:r}}),pubDate:s?n(s[1]):void 0}});m=await Promise.all(m.map(t=>r.tryGet(t.link,async()=>{let{data:r}=await a(t.link),c=s(r);c(`p`).each((e,t)=>{t=c(t),t.find(`img, video, embed.edui-faked-video`).length===0&&/^\s*$/.test(t.text())&&t.remove()}),c(`video, embed.edui-faked-video`).each((n,r)=>{r=c(r);let a=r.prop(`src`);t.enclosure_url=t.enclosure_url??a,r.replaceWith(i(o.join(e,`templates/description-e2cc2c72.art`),{video:{src:a}}))});let l=t.link.match(/\/\d{8}\//);return t.title=c(`div.tit`).text(),t.description+=c(`div.zhengwen`).html(),t.pubDate=l?n(l[1]):void 0,t.enclosure_type=t.enclosure_url?`video/mp4`:void 0,t})));let h=new URL(`favicon.ico`,u).href;return{item:m,title:p(`title`).text(),link:d,language:p(`html`).prop(`lang`),image:new URL(`r/cms/www/default/zhuanti/2021djt/images/top.png`,u).href,icon:h,logo:h,subtitle:p(`div.weizhi`).contents().last().text(),author:`国家林业和草原局`,allowEmpty:!0}}export{c as route};