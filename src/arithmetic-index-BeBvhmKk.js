import{__dirname as e,init_esm_shims as t}from"./esm-shims-CGUM9TC6.js";import{config as n}from"./config-C9m9eBw5.js";import"./logger-CC3afzWM.js";import{parseDate as r}from"./parse-date-D4osZfpm.js";import"./proxy-C5Qog9Rm.js";import{cache_default as i}from"./cache-GwMhal7i.js";import{art as a}from"./render-DOz85fGU.js";import{timezone as o}from"./timezone-BrNu6iXe.js";import{invalid_parameter_default as s}from"./invalid-parameter-CUJdROXf.js";import{puppeteer_default as c}from"./puppeteer-U-cQNky4.js";import l from"node:path";import u from"dayjs";import{createDecipheriv as d}from"node:crypto";t();const f=n.cache.contentExpire,p=async(e,t,n,r,i=`aweme`)=>{let a={url:`https://trendinsight.oceanengine.com/api/open/index/get_multi_keyword_hot_trend`,method:`POST`,data:JSON.stringify({keyword_list:[t],start_date:n,end_date:r,app_name:i})},o=await e.evaluate(e=>{function t(){let t=new Promise(t=>{let n=new XMLHttpRequest;n.open(e.method,e.url,!0),n.setRequestHeader(`accept`,`application/json, text/plain, */*`),n.setRequestHeader(`content-type`,`application/json;charset=UTF-8`),n.setRequestHeader(`tea-uid`,`7054893410171930123`),n.addEventListener(`readystatechange`,()=>{if(n.readyState===4&&n.status===200)t(n.responseText);else return}),n.send(e.data)});return t}return Promise.resolve(t()).then(e=>e)},a);return o[0]},m=e=>{let t=Buffer.from(e,`base64`).toString(`hex`),n=d(`aes-128-cfb`,`anN2bXA2NjYsamlh`,`amlheW91LHFpYW53`),r=n.update(t,`hex`,`utf8`)+n.final(`utf8`);return JSON.parse(r)},h=e=>[`https://tophub.today/search?e=tophub&q=${e}`,`https://www.baidu.com/s?wd=${e}`,`https://www.google.com/search?q=${e}`,`https://m.zhihu.com/search?type=content&q=${e}`,`https://s.weibo.com/weibo/${e}`,`https://www.douyin.com/search/${e}`,`https://so.toutiao.com/search?keyword=${e}`],g=[`今日热榜`,`百度`,`谷歌`,`知乎`,`微博`,`抖音`,`头条`],_=(t,n,r)=>a(l.join(e,`templates/content-1e5ec464.art`),{keyword:t,queryListText:r,queries:n.map(e=>({links:h(encodeURIComponent(e)).map((e,t)=>`<a href="${e}" rel="noopener noreferrer" target="_blank">${g[t]}</a>`),key:e}))}),v={path:`/index/:keyword/:channel?`,name:`Unknown`,maintainers:[`Jkker`],handler:y};async function y(e){let t=u(),n=t.subtract(6,`month`).format(`YYYYMMDD`),a=t.format(`YYYYMMDD`),l=e.req.param(`keyword`);if(!l)throw new s(`Invalid keyword`);if(e.req.param(`channel`)&&![`douyin`,`toutiao`].includes(e.req.param(`channel`)))throw new s("Invalid channel。 Only support `douyin` or `toutiao`");let d=e.req.param(`channel`)===`toutiao`?`toutiao`:`aweme`,h=e.req.param(`channel`)===`toutiao`?`头条`:`抖音`,g=`https://trendinsight.oceanengine.com/arithmetic-index/analysis?keyword=${l}&appName=${d}`,v=await i.tryGet(g,async()=>{let e=await c(),t=await e.newPage();await t.setRequestInterception(!0),t.on(`request`,e=>{e.resourceType()===`document`||e.resourceType()===`script`||e.resourceType()===`xhr`?e.continue():e.abort()}),await t.goto(`https://trendinsight.oceanengine.com/arithmetic-index`);let i=await p(t,l,n,a,d);await e.close();let s=JSON.parse(i).data,u=m(s).hot_list[0],f=Number.parseInt(u.average.search_average);return u.search_top_point_list.map(({date:e,query_list:t})=>{let n=Number.parseInt(u.search_hot_list.find(t=>t.datetime===e).index),i=Math.round((n-f)/f*100),a=i>0?`📈`:`📉`,s=t.filter(e=>e!==l),c=s.join(`, `),d=_(l,[l,...s],c);return{title:`${a} ${l} ${i}% | ${c}`,author:`巨量算数 - ${h}算数指数`,description:d,link:g,pubDate:o(r(e),8),guid:`巨量算数 - ${h}算数指数 | ${l} - ${e}`}})},f,!1);return{title:`${l} - ${h}指数波峰`,link:g,description:`巨量算数 - ${h}算数指数 | 关键词: ${l}`,language:`zh-cn`,item:v}}export{v as route};