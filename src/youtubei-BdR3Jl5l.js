import{cache_default as e}from"./cache-Sft5n2jg.js";import{parseRelativeDate as t}from"./parse-date-Bgabdhlb.js";import{getVideoUrl as n,utils_default as r}from"./utils-uAL80qKo.js";import{getSubtitles as i}from"youtube-caption-extractor";import{Innertube as a}from"youtubei.js";const o=a.create();function s(e,t=2){return String(e).padStart(t,`0`)}function c(e){let t=Math.floor(e*1e3),n=Math.floor(t/36e5),r=Math.floor(t%36e5/6e4),i=Math.floor(t%6e4/1e3),a=t%1e3;return`${s(n)}:${s(r)}:${s(i)},${s(a,3)}`}function l(e){return e.map((e,t)=>{let n=Number.parseFloat(e.start),r=n+Number.parseFloat(e.dur);return`${t+1}
${c(n)} --> ${c(r)}
${e.text}
`}).join(`
`)}const u=t=>e.tryGet(`youtube:getChannelIdByUsername:${t}`,async()=>{let e=await o,n=await e.resolveURL(`https://www.youtube.com/${t}`);return n.payload.browseId}),d=async({username:e,embed:t,filterShorts:n})=>{let r=await u(e);return f({channelId:r,embed:t,filterShorts:n})},f=async({channelId:e,embed:a})=>{let s=await o,c=await s.getChannel(e),u=await c.getVideos();return{title:`${c.metadata.title||e} - YouTube`,link:`https://www.youtube.com/channel/${e}`,image:c.metadata.avatar?.[0].url,description:c.metadata.description,item:await Promise.all(u.videos.filter(e=>`video_id`in e).map(async e=>{let o=await i({videoID:e.video_id}),s=l(o),c=`data:text/plain;charset=utf-8,${encodeURIComponent(s)}`,u=`best_thumbnail`in e?e.best_thumbnail?.url:`thumbnails`in e?e.thumbnails?.[0]?.url:void 0;return{title:e.title.text||`YouTube Video ${e.video_id}`,description:`description_snippet`in e?r.renderDescription(a,e.video_id,u,r.formatDescription(e.description_snippet?.toHTML())):null,link:`https://www.youtube.com/watch?v=${e.video_id}`,author:typeof e.author==`string`?e.author:e.author.name===`N/A`?void 0:e.author.name,image:u,pubDate:`published`in e&&e.published?.text?t(e.published.text):void 0,attachments:[{url:n(e.video_id),mime_type:`text/html`,duration_in_seconds:e.duration&&`seconds`in e.duration?e.duration.seconds:void 0},{url:c,mime_type:`text/srt`,title:`Subtitles`}]}}))}},p=async({playlistId:e,embed:i})=>{let a=await o,s=await a.getPlaylist(e),c=await s.videos;return{title:`${s.info.title||e} by ${s.info.author.name} - YouTube`,link:`https://www.youtube.com/playlist?list=${e}`,image:s.info.thumbnails?.[0].url,description:s.info.description||`${s.info.title} by ${s.info.author.name}`,item:c.filter(e=>`id`in e).map(e=>{let a=`best_thumbnail`in e?e.best_thumbnail?.url:e.thumbnails?.[0]?.url;return{title:e.title.text||`YouTube Video ${e.id}`,description:r.renderDescription(i,e.id,a,``),link:`https://www.youtube.com/watch?v=${e.id}`,pubDate:`published`in e&&e.published?.text?t(e.published.text):void 0,author:`author`in e?[{name:e.author.name,url:e.author.url,avatar:e.author.thumbnails?.[0]?.url}]:void 0,image:a,attachments:[{url:n(e.id),mime_type:`text/html`,duration_in_seconds:`duration`in e&&e.duration&&`seconds`in e.duration?e.duration.seconds:void 0}]}})}};export{f as getDataByChannelId,p as getDataByPlaylistId,d as getDataByUsername};