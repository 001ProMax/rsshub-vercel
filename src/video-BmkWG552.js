import"./esm-shims-DtWyl6zt.js";import{config as e}from"./config-BpwDbAkH.js";import{logger_default as t}from"./logger-B3QfaIfn.js";import"./proxy-CnCu3_dc.js";import"./dist-CKN2M7CD.js";import"./helpers-DzX-lcQO.js";import"./cache-BWStd97H.js";import"./render-CxhTJIsl.js";import"./md5-4BNsOP-F.js";import"./ofetch-CYKAhM9L.js";import{got_default as n}from"./got-pWlL3EH4.js";import{ViewType as r}from"./types-A5bA50Mg.js";import"./puppeteer-Dsk3Jp6R.js";import{getVideoUrl as i,utils_default as a}from"./utils-D6x9dM9T.js";import{cache_default as o}from"./cache-DSfSZcr9.js";const s={path:`/user/video/:uid/:embed?`,categories:[`social-media`],view:r.Videos,example:`/bilibili/user/video/2267573`,parameters:{uid:`用户 id, 可在 UP 主主页中找到`,embed:`默认为开启内嵌视频, 任意值为关闭`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`space.bilibili.com/:uid`],target:`/user/video/:uid`}],name:`UP 主投稿`,maintainers:[`DIYgod`,`Konano`,`pseudoyu`],handler:c};async function c(r){let s=r.req.param(`uid`),c=!r.req.param(`embed`),l=await o.getCookie(),u=await o.getWbiVerifyString(),d=a.getDmImgList(),f=a.getDmImgInter(),p=await o.getRenderData(s),[m,h]=await o.getUsernameAndFaceFromUID(s),g=a.addWbiVerifyInfo(a.addRenderData(a.addDmVerifyInfoWithInter(`mid=${s}&ps=30&tid=0&pn=1&keyword=&order=pubdate&platform=web&web_location=1550101&order_avoided=true`,d,f),p),u),_=await n(`https://api.bilibili.com/x/space/wbi/arc/search?${g}`,{headers:{Referer:`https://space.bilibili.com/${s}/video?tid=0&pn=1&keyword=&order=pubdate`,Cookie:l}}),v=_.data;if(v.code)throw t.error(JSON.stringify(v.data)),Error(`Got error code ${v.code} while fetching: ${v.message}`);return{title:`${m} 的 bilibili 空间`,link:`https://space.bilibili.com/${s}`,description:`${m} 的 bilibili 空间`,image:h??void 0,logo:h??void 0,icon:h??void 0,item:v.data&&v.data.list&&v.data.list.vlist&&await Promise.all(v.data.list.vlist.map(async t=>{let n=!e.bilibili.excludeSubtitles&&t.bvid?await o.getVideoSubtitleAttachment(t.bvid):[];return{title:t.title,description:a.renderUGCDescription(c,t.pic,t.description,t.aid,void 0,t.bvid),pubDate:new Date(t.created*1e3).toUTCString(),link:t.created>a.bvidTime&&t.bvid?`https://www.bilibili.com/video/${t.bvid}`:`https://www.bilibili.com/video/av${t.aid}`,author:m,comments:t.comment,attachments:t.bvid?[{url:i(t.bvid),mime_type:`text/html`},...n]:void 0}}))}}export{s as route};