import"./esm-shims-DtWyl6zt.js";import"./config-C9m9eBw5.js";import"./logger-CC3afzWM.js";import"./proxy-Br-Rb_Qy.js";import"./dist-CKN2M7CD.js";import{parseDuration as e}from"./helpers-DzX-lcQO.js";import{cache_default as t}from"./cache-Sft5n2jg.js";import"./render-CxhTJIsl.js";import{parseDate as n}from"./parse-date-Bgabdhlb.js";import"./md5-4BNsOP-F.js";import"./ofetch-CWsaZ4vY.js";import{got_default as r}from"./got-RSSJ34bj.js";import{ViewType as i}from"./types-A5bA50Mg.js";import"./puppeteer-uO6s7chG.js";import{fallback as a,queryToBoolean as o}from"./readable-social-D4KJOlrJ.js";import{getLiveUrl as s,getVideoUrl as c,utils_default as l}from"./utils-CXWIJDIU.js";import{cache_default as u}from"./cache-CJdNLLau.js";import d from"json-bigint";const f={path:`/user/dynamic/:uid/:routeParams?`,categories:[`social-media`],view:i.SocialMedia,example:`/bilibili/user/dynamic/2267573`,parameters:{uid:`用户 id, 可在 UP 主主页中找到`,routeParams:`
| 键         | 含义                              | 接受的值       | 默认值 |
| ---------- | --------------------------------- | -------------- | ------ |
| showEmoji  | 显示或隐藏表情图片                | 0/1/true/false | false  |
| embed      | 默认开启内嵌视频                  | 0/1/true/false |  true  |
| useAvid    | 视频链接使用 AV 号 (默认为 BV 号) | 0/1/true/false | false  |
| directLink | 使用内容直链                      | 0/1/true/false | false  |
| hideGoods  | 隐藏带货动态                      | 0/1/true/false | false  |
| offset     | 偏移状态                         | string         | ""  |

用例：\`/bilibili/user/dynamic/2267573/showEmoji=1&embed=0&useAvid=1\``},features:{requireConfig:[{name:`BILIBILI_COOKIE_*`,optional:!0,description:"如果没有此配置，那么必须开启 puppeteer 支持；BILIBILI_COOKIE_{uid}: 用于用户关注动态系列路由，对应 uid 的 b 站用户登录后的 Cookie 值，`{uid}` 替换为 uid，如 `BILIBILI_COOKIE_2267573`，获取方式：\n1.  打开 [https://api.vc.bilibili.com/dynamic_svr/v1/dynamic_svr/dynamic_new?uid=0&type=8](https://api.vc.bilibili.com/dynamic_svr/v1/dynamic_svr/dynamic_new?uid=0&type=8)\n2.  打开控制台，切换到 Network 面板，刷新\n3.  点击 dynamic_new 请求，找到 Cookie\n4.  视频和专栏，UP 主粉丝及关注只要求 `SESSDATA` 字段，动态需复制整段 Cookie"}],requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`space.bilibili.com/:uid`],target:`/user/dynamic/:uid`}],name:`UP 主动态`,maintainers:[`DIYgod`,`zytomorrow`,`CaoMeiYouRen`,`JimenezLi`],handler:x},p=e=>{let t=e.module_dynamic?.major;if(!t)return``;if(t.none)return t.none.tips;if(t.courses)return`${t.courses?.title} - ${t.courses?.sub_title}`;if(t.live_rcmd?.content)return JSON.parse(t.live_rcmd.content)?.live_play_info?.title;let n=t.type.replace(`MAJOR_TYPE_`,``).toLowerCase();return t[n]?.title},m=e=>{let t=``;e.module_dynamic?.desc?.text&&(t+=e.module_dynamic.desc.text);let n=e.module_dynamic?.major;if(!n)return t;if(n?.common?.desc)return t+=t?`<br>//转发自: ${n.common.desc}`:n.common.desc,t;if(n?.live)return`${n.live?.desc_first}<br>${n.live?.desc_second}`;if(n.live_rcmd?.content){let e=JSON.parse(n.live_rcmd.content)?.live_play_info;return`${e?.area_name}·${e?.watched_show?.text_large}`}if(n?.opus)return n?.opus?.summary?.text;let r=n.type.replace(`MAJOR_TYPE_`,``).toLowerCase();return n[r]?.desc},h=e=>e&&p(e),g=e=>e&&m(e),_=e=>e?.module_author?.name,v=(e,t=!0)=>{if(!t)return``;let n=e?.module_dynamic?.major?.archive?.aid,r=e?.module_dynamic?.major?.archive?.bvid;return n===void 0&&r===void 0?``:l.renderUGCDescription(t,``,``,n,void 0,r)},y=e=>{let t=[],n=e?.module_dynamic?.major;if(!n)return``;n.opus?.pics?.length&&t.push(...n.opus.pics.map(e=>e.url)),n.article?.covers?.length&&t.push(...n.article.covers),n.draw?.items?.length&&t.push(...n.draw.items.map(e=>e.src)),n.live_rcmd?.content&&t.push(JSON.parse(n.live_rcmd.content)?.live_play_info?.cover);let r=n.type.replace(`MAJOR_TYPE_`,``).toLowerCase();return n[r]?.cover&&t.push(n[r].cover),t.filter(Boolean).map(e=>`<img src="${e}">`).join(``)},b=(e,t=!1)=>{let n=e?.modules;if(!n)return null;let r=``,i=``,a,o=n.module_dynamic?.major;if(!o)return null;switch(o?.type){case`MAJOR_TYPE_UGC_SEASON`:r=o?.ugc_season?.jump_url||``,i=`合集地址：<a href=${r}>${r}</a>`;break;case`MAJOR_TYPE_ARTICLE`:r=`https://www.bilibili.com/read/cv${o?.article?.id}`,i=`专栏地址：<a href=${r}>${r}</a>`;break;case`MAJOR_TYPE_ARCHIVE`:{let e=o?.archive,n=t?`av${e?.aid}`:e?.bvid;r=`https://www.bilibili.com/video/${n}`,i=`视频地址：<a href=${r}>${r}</a>`,a=c(e?.bvid);break}case`MAJOR_TYPE_COMMON`:r=o?.common?.jump_url||``,i=`地址：<a href=${r}>${r}</a>`;break;case`MAJOR_TYPE_OPUS`:e?.type===`DYNAMIC_TYPE_ARTICLE`?(r=`https:${o?.opus?.jump_url}`,i=`专栏地址：<a href=${r}>${r}</a>`):e?.type===`DYNAMIC_TYPE_DRAW`&&(r=`https:${o?.opus?.jump_url}`,i=`图文地址：<a href=${r}>${r}</a>`);break;case`MAJOR_TYPE_PGC`:{let e=o?.pgc;r=`https://www.bilibili.com/bangumi/play/ep${e?.epid}&season_id=${e?.season_id}`,i=`剧集地址：<a href=${r}>${r}</a>`;break}case`MAJOR_TYPE_COURSES`:r=`https://www.bilibili.com/cheese/play/ss${o?.courses?.id}`,i=`课程地址：<a href=${r}>${r}</a>`;break;case`MAJOR_TYPE_MUSIC`:r=`https://www.bilibili.com/audio/au${o?.music?.id}`,i=`音频地址：<a href=${r}>${r}</a>`;break;case`MAJOR_TYPE_LIVE`:r=`https://live.bilibili.com/${o?.live?.id}`,i=`直播间地址：<a href=${r}>${r}</a>`;break;case`MAJOR_TYPE_LIVE_RCMD`:{let e=JSON.parse(o.live_rcmd?.content||`{}`)?.live_play_info;r=`https://live.bilibili.com/${e?.room_id}`,a=s(e?.room_id),i=`直播间地址：<a href=${r}>${r}</a>`;break}default:return null}return{url:r,text:i,videoPageUrl:a}};async function x(i){let s=i.req.param(`uid`),c=Object.fromEntries(new URLSearchParams(i.req.param(`routeParams`))),f=a(void 0,o(c.showEmoji),!1),x=a(void 0,o(c.embed),!1),S=i.req.query(`mode`)===`fulltext`,C=a(void 0,c.offset,``),w=a(void 0,o(c.useAvid),!1),T=a(void 0,o(c.directLink),!1),E=a(void 0,o(c.hideGoods),!1),D=async e=>{let t=l.addDmVerifyInfo(`offset=${C}&host_mid=${s}&platform=web&features=itemOpusStyle,listOnlyfans,opusBigCover,onlyfansVote`,l.getDmImgList()),n=await r(`https://api.bilibili.com/x/polymer/web-dynamic/v1/feed/space?${t}`,{headers:{Referer:`https://space.bilibili.com/${s}/`,Cookie:e}}),i=d.parse(n.body);return i},O,k=await u.getCookie();if(O=await D(k),O?.code===-352){let e=await u.getCookie(!0);if(O=await D(e),O?.code===-352)throw Error(`遇到源站风控校验，请稍后再试`)}let A=O?.data?.items,j=await u.getUsernameAndFaceFromUID(s),M=j[0]??A[0]?.modules?.module_author?.name,N=j[1]??A[0]?.modules?.module_author?.face;t.set(`bili-username-from-uid-${s}`,M),t.set(`bili-userface-from-uid-${s}`,N);let P=await Promise.all(A.filter(e=>E?e.modules.module_dynamic?.additional?.type!==`ADDITIONAL_TYPE_GOODS`:!0).map(async t=>{let r=t.modules,i=t?.orig?.modules,a=``;t.id_str&&(a=`https://t.bilibili.com/${t.id_str}`);let o=m(r)||``,c=o,l=p(r),d=[];if(r.module_dynamic?.desc?.rich_text_nodes?.length){let e=r.module_dynamic.desc.rich_text_nodes;for(let t of e){if(f&&t?.emoji){let e=t.emoji;c=c.replaceAll(e.text,`<img alt="${e.text}" src="${e.icon_url}" style="margin: -1px 1px 0px; display: inline-block; width: 20px; height: 20px; vertical-align: text-bottom;" title="" referrerpolicy="no-referrer">`)}if(t?.pics?.length){let{pics:e,text:n}=t;c=c.replaceAll(n,e.map(e=>`<img alt="${n}" src="${e.src}" style="margin: 0px 0px 0px; display: inline-block; width: ${e.width}px; height: ${e.height}px; vertical-align: text-bottom;" title="" referrerpolicy="no-referrer">`).join(`<br>`))}t?.type===`RICH_TEXT_NODE_TYPE_TOPIC`&&d.push(t.text.match(/#(\S+)#/)?.[1]||``)}}if(r.module_dynamic?.major?.opus?.summary?.rich_text_nodes?.length){let e=r.module_dynamic.major.opus.summary.rich_text_nodes;for(let t of e)t?.type===`RICH_TEXT_NODE_TYPE_TOPIC`&&d.push(t.text.match(/#(\S+)#/)?.[1]||``)}if(r.module_dynamic?.topic?.name&&d.push(r.module_dynamic.topic.name),t.type===`DYNAMIC_TYPE_ARTICLE`&&S){let e=r.module_dynamic?.major?.opus?.jump_url?.match?.(/cv(\d+)/)?.[0];e&&(c=(await u.getArticleDataFromCvid(e,s)).description||``)}let C=b(t,w),E=C?.text;C&&T&&(a=C.url);let D=b(t?.orig,w),O=D?.text;D&&T&&(a=D.url);let k=``,A=_(i),j=h(i),N=g(i);A&&(k+=`//转发自: @${_(i)}: `),j&&(k+=j),N&&(k+=`<br>${N}`),c=c.replaceAll(`\r
`,`<br>`).replaceAll(`
`,`<br>`),k=k.replaceAll(`\r
`,`<br>`).replaceAll(`
`,`<br>`);let P=[l,c,v(r,x),y(r),E,k,v(i,x),y(i),O].map(e=>e?.trim()).filter(Boolean).join(`<br>`);return{title:l||o,description:P,pubDate:r.module_author?.pub_ts?n(r.module_author.pub_ts,`X`):void 0,link:a,author:M,category:d.length?[...new Set(d)]:void 0,attachments:C?.videoPageUrl||D?.videoPageUrl?[{url:C?.videoPageUrl||D?.videoPageUrl,mime_type:`text/html`,duration_in_seconds:r.module_dynamic?.major?.archive?.duration_text?e(r.module_dynamic.major.archive.duration_text):void 0}]:void 0}}));return{title:`${M} 的 bilibili 动态`,link:`https://space.bilibili.com/${s}/dynamic`,description:`${M} 的 bilibili 动态`,image:N,logo:N,icon:N,item:P}}export{f as route};