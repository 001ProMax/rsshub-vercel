import"./esm-shims-CGUM9TC6.js";import{config as e}from"./config-C9m9eBw5.js";import"./logger-CC3afzWM.js";import{parseDate as t}from"./parse-date-D4osZfpm.js";import"./dist-0j_z2rfc.js";import{cache_default as n}from"./cache-GwMhal7i.js";import{ofetch_default as r}from"./ofetch-ZUQ1sEMc.js";import{generateNonce as i,getPost as a,phoneBaseUrl as o,sign as s,webBaseUrl as c}from"./utils-B3pW-0LB.js";const l={path:`/bbs/special/:specialId`,categories:[`bbs`],example:`/dxy/bbs/special/72`,parameters:{specialId:`专题 ID，可在对应专题页 URL 中找到`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`专题`,maintainers:[`TonyRL`],handler:u};async function u(l){let u=l.req.param(`specialId`),{limit:d=`10`}=l.req.query(),f=await n.tryGet(`dxy:special:detail:${u}`,async()=>{let e={specialId:u,requestType:`h5`,timestamp:Date.now(),noncestr:i(8,`number`)},t=await r(`${o}/newh5/bbs/special/detail`,{query:{...e,sign:s(e)}});if(t.code!==`success`)throw Error(t.message);return t.data}),p=await n.tryGet(`dxy:special:recommend-list-v3:${u}`,async()=>{let e={specialId:u,requestType:`h5`,pageNum:`1`,pageSize:d,timestamp:Date.now(),noncestr:i(8,`number`)},t=await r(`${o}/newh5/bbs/special/post/recommend-list-v3`,{query:{...e,sign:s(e)}});if(t.code!==`success`)throw Error(t.message);return t.data},e.cache.routeExpire,!1),m=p.result.map(e=>{let{postInfo:n,dataTime:r,entityId:i}=e;return{title:n.subject,description:n.simpleBody,pubDate:t(r,`x`),author:n.postUser.nickname,category:[n.postSpecial.specialName],link:`${c}/bbs/newweb/pc/post/${i}`,postId:i}}),h=await Promise.all(m.map(e=>a(e,n.tryGet)));return{title:f.name,description:`${f.content} ${f.postCount} 內容 ${f.followCount} 关注`,link:`${o}/bbs/special?specialId=${u}`,image:f.specialAvatar,item:h}}export{l as route};