import{parseDate as e}from"./parse-date-D4osZfpm.js";import{cache_default as t}from"./cache-GwMhal7i.js";import{ofetch_default as n}from"./ofetch-ZUQ1sEMc.js";import r from"node:crypto";import*as i from"cheerio";const a=e=>Uint8Array.from(Buffer.from(e,`base64`)),o=e=>Buffer.from(e,`base64`).toString(`hex`),s=(e,t)=>{let n=r.createHash(`sha256`);return n.update(e),n.update(t),n.digest(`hex`)},c=e=>{let t=JSON.parse(Buffer.from(e,`base64`).toString()),n=a(t.v.a),r=o(t.v.c);for(let e=0;e<1e6;e++){let i=s(n,e.toString());if(i===r){t.d=Buffer.from(e.toString()).toString(`base64`);break}}return Buffer.from(JSON.stringify(t)).toString(`base64`)},l=async e=>{let t=await n(e),r=i.load(t);if(r(`script`).text().includes(`_wafchallengeid`)){let a=r(`script:contains("_wafchallengeid")`).text().match(/cs="(.*?)",c/)?.[1],o=c(a);t=await n(e,{headers:{cookie:`_wafchallengeid=${o};`}}),r=i.load(t)}return r(`.article-viewer`).html()},u=t=>t.map(t=>{let n=!!t.article_info;return{title:n?t.article_info.title:t.content_info.title,description:(n?t.article_info.brief_content:t.content_info.brief)||`无描述`,pubDate:e(n?t.article_info.ctime:t.content_info.ctime,`X`),author:t.author_user_info.user_name,link:`https://juejin.cn${n?`/post/${t.article_id}`:`/news/${t.content_id}`}`,category:[...new Set([t.category.category_name,...t.tags.map(e=>e.tag_name)])]}}),d=e=>Promise.all(e.map(e=>t.tryGet(e.link,async()=>(e.description=await l(e.link)||e.description,e)))),f=()=>t.tryGet(`juejin:categoryBriefs`,async()=>{let e=await n(`https://api.juejin.cn/tag_api/v1/query_category_briefs`);return e.data}),p=e=>t.tryGet(`juejin:collectionId:${e}`,async()=>{let t=await n(`https://api.juejin.cn/interact_api/v1/collectionSet/get`,{query:{tag_id:e,cursor:0}});return t.data}),m=e=>t.tryGet(`juejin:tag:${e}`,async()=>{let t=await n(`https://api.juejin.cn/tag_api/v1/query_tag_detail`,{method:`POST`,body:{key_word:e}});return t.data});export{d as ProcessFeed,f as getCategoryBrief,p as getCollection,m as getTag,u as parseList};