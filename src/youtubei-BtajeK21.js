import{parseRelativeDate as e}from"./parse-date-D4osZfpm.js";import{cache_default as t}from"./cache-GwMhal7i.js";import{getVideoUrl as n,utils_default as r}from"./utils-BT-ZU-0v.js";import{getSubtitles as i}from"youtube-caption-extractor";import{Innertube as a}from"youtubei.js";const o=a.create();function s(e,t=2){return String(e).padStart(t,`0`)}function c(e){let t=Math.floor(e*1e3),n=Math.floor(t/36e5),r=Math.floor(t%36e5/6e4),i=Math.floor(t%6e4/1e3),a=t%1e3;return`${s(n)}:${s(r)}:${s(i)},${s(a,3)}`}function l(e){return e.map((e,t)=>{let n=Number.parseFloat(e.start),r=n+Number.parseFloat(e.dur);return`${t+1}
${c(n)} --> ${c(r)}
${e.text}
`}).join(`
`)}const u=e=>t.tryGet(`youtube:getChannelIdByUsername:${e}`,async()=>{let t=await o,n=await t.resolveURL(`https://www.youtube.com/${e}`);return n.payload.browseId}),d=async({username:e,embed:t,filterShorts:n})=>{let r=await u(e);return f({channelId:r,embed:t,filterShorts:n})},f=async({channelId:t,embed:a})=>{let s=await o,c=await s.getChannel(t),u=await c.getVideos();return{title:`${c.metadata.title||t} - YouTube`,link:`https://www.youtube.com/channel/${t}`,image:c.metadata.avatar?.[0].url,description:c.metadata.description,item:await Promise.all(u.videos.filter(e=>`video_id`in e).map(async t=>{let o=await i({videoID:t.video_id}),s=l(o),c=`data:text/plain;charset=utf-8,${encodeURIComponent(s)}`,u=`best_thumbnail`in t?t.best_thumbnail?.url:`thumbnails`in t?t.thumbnails?.[0]?.url:void 0;return{title:t.title.text||`YouTube Video ${t.video_id}`,description:`description_snippet`in t?r.renderDescription(a,t.video_id,u,r.formatDescription(t.description_snippet?.toHTML())):null,link:`https://www.youtube.com/watch?v=${t.video_id}`,author:typeof t.author==`string`?t.author:t.author.name===`N/A`?void 0:t.author.name,image:u,pubDate:`published`in t&&t.published?.text?e(t.published.text):void 0,attachments:[{url:n(t.video_id),mime_type:`text/html`,duration_in_seconds:t.duration&&`seconds`in t.duration?t.duration.seconds:void 0},{url:c,mime_type:`text/srt`,title:`Subtitles`}]}}))}},p=async({playlistId:t,embed:i})=>{let a=await o,s=await a.getPlaylist(t),c=await s.videos;return{title:`${s.info.title||t} by ${s.info.author.name} - YouTube`,link:`https://www.youtube.com/playlist?list=${t}`,image:s.info.thumbnails?.[0].url,description:s.info.description||`${s.info.title} by ${s.info.author.name}`,item:c.filter(e=>`id`in e).map(t=>{let a=`best_thumbnail`in t?t.best_thumbnail?.url:t.thumbnails?.[0]?.url;return{title:t.title.text||`YouTube Video ${t.id}`,description:r.renderDescription(i,t.id,a,``),link:`https://www.youtube.com/watch?v=${t.id}`,pubDate:`published`in t&&t.published?.text?e(t.published.text):void 0,author:`author`in t?[{name:t.author.name,url:t.author.url,avatar:t.author.thumbnails?.[0]?.url}]:void 0,image:a,attachments:[{url:n(t.id),mime_type:`text/html`,duration_in_seconds:`duration`in t&&t.duration&&`seconds`in t.duration?t.duration.seconds:void 0}]}})}};export{f as getDataByChannelId,p as getDataByPlaylistId,d as getDataByUsername};