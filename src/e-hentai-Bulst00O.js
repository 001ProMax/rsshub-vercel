import{__dirname as e,init_esm_shims as t}from"./esm-shims-CGUM9TC6.js";import"./config-C9m9eBw5.js";import"./logger-CC3afzWM.js";import{parseDate as n}from"./parse-date-D4osZfpm.js";import"./dist-0j_z2rfc.js";import"./helpers-nWIDkd0K.js";import{cache_default as r}from"./cache-GwMhal7i.js";import{art as i}from"./render-DOz85fGU.js";import"./ofetch-ZUQ1sEMc.js";import{got_default as a}from"./got-CB83B8oA.js";import o from"node:path";import{load as s}from"cheerio";t();const c={path:`/:what?/:id?/:needTorrents?/:needImages?`,name:`Unknown`,maintainers:[],features:{nsfw:!0},handler:l};async function l(t){let c=t.req.param(`id`)??``,l=t.req.param(`what`)??``,u=/t|y/i.test(t.req.param(`needTorrents`)??`true`),d=/t|y/i.test(t.req.param(`needImages`)??`true`),f=`https://e-hentai.org/${c?l===`search`?`?${c}`:l===`category`?c:`${l}/${c}`:l}`,p=await a({method:`get`,url:f}),m=s(p.data);m(`.itd`).parent().remove();let h=m(`table.gltc tbody tr`).slice(1,t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`))+1:d?16:26).toArray().map(e=>(e=m(e),{title:e.find(`div.glink`).text(),author:e.find(`td.glhide div a`).text(),link:e.find(`td.glname a`).attr(`href`),pubDate:n(e.find(`div.ir`).prev().text()),category:e.find(`div.gt`).toArray().map(e=>m(e).attr(`title`).replace(/^:/,``)),description:d?``:`<img src="${e.find(`div.glthumb div img`).attr(`data-src`)??e.find(`div.glthumb div img`).attr(`src`)}">`,enclosure_url:u&&e.find(`div.gldown a img[title="Show torrents"]`).length>0?e.find(`.gldown a`).attr(`href`):void 0}));return h=await Promise.all(h.map(async t=>{if(t.enclosure_url){let e=``,n=await r.get(t.enclosure_url);if(!n){let i=await a({method:`get`,url:t.enclosure_url}),o=s(i.data);o(`h1, input[name="torrent_info"]`).remove(),e=o(`form`).parent().html(),n=o(`table tbody tr td a`).toArray().map(e=>(e=o(e),{link:e.attr(`href`),title:e.text()})),r.set(t.enclosure_url,n)}t.description+=e,t.enclosure_url=n[0].link,t.enclosure_type=`application/x-bittorrent`}if(d){let n=await r.get(t.link);if(!n){let e=await a({method:`get`,url:t.link}),i=s(e.data);n=await Promise.all(i(`.gdtm a`).toArray().map(e=>r.tryGet(i(e).attr(`href`),async()=>{let t=await a({method:`get`,url:i(e).attr(`href`)}),n=s(t.data);return n(`#img`).attr(`src`)}))),r.set(t.link,n)}t.description+=i(o.join(e,`templates/images-c6c5dab2.art`),{images:n})}return t})),{title:`${c||l||`Front Page`} - E-Hentai Galleries`,link:f,item:h}}export{c as route};