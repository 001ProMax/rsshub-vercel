import{parseDate as e}from"./parse-date-D4osZfpm.js";import{cache_default as t}from"./cache-GwMhal7i.js";import{got_default as n}from"./got-CB83B8oA.js";import{timezone as r}from"./timezone-BrNu6iXe.js";import{load as i}from"cheerio";const a=`https://www.cnbeta.com.tw`,o=(t,a,o)=>Promise.all(t.slice(0,a?Number.parseInt(a):60).map(t=>o(t.link,async()=>{let a=await n(t.link),o=i(a.data);return o(`.topic, .article-topic, .article-global`).remove(),t.description=o(`.article-summary`).html()+o(`.article-content`).html(),t.author=o(`header.title div.meta span.source`).text(),t.pubDate??=r(e(o(`.meta span`).first().text(),`YYYY年MM月DD日 HH:mm`),8),t})));async function s(s){let{type:c,id:l}=s.req.param(),u=c?`${a}/${c}/${l}.htm`:a,d=await n(u),f=i(d.data),p=encodeURI(f(`meta[name="csrf-token"]`).attr(`content`)),m=`${a}/home/more?&type=${f(`div[data-type]`).data(`type`)}&page=1&_csrf=${p}&_=${Date.now()}`;d=await n(m);let h=c?d.data.result.list.map(t=>({title:t.title,description:t.hometext,author:t.source.split(`@http`)[0],pubDate:r(e(t.inputtime),8),link:t.url_show.startsWith(`//`)?`https:${t.url_show}`:t.url_show.replace(`http:`,`https:`),category:t.label.name})):d.data.result.map(e=>({title:e.title,link:e.url_show.startsWith(`//`)?`https:${e.url_show}`:e.url_show.replace(`http:`,`https:`),category:e.label.name}));return{title:f(`title`).text(),link:u,item:await o(h,s.req.query(`limit`),t.tryGet)}}export{s as handler};