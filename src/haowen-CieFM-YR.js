import"./esm-shims-CGUM9TC6.js";import{config as e}from"./config-C9m9eBw5.js";import"./logger-CC3afzWM.js";import{parseDate as t}from"./parse-date-D4osZfpm.js";import"./dist-0j_z2rfc.js";import{cache_default as n}from"./cache-GwMhal7i.js";import{ofetch_default as r}from"./ofetch-ZUQ1sEMc.js";import{timezone as i}from"./timezone-BrNu6iXe.js";import{config_not_found_default as a}from"./config-not-found-BVqhRP9D.js";import{getHeaders as o}from"./utils-Cq0IVh7y.js";import{load as s}from"cheerio";const c={path:`/haowen/:day?`,categories:[`shopping`],example:`/smzdm/haowen/1`,parameters:{day:{description:"以天为时间跨度，默认为 `1`",options:[{value:`1`,label:`今日热门`},{value:`7`,label:`周热门`},{value:`30`,label:`月热门`}],default:`1`}},features:{requireConfig:[{name:`SMZDM_COOKIE`,description:`什么值得买登录后的 Cookie 值`}],requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`好文`,maintainers:[`LogicJake`,`pseudoyu`],handler:l};async function l(c){if(!e.smzdm.cookie)throw new a(`什么值得买排行榜 is disabled due to the lack of SMZDM_COOKIE`);let l=c.req.param(`day`)??`1`,u=`https://post.smzdm.com/hot_${l}/`,d=await r(u,{headers:o()}),f=s(d),p=f(`li.filter-tab.active`).text(),m=f(`li.feed-row-wide`).toArray().map(e=>{let n=f(e);return{title:n.find(`h5.z-feed-title a`).text(),link:n.find(`h5.z-feed-title a`).attr(`href`),pubDate:i(t(n.find(`span.z-publish-time`).text()),8)}}),h=await Promise.all(m.map(e=>n.tryGet(e.link??``,async()=>{let n=await r(e.link??``,{headers:o()}),a=s(n),c=a(`#articleId`);c.find(`.item-name`).remove(),c.find(`.recommend-tab`).remove();let l=a(`meta[property="og:release_date"]`).attr(`content`),u={title:e.title,link:e.link,description:c.html()||``,pubDate:l?i(t(l),8):e.pubDate,author:a(`meta[property="og:author"]`).attr(`content`)||``};return u})));return{title:`${p}-什么值得买好文`,link:u,item:h.filter(e=>e!==null)}}export{c as route};