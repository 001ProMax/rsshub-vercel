import"./esm-shims-CGUM9TC6.js";import"./config-C9m9eBw5.js";import{logger_default as e}from"./logger-CC3afzWM.js";import"./proxy-Br-Rb_Qy.js";import"./dist-CRTt8uUM.js";import"./helpers-DzX-lcQO.js";import"./cache-Sft5n2jg.js";import"./render-CxhTJIsl.js";import"./md5-4BNsOP-F.js";import"./ofetch-BHWobzJG.js";import{got_default as t}from"./got-DLgbOU4j.js";import{ViewType as n}from"./types-A5bA50Mg.js";import"./puppeteer-uO6s7chG.js";import{getVideoUrl as r,utils_default as i}from"./utils-DJvayLVS.js";import{cache_default as a}from"./cache-CzORyrBo.js";const o={path:`/user/video/:uid/:embed?`,categories:[`social-media`],view:n.Videos,example:`/bilibili/user/video/2267573`,parameters:{uid:`用户 id, 可在 UP 主主页中找到`,embed:`默认为开启内嵌视频, 任意值为关闭`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`space.bilibili.com/:uid`],target:`/user/video/:uid`}],name:`UP 主投稿`,maintainers:[`DIYgod`,`Konano`,`pseudoyu`],handler:s};async function s(n){let o=n.req.param(`uid`),s=!n.req.param(`embed`),c=await a.getCookie(),l=await a.getWbiVerifyString(),u=i.getDmImgList(),d=i.getDmImgInter(),f=await a.getRenderData(o),[p,m]=await a.getUsernameAndFaceFromUID(o),h=i.addWbiVerifyInfo(i.addRenderData(i.addDmVerifyInfoWithInter(`mid=${o}&ps=30&tid=0&pn=1&keyword=&order=pubdate&platform=web&web_location=1550101&order_avoided=true`,u,d),f),l),g=await t(`https://api.bilibili.com/x/space/wbi/arc/search?${h}`,{headers:{Referer:`https://space.bilibili.com/${o}/video?tid=0&pn=1&keyword=&order=pubdate`,Cookie:c}}),_=g.data;if(_.code)throw e.error(JSON.stringify(_.data)),Error(`Got error code ${_.code} while fetching: ${_.message}`);return{title:`${p} 的 bilibili 空间`,link:`https://space.bilibili.com/${o}`,description:`${p} 的 bilibili 空间`,image:m??void 0,logo:m??void 0,icon:m??void 0,item:_.data&&_.data.list&&_.data.list.vlist&&await Promise.all(_.data.list.vlist.map(async e=>{let t=await a.getVideoSubtitle(e.bvid);return{title:e.title,description:i.renderUGCDescription(s,e.pic,e.description,e.aid,void 0,e.bvid),pubDate:new Date(e.created*1e3).toUTCString(),link:e.created>i.bvidTime&&e.bvid?`https://www.bilibili.com/video/${e.bvid}`:`https://www.bilibili.com/video/av${e.aid}`,author:p,comments:e.comment,attachments:e.bvid?[{url:r(e.bvid),mime_type:`text/html`},...t.map(e=>({url:`data:text/plain;charset=utf-8,${encodeURIComponent(e.content)}`,mime_type:`text/srt`,title:`字幕 - ${e.lan_doc}`}))]:void 0}}))}}export{o as route};