import{__dirname as e,init_esm_shims as t}from"./esm-shims-CGUM9TC6.js";import"./config-C9m9eBw5.js";import"./logger-CC3afzWM.js";import{parseDate as n}from"./parse-date-D4osZfpm.js";import"./dist-0j_z2rfc.js";import"./helpers-nWIDkd0K.js";import{cache_default as r}from"./cache-GwMhal7i.js";import{art as i}from"./render-DOz85fGU.js";import"./ofetch-ZUQ1sEMc.js";import{got_default as a}from"./got-CB83B8oA.js";import{timezone as o}from"./timezone-BrNu6iXe.js";import s from"node:path";import{load as c}from"cheerio";t();const l=`https://weixin.shmtu.edu.cn/dynamic/shmtuHttps`,u=`https://portal.shmtu.edu.cn/api`,d=async e=>{let t=await a.post(l,{form:{interfaceUrl:e},https:{rejectUnauthorized:!1}});return JSON.parse(t.data)},f=(t,n)=>Promise.all(t.map(t=>n.tryGet(t.link,async()=>{let n=await d(t.link),r=n.field_file,a=n.field_image;return t.description=i(s.join(e,`templates/portal-9c9e2508.art`),{body:n.body.und[0].safe_value,images:a.length!==0&&Object.keys(a).length!==0?a.und:null,files:r.length!==0&&Object.keys(r).length!==0?r.und:null}),t.link=n.path,t}))),p={path:`/portal/:type`,categories:[`university`],example:`/shmtu/portal/bmtzgg`,parameters:{type:`类型名称`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`portal.shmtu.edu.cn/:type`]}],name:`数字平台`,maintainers:[`imbytecat`],handler:m,description:`| 部门通知公告 | 学术与大型活动公告 | 部门动态 |
| ------------ | ------------------ | -------- |
| bmtzgg       | xsydxhdgg          | bmdt     |`};async function m(e){let t=e.req.param(`type`),i;switch(t){case`bmtzgg`:i=`部门通知公告`;break;case`xsydxhdgg`:i=`学术与大型活动公告`;break;case`bmdt`:i=`部门动态`;break;default:i=`未知`;break}let s=await a.post(l,{form:{interfaceUrl:`${u}/${t}.json?page=0`},https:{rejectUnauthorized:!1}}),d=JSON.parse(s.data).map(e=>({title:c(e.title).text(),link:`${u}/node/${e.nid}.json`,pubDate:o(n(e.created),8),category:e.field_department[0],author:e.field_department[0]})),p=await f(d,r);return{title:`上海海事大学 ${i}`,link:`https://portal.shmtu.edu.cn/bumentongzhigonggao`,description:`上海海事大学 数字平台`,item:p}}export{p as route};