import"./esm-shims-CGUM9TC6.js";import"./config-C9m9eBw5.js";import"./logger-CC3afzWM.js";import{parseDate as e}from"./parse-date-D4osZfpm.js";import"./dist-0j_z2rfc.js";import"./helpers-nWIDkd0K.js";import{cache_default as t}from"./cache-GwMhal7i.js";import"./ofetch-ZUQ1sEMc.js";import{got_default as n}from"./got-CB83B8oA.js";import{timezone as r}from"./timezone-BrNu6iXe.js";import{load as i}from"cheerio";const a=`https://cs.whu.edu.cn`,o={path:`/cs/:type`,categories:[`university`],example:`/whu/cs/2`,parameters:{type:`公告类型，详见表格`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`计算机学院公告`,maintainers:[`ttyfly`],handler:s,description:`| 公告类型 | 学院新闻 | 学术交流 | 通知公告 | 科研进展 |
| -------- | -------- | -------- | -------- | -------- |
| 参数     | 0        | 1        | 2        | 3        |`};async function s(o){let s=Number.parseInt(o.req.param(`type`)),c;switch(s){case 0:c=`${a}/xwdt/xyxw.htm`;break;case 1:c=`${a}/kxyj/xsjl.htm`;break;case 2:c=`${a}/xwdt/tzgg.htm`;break;case 3:c=`${a}/kxyj/kyjz.htm`;break;default:throw Error(`Unknown type: ${s}`)}let l=await n(c),u=i(l.data),d=u(`div.study ul li`).toArray().map(t=>(t=u(t),{title:t.find(`a p`).text().trim(),pubDate:e(t.find(`span`).text()),link:new URL(t.find(`a`).attr(`href`),c).href})),f=await Promise.all(d.map(a=>t.tryGet(a.link,async()=>{let t;try{t=await n(a.link)}catch{return null}let o=i(t.data);if(o(`.prompt`).length)return a.description=o(`.prompt`).html(),a;let s=o(`.content`);return s.find(`img`).each((e,t)=>{if(t=o(t),t.attr(`orisrc`)){let e=new URL(t.attr(`orisrc`),`https://cs.whu.edu.cn`);t.attr(`src`,e.href),t.removeAttr(`orisrc`),t.removeAttr(`vurl`)}}),a.description=s.html(),a.pubDate=o(`meta[name="PubDate"]`).length?r(e(o(`meta[name="PubDate"]`).attr(`content`)),8):a.pubDate,a})));return f=f.filter(e=>e!==null),{title:u(`title`).first().text(),link:c,item:f}}export{o as route};