import"./esm-shims-CGUM9TC6.js";import"./config-C9m9eBw5.js";import"./logger-CC3afzWM.js";import{parseRelativeDate as e}from"./parse-date-D4osZfpm.js";import"./dist-0j_z2rfc.js";import"./helpers-nWIDkd0K.js";import{cache_default as t}from"./cache-GwMhal7i.js";import"./ofetch-ZUQ1sEMc.js";import{got_default as n}from"./got-CB83B8oA.js";import{load as r}from"cheerio";const i=`http://www.moa.gov.cn/`,a=new URL(i),o={path:`/moa/suburl/:suburl{.+}`,categories:[`government`],example:`/gov/moa/suburl/gk/zcjd/`,radar:[{source:[`moa.gov.cn/`],target:`/moa/suburl/:suburl`}],parameters:{suburl:`下级目录，请使用最下级的目录`},name:`中华人民共和国农业农村部 - 新闻`,maintainers:[`Origami404`,`lyqluis`],handler:s,url:`moa.gov.cn/`,description:"更多例子：\n  -   `农业农村部动态`的网页链接是`http://www.moa.gov.cn/xw/zwdt/`, 对应的`suburl`是`xw/zwdt`\n  -   `财务公开`的网页链接是`http://www.moa.gov.cn/gk/cwgk_1/`, 对应的`suburl`是`gk/cwgk_1`\n  -   像[政策法规](http://www.moa.gov.cn/gk/zcfg/)这种页面(`http://www.moa.gov.cn/gk/zcfg/`), 它**不是**一个合法的分类目录，它是`法律`, `行政法规`, `部门规章`等一堆栏目的集合，这时候请点开对应栏目的`更多 >>`进入栏目的最下级目录，再根据上面的规则提取`suburl`\n  -   特别地，`图片新闻`对应的`suburl`为`xw/tpxw/`, `最新公开`对应的`suburl`为`govpublic`, `数据>最新发布`对应的`suburl`为`sj/zxfb`"};async function s(e){let t=e.req.param(`suburl`),n=t.slice(-1)===`/`?t:t+`/`;return n===`xw/tpxw/`?await c(n,{channelTitleSelector:`.pub-media2-head`,listSelector:`.tupian_list li`,titleSelector:`a[class="block w_fill ellipsis adc ahc"]`,dateSelector:`span`}):n.startsWith(`sj/zxfb`)?await d():n.startsWith(`gk`)?await c(n,{channelTitleSelector:`title`,listSelector:`.commonlist li`,titleSelector:`a`,dateSelector:`span`}):n.startsWith(`govpublic`)?await c(`govpublic/1/index.htm`,{channelTitleText:`最新公开`,listSelector:`.commonlist li`,titleSelector:`a`,dateSelector:`span`}):await c(n,{channelTitleSelector:`.pub-media1-head-title`,listSelector:`.ztlb`,titleSelector:`a`,dateSelector:`span`})}async function c(a,o){let{channelTitleSelector:s,listSelector:c,titleSelector:d,dateSelector:f,channelTitleText:m}=o,h=a.startsWith(`http`)?a:i+a,g=await n.get(h),_=r(g.data),v=m??_(s).text(),y=_(c).toArray().map(t=>{let n=_(t),r=n.find(d),i=r.text(),[a,o]=p(r,h),s=n.find(f).text().trim();return{pageType:o,title:i,link:a,pubDate:e(s)}}),b=await Promise.all(y.map(async e=>{let n=e.link,r=await t.get(n);return r?JSON.parse(r):(e.pageType===`normal`?e=await l(n,e):e.pageType===`govpublic`?e=await u(n,e):e.description=`外部链接：${e.link}`,t.set(n,JSON.stringify(e)),e)}));return{title:`中华人民共和国农业农村部 - ${v}`,link:h,item:b}}async function l(t,i){let a=await n.get(t),o=r(a.data);if(t.includes(`zbft`)){let e=o(`.nybzb`).html()??``,t=o(`.tpsl`).html()??``,n=o(`.wzsl`).html()??``;return i.description=e+t+n,i}let s=o(`.bjjMAuthorBox span.dc_2`).toArray(),c=o(s[1]).text(),l=o(s[2]).text();i.author=`${c} ${l}`;let u=o(s[0]).text(),d=/\d{4}-\d{2}-\d{2}/.exec(u),f=/\d{2}:\d{2}/.exec(u);return i.pubDate=e(`${d[0]} ${f[0]}`),i.description=o(`.arc_body`).html(),i}async function u(e,t){if(t.link.endsWith(`.pdf`))return t;let i=await n.get(e),a=r(i.data),o=a(`.gsj_htmlcon_bot`),[,s,c,l]=a(`.pubtime`).text().match(/：(\d{4})[|年-](\d{1,2})[|月-](\d{1,2})日?/),[,u]=a(`.pubtime.source`)?.text()?.match(/：(.+)/)??[null,``];return s&&c&&l&&(t.pubDate=`${s}-${c}-${l}`),t.author=u,t.description=o.html(),t}async function d(){let e=await n({url:`http://zdscxx.moa.gov.cn:8080/nyb/getMessages`,method:`post`,json:{page:1,rows:20,type:`最新发布`,isLatestMessage:!0}}),r=await Promise.all(e.data.result.table.map(e=>{let{date:n,id:r}=e;e.pubDate=n;let i=e.link=`http://zdscxx.moa.gov.cn:8080/nyb/pc/messageView.jsp?id=${r}`;return t.tryGet(i,async()=>{let{content:t,source:n}=await f(r);return e.description=t,e.author=n,e})}));return{title:`中华人民共和国农业农村部 - 数据 - 最新发布`,link:`http://zdscxx.moa.gov.cn:8080/nyb/pc/messageList.jsp`,item:r}}async function f(e){let t=await n({url:`http://zdscxx.moa.gov.cn:8080/nyb/getMessagesById`,method:`post`,form:{id:e}});return t.data.result}function p(e,t){let n=e.attr(`href`),{host:r,href:i}=new URL(n,t),o=null;return o=r===a.host?i.includes(`gk`)||i.includes(`govpublic`)?`govpublic`:`normal`:`outside`,[i,o]}export{o as route};