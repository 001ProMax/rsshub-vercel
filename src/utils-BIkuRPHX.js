import{__dirname as e,init_esm_shims as t}from"./esm-shims-CGUM9TC6.js";import{parseDate as n}from"./parse-date-D4osZfpm.js";import{art as r}from"./render-DOz85fGU.js";import{got_default as i}from"./got-CB83B8oA.js";import a from"node:path";import o from"@bbob/html";import s from"@bbob/preset-html5";t();const c=`https://instant.1point3acres.com`,l=`https://api.1point3acres.com`,u={new:`最新帖子`,hot:`热门帖子`},d=e=>e.walk(e=>typeof e==`string`&&e===`
`?{tag:`br`,content:null}:e),f=async(t,u,f)=>{let p=await i({method:`get`,url:u,headers:{referer:c}}),m=await Promise.all(p.data.threads.map(u=>{let p={guid:u.tid,title:u.subject,author:u.author,link:`${c}/thread/${u.tid}`,description:u.summary,pubDate:n((f===``?u.lastpost:u.dateline)*1e3),category:[u.forum_name,...u.tags.map(e=>e.displayname)]};return t(p.link,async()=>{try{let t=await i({method:`get`,url:`${l}/api/v3/threads/${p.guid}`,headers:{referer:c}}),n=t.data.thread,u=s.extend(e=>({...e,attach:(e,{render:t})=>{let r=t(e.content),i=n.attachment_list.find(e=>e.aid===Number.parseInt(r));return i.isimage?{tag:`img`,attrs:{src:i.url}}:{tag:`a`,attrs:{href:`https://www.1point3acres.com/bbs/plugin.php?id=attachcenter:page&aid=${r}`,rel:`noopener`,target:`_blank`},content:`https://www.1point3acres.com/bbs/plugin.php?id=attachcenter:page&aid=${r}`}},url:e=>{let t=Object.keys(e.attrs)[0];if(t.startsWith(`https://link.1p3a.com/?url=`)){let n=decodeURIComponent(t.replace(`https://link.1p3a.com/?url=`,``));return{tag:`a`,attrs:{href:n,rel:`noopener`,target:`_blank`},content:e.content}}return{tag:`a`,attrs:{href:t,rel:`noopener`,target:`_blank`},content:e.content}}}));if(p.description=o(n.message_bbcode,[u(),d]),!n.message_bbcode.includes(`[attach]`)&&n.attachment_list.length>0)for(let t of n.attachment_list)p.description+=t.isimage===1?`<br>`+r(a.join(e,`templates/image-8260a861.art`),{url:t.url,height:t.height,width:t.width}):``}catch{}return p})}));return m};export{f as ProcessThreads,l as apiRootUrl,c as rootUrl,u as types};