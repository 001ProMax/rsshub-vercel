import"./esm-shims-DtWyl6zt.js";import"./config-CT-9jq-j.js";import"./logger-BsClR5PH.js";import"./dist-Bbb0mfHh.js";import"./helpers-DzX-lcQO.js";import{cache_default as e}from"./cache-DNP0KCHb.js";import{parseDate as t}from"./parse-date-Bgabdhlb.js";import"./ofetch-Dnmc-sKl.js";import{got_default as n}from"./got-CdHCxDMi.js";import{InvalidParameterError as r}from"./invalid-parameter-BQKLs9qN.js";import{isValidHost as i}from"./valid-host-DEPw8oAS.js";import{load as a}from"cheerio";const o={path:`/:domain/tag/:tag`,name:`Unknown`,maintainers:[],handler:s};async function s(o){let{domain:s=`news`,tag:c}=o.req.param();if(!i(s))throw new r(`Invalid domain`);let l=`https://${s}.gamme.com.tw`,u=`${l}/tag/${c}`,{data:d}=await n(u),f=a(d),p=f(`#category_new li a, .List-4 h3 a`).toArray().map(e=>(e=f(e),{title:e.attr(`title`)||e.text(),link:e.attr(`href`)})),m=await Promise.all(p.map(r=>e.tryGet(r.link,async()=>{let{data:e}=await n(r.link),i=a(e);return i(`.entry img`).each((e,t)=>{(t.attribs[`data-original`]||t.attribs[`data-src`])&&(t.attribs.src=t.attribs[`data-original`]||t.attribs[`data-src`],delete t.attribs[`data-original`],delete t.attribs[`data-src`])}),r.author=i(`.author_name`).text().trim(),r.category=i(`.tags a`).toArray().map(e=>i(e).text()),i(`.social_block, .tags`).remove(),r.pubDate=t(i(`.postDate`).attr(`content`)),r.description=i(`.entry`).html(),r})));return{title:`${c} | ${s===`news`?`宅宅新聞`:`西斯新聞`}`,description:f(`meta[name=description]`).attr(`content`),link:u,image:s===`news`?`${l}/blogico.ico`:`${l}/favicon.ico`,item:m}}export{o as route};