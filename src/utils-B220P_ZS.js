import{parseDate as e}from"./parse-date-D4osZfpm.js";import{cache_default as t}from"./cache-GwMhal7i.js";import{got_default as n}from"./got-CB83B8oA.js";import{load as r}from"cheerio";const i={doujin:{title:`.doujin-title`,description:[`.doujin-detail`,`.section`,`.area-buy > a.btn`]},video:{title:`.video-title`,description:[`.video-data`,`.section`,`.lp-samplearea a.btn`]},article:{title:`.article_title`,description:[`.article_icatch`,`.article_contents`]}};function a(e){let t={doujin:[`/cg/`,`/comic/`,`/voice/`],video:[`/nipple-video/`],article:[`/post-`]};for(let[n,r]of Object.entries(t))if(r.some(t=>e.includes(t)))return n;throw Error(`Unknown content type for link: ${e}`)}async function o(o){let c=await Promise.all(o.map(o=>t.tryGet(o.link,async()=>{let t=await n(o.link),c=r(t.data),l=a(o.link),u=i[l],d=c(u.title).text().trim()||o.title,f=s(u.description.map(e=>c(e).prop(`outerHTML`)).join(``)),p=c(`meta[property="article:published_time"]`).attr(`content`),m=p?e(p):void 0;return{title:d,description:f,link:o.link,pubDate:m}})));return c.filter(e=>e!==null)}function s(e){let t=r(e);return t(`body`).children().toArray().map(e=>t(e).clone().wrap(`<div>`).parent().html()).join(``)}const c=`https://chikubi.jp/wp-json/wp/v2`;async function l(r){let i=`${c}/posts${r?.length?`?include=${r.join(`,`)}`:``}`,a=await t.tryGet(i,async()=>{let t=await n(i),r=JSON.parse(t.body);if(!Array.isArray(r))throw TypeError(`No posts found for the given IDs`);return r.map(({title:t,link:n,date:r,content:i})=>({title:t.rendered,link:n,pubDate:e(r),description:s(i.rendered)}))});return(Array.isArray(a)?a:[]).filter(e=>e!==null)}const u={tag:`tags`,category:`categories`};async function d(e,t){let r=`${c}/${u[e]}?slug=${encodeURIComponent(t)}`,{body:i}=await n(r),a=JSON.parse(i);if(a?.[0]){let{id:e,name:t}=a[0];return{id:e,name:t}}throw Error(`No ${e} found for slug: ${t}`)}async function f(r,i){let a=`${c}/posts?${u[r]}=${i}`,o=await t.tryGet(a,async()=>{let{body:t}=await n(a),r=JSON.parse(t);return Array.isArray(r)&&r.length>0?r.map(({title:t,link:n,date:r,content:i})=>({title:t.rendered,link:n,pubDate:e(r),description:s(i.rendered)})):[]});return(Array.isArray(o)?o:[]).filter(e=>e!==null)}export{d as getBySlug,l as getPosts,f as getPostsBy,o as processItems};