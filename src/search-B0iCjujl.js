import{__dirname as e,init_esm_shims as t}from"./esm-shims-CGUM9TC6.js";import"./config-C9m9eBw5.js";import"./logger-CC3afzWM.js";import{parseDate as n}from"./parse-date-D4osZfpm.js";import"./dist-0j_z2rfc.js";import"./helpers-nWIDkd0K.js";import{cache_default as r}from"./cache-GwMhal7i.js";import{art as i}from"./render-DOz85fGU.js";import"./md5-4BNsOP-F.js";import"./ofetch-ZUQ1sEMc.js";import"./got-CB83B8oA.js";import"./config-not-found-BVqhRP9D.js";import{apiMapCategory as a,defaultDomain as o,getApiUrl as s,getRootUrl as c,processApiItems as l}from"./utils-BGFcBXUE.js";import u from"node:path";t();const d={path:`/search/:option?/:category?/:keyword?/:time?/:order?`,categories:[`anime`],example:`/18comic/search/photos/all/NTR`,parameters:{option:"选项，可选 `video` 和 `photos`，默认为 `photos`",category:"分类，同上表，默认为 `all` 即全部",keyword:`关键字，同上表，默认为空`,time:"时间范围，同上表，默认为 `a` 即全部",order:"排列顺序，同上表，默认为 `mr` 即最新"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`jmcomic.group/`],target:`/:category?/:time?/:order?/:keyword?`}],name:`搜索`,maintainers:[],handler:f,url:`jmcomic.group/`,description:`::: tip
  关键字必须超过两个字，这是来自网站的限制。
:::`};async function f(t){let d=t.req.param(`option`)??`photos`,f=t.req.param(`category`)??`all`,p=t.req.param(`keyword`)??``,m=t.req.param(`time`)??`a`,{domain:h=o}=t.req.query(),g=c(h),_=t.req.param(`order`)??`mr`,v=`${g}/search/${d}${f===`all`?``:`/${f}`}${p?`?search_query=${p}`:`?`}${m===`a`?``:`&t=${m}`}${_===`mr`?``:`&o=${_}`}`,y=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`)):20,b=s();_=m===`a`?_:`${_}_${m}`,b=`${b}/search?search_query=${p}&o=${_}`;let x=await l(b),S=x.content;f!==`all`&&(S=x.content.filter(e=>e.category.title===a(f))),S=S.slice(0,y);let C=await Promise.all(S.map(t=>r.tryGet(`18comic:search:${t.id}`,async()=>{let r={};return r.title=t.name,r.link=`${g}/album/${t.id}`,r.guid=`18comic:/album/${t.id}`,r.updated=n(t.update_at),b=`${s()}/album?id=${t.id}`,x=await l(b),r.pubDate=new Date(x.addtime*1e3),r.category=x.tags.map(e=>e),r.author=x.author.map(e=>e).join(`, `),r.description=i(u.join(e,`templates/description-afe7e434.art`),{introduction:x.description,images:[`https://cdn-msp3.${h}/media/albums/${t.id}_3x4.jpg`],cover:`https://cdn-msp3.${h}/media/albums/${t.id}_3x4.jpg`,category:r.category}),r})));return{title:`Search Results For '${p}' - 禁漫天堂`,link:v.replace(/\?$/,``),item:C,allowEmpty:!0}}export{d as route};