import"./esm-shims-DtWyl6zt.js";import{config as e}from"./config-CT-9jq-j.js";import"./logger-BsClR5PH.js";import"./dist-BrnquCU2.js";import"./helpers-DzX-lcQO.js";import{cache_default as t}from"./cache-DNP0KCHb.js";import"./md5-4BNsOP-F.js";import"./ofetch-Of9UBhau.js";import{got_default as n}from"./got-Cw3q2eEq.js";import"./config-not-found-2m672-Jl.js";import{_constants_default as r,getFilteredLanguages as i,getMangaMetaByIds as a,getToken as o,toQueryString as s}from"./_feed-DJvMbbUC.js";const c={name:`MDList Feed`,path:`/mdlist/:id/:lang?`,radar:[{source:[`mangadex.org/list/:id/:suffix`],target:`/mdlist/:id`}],description:`Sepcific MangaDex MDList Feed`,example:`/mangadex/mdlist/10cca803-8dc9-4f0e-86a8-6659a3ce5188?limit=10&private=true`,maintainers:[`chrisis58`],categories:[`anime`],parameters:{id:{description:`The list id of the manga list`},private:{description:`(Query Param) Needed to access private lists, any value will be treated as true`}},features:{requireConfig:[{name:`MANGADEX_USERNAME`,description:`MangaDex Username, required when refresh-token is not set and the list is private`,optional:!0},{name:`MANGADEX_PASSWORD`,description:`MangaDex Password, required when refresh-token is not set and the list is private`,optional:!0},{name:`MANGADEX_CLIENT_ID`,description:`MangaDex Client ID, required when the list is private`,optional:!0},{name:`MANGADEX_CLIENT_SECRET`,description:`MangaDex Client Secret, required when the list is private`,optional:!0},{name:`MANGADEX_REFRESH_TOKEN`,description:`MangaDex Refresh Token, required when username and password are not set and the list is private`,optional:!0}]},handler:l};async function l(c){let{id:l,lang:u}=c.req.param(),d=c.req.query(`limit`)?Number.parseInt(c.req.query(`limit`)):25,f=!!c.req.query(`private`),p=f?await o():void 0,m=new Set([...typeof u==`string`?[u]:u||[],...await i()].filter(Boolean)),{listName:h,listAuthor:g}=await t.tryGet(`mangadex:mdlist-info-${l}`,async()=>{let t=await n.get(`${r.API.BASE}/list/${l}${s({includes:[`user`]})}`,{headers:{Authorization:String(f?`Bearer ${p}`:``),"User-Agent":e.trueUA}}),i=t?.data?.data;if(!i)throw Error(`Failed to retrieve user follows from MangaDex API.`);let a=i.attributes.name,o=i.relationships.find(e=>e.type===`user`)?.attributes.username;return{listName:a,listAuthor:o}},e.cache.contentExpire),_=await t.tryGet(`mangadex:mdlist-feed-${l}`,async()=>{let t=await n.get(`${r.API.BASE}/list/${l}/feed${s({limit:d,translatedLanguage:m,order:{publishAt:`desc`}})}`,{headers:{Authorization:String(f?`Bearer ${p}`:``),"User-Agent":e.trueUA}}),i=t?.data?.data;if(!i)throw Error(`Failed to retrieve user follows from MangaDex API.`);return i},e.cache.routeExpire,!1),v=_.map(e=>e?.relationships.find(e=>e.type===`manga`)?.id),y=await a(v);return{title:`MDList - ${h} by ${g}`,link:`https://mangadex.org/list/${l}?tab=feed`,description:`The latest updates of all the manga in a sepcific list`,item:_.map(e=>{let t=e.relationships.find(e=>e.type===`manga`)?.id,n=y.get(t),i=[e.attributes.volume?`Vol. ${e.attributes.volume}`:null,e.attributes.chapter?`Ch. ${e.attributes.chapter}`:null,e.attributes.title].filter(Boolean).join(` `);return{title:n?.title||`Unknown`,link:`${r.API.MANGA_CHAPTERS}${e.id}`,pubDate:new Date(e.attributes.publishAt),description:i,image:n?.cover}})}}export{c as route};