import{__dirname as e,init_esm_shims as t}from"./esm-shims-CGUM9TC6.js";import"./config-C9m9eBw5.js";import"./logger-CC3afzWM.js";import{parseDate as n}from"./parse-date-D4osZfpm.js";import"./dist-0j_z2rfc.js";import"./helpers-nWIDkd0K.js";import{cache_default as r}from"./cache-GwMhal7i.js";import{art as i}from"./render-DOz85fGU.js";import"./ofetch-ZUQ1sEMc.js";import{got_default as a}from"./got-CB83B8oA.js";import o from"node:path";import{load as s}from"cheerio";t();const c=`https://nzmz.xyz`,l=async(e,t,n,r,i)=>{let o=await e(t,async()=>{let{data:e}=await a(t);return e}),l=s(o);return l(r).eq(Number.parseInt(n,10)).find(i).toArray().map(e=>(e=l(e),{link:new URL(e.prop(`href`),c).href}))},u=(e,t)=>e(`newzmz#${t.match(/details-(.*?)\.html/)[1]}`,async()=>{let{data:e}=await a(t),r=s(e),i=r(`div.chsname`).text(),o=r(`div.engname`).text(),c=r(`div.aliasname`).text().replace(/又名：/,``).split(`/`).map(e=>e.trim()).filter(Boolean),l=r(`a.addgz`).prop(`href`);return{link:l,pubDate:n(r(`span.duration`).first().text().match(/(\d{4}-\d{2}-\d{2})/)[1]),description:{image:r(`div.details-bg img`).prop(`src`),nameZh:i,nameEn:o,alias:c,update:r(`span.upday`).text(),links:r(`div.ep-infos a[title]`).toArray().map(e=>(e=r(e),{title:e.prop(`title`),link:e.prop(`href`)}))},author:r(`ul.sws-list`).first().find(`h5.title`).toArray().map(e=>r(e).text()).join(` / `),category:[i,o,...c]}}),d=async(t,n,r,c,l)=>{let{data:u}=await a(t.link),d=s(u);return d(r).toArray().map(r=>{r=d(r);let a=r.find(c).toArray().map(e=>d(e).text()),s=r.find(l).toArray().map(e=>(e=d(e),{title:e.find(`p.link-name`).text(),link:e.find(`a[title]`).prop(`href`)})),u=r.find(`span.up`).text().replaceAll(/[\s-]+/g,``),f=`${t.description.nameZh||t.description.nameEn}|${u}`,p=`newzmz#${t.link.match(/view\/(.*?)\.html/)[1]}-${u}`;return{guid:p,title:f,link:t.link,description:i(o.join(e,`templates/description-f7b4d948.art`),{...t.description,categories:a,downLinks:s}),author:t.author,category:[...t.category,...a].filter(Boolean),pubDate:t.pubDate,enclosure_url:s.findLast(e=>e.title===n)?.link??s[0].link,enclosure_type:`application/x-bittorrent`}})},f={path:`/:id?/:downLinkType?`,categories:[`multimedia`],example:`/newzmz/qEzRyY3v`,parameters:{id:`剧集 id，可在剧集下载页 URL 中找到`,downLinkType:`下载链接类型，默认为磁力链`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`newzmz.com/`],target:``}],name:`指定剧集`,maintainers:[`nczitzk`],handler:p,url:`newzmz.com/`,description:"::: tip\n  [雪国列车 (剧版)](https://nzmz.xyz/details-qEzRyY3v.html) 的下载页 URL 为 `https://v.ys99.xyz/view/qEzRyY3v.html`，即剧集 id 为 `qEzRyY3v`\n:::"};async function p(e){let{id:t=`1`,downLinkType:n=`磁力链`}=e.req.param(),i=e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`),10):50,o=!Number.isNaN(t),f=new URL(o?`index.html`:`details-${t}.html`,c).href,p=await r.tryGet(f,async()=>{let{data:e}=await a(f);return e}),m=s(p),h=o?await l(r.tryGet,f,t,`div.rowMod`,`ul.slides li a`):[{link:f}];h=await Promise.all(h.slice(0,i).map(e=>u(r.tryGet,e.link))),h=await Promise.all(h.filter(e=>e.link!==`#`).map(e=>d(e,n,`div.team-con-area`,`div.item-label a`,`ul.team-icons li`))),h=h.flat();let g=o?m(`div.rowMod`).eq(Number.parseInt(t,10)).find(`h2.row-header-title`).text():``,_=`${m(`title`).text()}${g?` - ${g}`:``}`,v=m(`link[rel="shortcut icon"]`).prop(`href`);return{item:o?h:h.slice(0,i),title:_,link:f,description:m(`meta[name="description"]`).prop(`content`),language:`zh-cn`,image:m(`img.logo-img`).prop(`src`),icon:v,logo:v,subtitle:m(`meta[name="keywords"]`).prop(`content`),author:_,allowEmpty:!0}}export{f as route};