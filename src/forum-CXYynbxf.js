import{__dirname as e,init_esm_shims as t}from"./esm-shims-CGUM9TC6.js";import{config as n}from"./config-C9m9eBw5.js";import"./logger-CC3afzWM.js";import{parseDate as r}from"./parse-date-D4osZfpm.js";import"./dist-0j_z2rfc.js";import"./helpers-nWIDkd0K.js";import{cache_default as i}from"./cache-GwMhal7i.js";import{art as a}from"./render-DOz85fGU.js";import"./ofetch-ZUQ1sEMc.js";import{got_default as o}from"./got-CB83B8oA.js";import s from"node:path";import c from"crypto-js";const l=`https://api.wfdata.club`,u=`https://www.feng.com`,d=e=>{let t=new URL(e).pathname,n=c.enc.Utf8.parse(`url=`+t+`$time=`+Date.now()+`000000`),r=c.enc.Utf8.parse(`2b7e151628aed2a6`),i=c.AES.encrypt(n,r,{iv:r,mode:c.mode.CBC,padding:c.pad.Pkcs7}).toString();return i},f=e=>{let t=`${l}/v1/topic/category`;return i.tryGet(t,async()=>{let n=await o(t,{headers:{Referer:`${u}/forum/${e}`,"X-Request-Id":d(t)}});return n.data},n.cache.routeExpire,!1)},p=async e=>{let t=await f(e);return Object.values(t.data.dataList).find(t=>t.dataList.find(t=>t.topicId===e))},m=(e,t)=>{let r=`${l}/v1/topic/${e}/thread?topicId=${e}&type=${t}&pageCount=50&order=${t===`newest`?`replyTime`:`postTime`}&page=1`;return i.tryGet(r,async()=>{let t=await o(r,{headers:{Referer:`${u}/forum/${e}`,"X-Request-Id":d(r)}});return t.data},n.cache.routeExpire,!1)},h=(e,t)=>{let n=`${l}/v1/thread/${e}`;return i.tryGet(n,async()=>{let e=await o(n,{headers:{Referer:`${u}/forum/${t}`,"X-Request-Id":d(n)}});return e.data})};t();const g={path:`/forum/:id/:type?`,categories:[`bbs`],example:`/feng/forum/1`,parameters:{id:`版块 ID，可在版块 URL 找到`,type:"排序，见下表，默认为 `all`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`feng.com/forum/photo/:id`,`feng.com/forum/:id`],target:`/forum/:id`}],name:`社区`,maintainers:[`TonyRL`],handler:_,description:`| 最新回复 | 最新发布 | 热门 | 精华    |
| -------- | -------- | ---- | ------- |
| newest   | all      | hot  | essence |`};async function _(t){let n=Number(t.req.param(`id`)),{type:i=`all`}=t.req.param(),o=await p(n),c=o.dataList.find(e=>e.topicId===n),l=(await m(n,i)).data.dataList.map(e=>({title:e.title,pubDate:r(e.dateline*1e3),author:e.userBaseInfo.userName,link:`${u}/post/${e.tid}`,tid:e.tid})),d=await Promise.all(l.map(async t=>{let r=await h(t.tid,n);if(r.status.code===0){let n=a(s.join(e,`templates/img-8d8353ed.art`),{images:r.data.thread.fengTalkImage.length?r.data.thread.fengTalkImage:void 0});t.description=r.data.thread.message+n}else t.description=a(s.join(e,`templates/deleted-48cd3c75.art`),{});return delete t.tid,t}));return{title:`${c.topicName} - 社区 - 威锋 - 千万果粉大本营`,description:c.topicDescription,link:`${u}/forum/${n}`,item:d}}export{g as route};