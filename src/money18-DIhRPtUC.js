import{__dirname as e,init_esm_shims as t}from"./esm-shims-CGUM9TC6.js";import"./config-C9m9eBw5.js";import"./logger-CC3afzWM.js";import{parseDate as n}from"./parse-date-D4osZfpm.js";import"./dist-0j_z2rfc.js";import"./helpers-nWIDkd0K.js";import{cache_default as r}from"./cache-GwMhal7i.js";import{art as i}from"./render-DOz85fGU.js";import"./ofetch-ZUQ1sEMc.js";import{got_default as a}from"./got-CB83B8oA.js";import{timezone as o}from"./timezone-BrNu6iXe.js";import s from"node:path";import c from"dayjs";import{load as l}from"cheerio";t();const u={exp:`新聞總覽`,fov:`全日焦點`,industry:`板塊新聞`,int:`國際金融`,recagent:`大行報告`,ntlgroup:`A股新聞`,pro:`地產新聞`,weainvest:`投資理財`,ipo:`新股IPO`,tech:`科技財情`},d={path:`/money18/:id?`,categories:[`traditional-media`],example:`/oncc/money18/exp`,parameters:{id:`栏目 id，可在对应栏目页 URL 中找到，默认为 exp，即新聞總覽`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`Money18`,maintainers:[`nczitzk`],handler:f,description:`| 新聞總覽 | 全日焦點 | 板塊新聞 | 國際金融 | 大行報告 | A 股新聞 | 地產新聞 | 投資理財  | 新股 IPO | 科技財情 |
| -------- | -------- | -------- | -------- | -------- | -------- | -------- | --------- | -------- | -------- |
| exp      | fov      | industry | int      | recagent | ntlgroup | pro      | weainvest | ipo      | tech     |`};async function f(t){let d=t.req.param(`id`)??`exp`,f=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`)):30,p=`https://money18.on.cc`,m=`${p}/finnews/news_${d===`industry`?`industry.html`:`breaking.html?section=${d}`}`,h=`https://dyn.on.cc/api/asrh/v1/events/names/新股/articles?page=1&limit=${f}`,g=`${p}/cnt/utf8/content/articleList/sector_list_exp_1.js`,_=e=>`${p}/cnt/utf8/content/${e}/articleList/list_${d}_all.js`,v=d===`ipo`?h:d===`industry`?g:_(c().format(`YYYYMMDD`)),y=!1,b=[],x=0,S;for(;!y;)try{S=await a({method:`get`,url:v}),y=!0}catch(e){e.code===`ERR_NON_2XX_3XX_RESPONSE`&&(y=!1,v=_(c().subtract(++x,`day`).format(`YYYYMMDD`)))}return b=d===`ipo`?S.data.articles.map(t=>({title:t.title,author:t.authorname,link:`${p}/finnews/content/${d}/${t.articleId}.html`,description:i(s.join(e,`templates/money18-3f53584c.art`),{images:t.hasHdPhoto?[`https://hk.on.cc/hk/bkn${t.hdEnlargeThumbnail}`]:void 0,description:t.content}),pubDate:o(n(t.pubDate),8)})):d===`industry`?S.data.articles.slice(0,f).map(e=>({title:e.title,author:e.authorname,link:`${p}/finnews/content/${d}/${e.articleId}.html`,category:e.sector.map(e=>e.name),pubDate:o(n(e.pubDate),8)})):S.data.slice(0,f).map(e=>({title:e.title,author:e.authorname,link:`${p}/finnews/content/${d}/${e.articleId}.html`,pubDate:o(n(e.pubDate),8)})),d!==`ipo`&&(b=await Promise.all(b.map(t=>r.tryGet(t.link,async()=>{let n=await a({method:`get`,url:t.link}),r=l(n.data);return t.description=i(s.join(e,`templates/money18-3f53584c.art`),{images:r(`.photo img`).toArray().map(e=>r(e).attr(`src`)),description:r(`.content`).html()}),t})))),{title:`東網產經 - ${u[d]}`,link:m,item:b}}export{d as route};