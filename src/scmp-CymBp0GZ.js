import"./esm-shims-CGUM9TC6.js";import"./config-C9m9eBw5.js";import"./logger-CC3afzWM.js";import{parseDate as e}from"./parse-date-D4osZfpm.js";import"./dist-0j_z2rfc.js";import"./helpers-nWIDkd0K.js";import{cache_default as t}from"./cache-GwMhal7i.js";import"./ofetch-ZUQ1sEMc.js";import{got_default as n}from"./got-CB83B8oA.js";import{parseItem as r}from"./utils-hDeD_cnM.js";import{load as i}from"cheerio";const a={path:`/:category_id`,categories:[`traditional-media`],example:`/scmp/3`,parameters:{category_id:`Category`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`scmp.com/rss/:category_id/feed`]}],name:`News`,maintainers:[`proletarius101`],handler:s,description:`See the [official RSS page](https://www.scmp.com/rss) to get the ID of each category. This route provides fulltext that the offical feed doesn't.`},o=e=>{if(!e)return;let t={};for(let n in e)Object.hasOwn(e,n)&&(t[n]=e[n]);return t};async function s(a){let s=a.req.param(`category_id`),c=`https://www.scmp.com/rss/${s}/feed`,{data:l}=await n(c),u=i(l,{xmlMode:!0}),d=u(`item`).toArray().map(t=>{let n=u(t),r=n.find(`enclosure`).first(),i=n.find(String.raw`media\:content`).toArray()[0],a=n.find(String.raw`media\:thumbnail`).toArray()[0];return{title:n.find(`title`).text(),description:n.find(`description`).text(),link:n.find(`link`).text().split(`?utm_source`)[0],author:n.find(`author`).text(),pubDate:e(n.find(`pubDate`).text()),enclosure_url:r?.attr(`url`),enclosure_length:r?.attr(`length`),enclosure_type:r?.attr(`type`),media:{content:i?o(i.attribs):{},thumbnail:a?.attribs?o(a.attribs):void 0}}}),f=await Promise.all(d.map(e=>t.tryGet(e.link,()=>r(e))));return a.set(`json`,{items:f}),{title:u(`channel > title`).text(),link:u(`channel > link`).text(),description:u(`channel > description`).text(),item:f,language:`en-hk`,icon:`https://assets.i-scmp.com/static/img/icons/scmp-icon-256x256.png`,logo:`https://customerservice.scmp.com/img/logo_scmp@2x.png`,image:u(`channel > image > url`).text()}}export{a as route};