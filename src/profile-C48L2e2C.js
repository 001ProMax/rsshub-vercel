import{__dirname as e,init_esm_shims as t}from"./esm-shims-DtWyl6zt.js";import{config as n}from"./config-C9m9eBw5.js";import"./logger-CC3afzWM.js";import"./proxy-Br-Rb_Qy.js";import"./dist-CKN2M7CD.js";import{cache_default as r}from"./cache-Sft5n2jg.js";import{art as i}from"./render-CxhTJIsl.js";import{ofetch_default as a}from"./ofetch-CWsaZ4vY.js";import{not_found_default as o}from"./not-found-CRS5K6wf.js";import{puppeteer_default as s}from"./puppeteer-uO6s7chG.js";import c from"node:path";import{load as l}from"cheerio";const u=async(e,t)=>{let n=await t.newPage(),r=new Set([`document`,`script`,`xhr`,`fetch`]);await n.setRequestInterception(!0),n.on(`request`,e=>{r.has(e.resourceType())?e.continue():e.abort()}),await n.goto(e,{waitUntil:`domcontentloaded`}),await n.waitForSelector(`.content`);let i=await n.content();return await n.close(),i};t();const d={path:`/profile/:id/:type?/:functionalFlag?`,categories:[`social-media`],example:`/picuki/profile/linustech`,parameters:{id:`Tiktok user id (without @)`,type:{description:`Type of profile page`,options:[{value:`profile`,label:`Profile Page`},{value:`story`,label:`Story Page`}],default:`profile`},functionalFlag:{description:`Functional flag for video embedding`,options:[{value:`0`,label:`Off, only show video poster as an image`},{value:`1`,label:`On`}],default:`1`}},features:{requireConfig:!1,requirePuppeteer:!0,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`www.picuki.com/profile/:id`],target:`/profile/:id`},{source:[`www.picuki.com/story/:id`],target:`/profile/:id/story`}],name:`User Profile - Picuki`,maintainers:[`hoilc`,`Rongronggg9`,`devinmugen`,`NekoAria`],handler:f};async function f(t){let d=t.req.param(`id`),f=t.req.param(`type`)??`profile`,p=t.req.param(`functionalFlag`)??`1`,m=p!==`0`,h=`https://www.picuki.com`,g=`${h}/${f===`story`?`story`:`profile`}/${d}`,_=await r.tryGet(`picuki:${f}:${d}`,async()=>{let e;try{e=await a(g,{headers:{"User-Agent":n.trueUA}})}catch(t){if(t.status===403){let t=await s();e=await u(g,t),await t.close()}else throw new o(t.message)}let t=l(e);if(t(`.posts-empty`).length)throw Error(t(`.posts-empty`).text().trim()||`No posts found`);if(t(`.error-p`).length)throw Error(t(`.error-p span`).text().trim()||`Profile not found`);let r=t(`.profile-info .username`).text().trim(),i=t(`.posts-video .posts__video-item`).toArray().map(e=>{let n=t(e),i=n.attr(`href`)?.split(`/`).pop(),a=n.find(`img`);return{title:a.attr(`alt`)||``,author:r,renderData:{poster:a.attr(`src`),source:n.find(`.popup-open`).data(`source`),id:i},link:`${h}/media/${i}`,guid:`https://www.tiktok.com/@${d}/video/${i}`}});return{title:t(`head title`).text(),description:t(`.posts-current`).text().trim(),image:t(`.profile-image`).attr(`src`),items:i}}),v=_.items.map(t=>({...t,description:i(c.join(e,`templates/user-3df0b995.art`),{poster:t.renderData.poster,source:t.renderData.source,useIframe:m,id:t.renderData.id})}));return{title:_.title,link:g,image:_.image,description:_.description,item:v}}export{d as route};