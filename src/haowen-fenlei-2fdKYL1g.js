import"./esm-shims-CGUM9TC6.js";import{config as e}from"./config-C9m9eBw5.js";import"./logger-CC3afzWM.js";import{parseDate as t}from"./parse-date-D4osZfpm.js";import"./dist-0j_z2rfc.js";import"./helpers-nWIDkd0K.js";import{cache_default as n}from"./cache-GwMhal7i.js";import"./ofetch-ZUQ1sEMc.js";import{got_default as r}from"./got-CB83B8oA.js";import{timezone as i}from"./timezone-BrNu6iXe.js";import{config_not_found_default as a}from"./config-not-found-BVqhRP9D.js";import{getHeaders as o}from"./utils-CqD2rX4p.js";import{load as s}from"cheerio";const c={path:`/haowen/fenlei/:name/:sort?`,categories:[`shopping`],example:`/smzdm/haowen/fenlei/shenghuodianqi`,parameters:{name:`分类名，可在 URL 中查看`,sort:`排序方式，默认为最新`},features:{requireConfig:[{name:`SMZDM_COOKIE`,description:`什么值得买登录后的 Cookie 值`}],requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`post.smzdm.com/fenlei/:name`],target:`/haowen/fenlei/:name`}],name:`好文分类`,maintainers:[`LogicJake`],handler:l,description:`| 最新 | 周排行 | 月排行 |
| ---- | ------ | ------ |
| 0    | 7      | 30     |`};async function l(c){if(!e.smzdm.cookie)throw new a(`什么值得买排行榜 is disabled due to the lack of SMZDM_COOKIE`);let l=c.req.param(`name`),u=c.req.param(`sort`)||`0`,d=u===`0`?`https://post.smzdm.com/fenlei/${l}/`:`https://post.smzdm.com/fenlei/${l}/hot_${u}/`,f=await r.get(d,{headers:o()}),p=s(f.data),m=p(`div.crumbs.nav-crumbs`).text().split(`>`).pop(),h=p(`div.list.post-list`).toArray().map(e=>(e=p(e),{title:e.find(`h2.item-name a`).text(),link:e.find(`h2.item-name a`).attr(`href`),description:e.find(`.item-info`).html(),author:e.find(`.nickname`).text(),pubDate:i(t(e.find(`span.time`).text(),[`HH:mm`,`MM-DD HH:mm`,`YYYY-MM-DD HH:mm`]),8)})),g=await Promise.all(h.map(e=>n.tryGet(e.link,async()=>{try{let n=await r(e.link,{headers:o()}),a=s(n.data);e.description=a(`article`).html(),e.pubDate=i(t(a(`meta[property="og:release_date"]`).attr(`content`)),8),e.author=a(`meta[property="og:author"]`).attr(`content`)}catch{}return e})));return{title:`${m}- 什么值得买好文分类`,link:d,item:g}}export{c as route};