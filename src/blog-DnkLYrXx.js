import"./esm-shims-CGUM9TC6.js";import"./config-C9m9eBw5.js";import"./logger-CC3afzWM.js";import{parseDate as e}from"./parse-date-D4osZfpm.js";import"./dist-0j_z2rfc.js";import"./helpers-nWIDkd0K.js";import{cache_default as t}from"./cache-GwMhal7i.js";import"./render-DOz85fGU.js";import"./ofetch-ZUQ1sEMc.js";import{got_default as n}from"./got-CB83B8oA.js";import{invalid_parameter_default as r}from"./invalid-parameter-CUJdROXf.js";import{isValidHost as i}from"./valid-host-DEPw8oAS.js";import{parseBlogArticle as a}from"./utils-4KQjVCAF.js";import{load as o}from"cheerio";const s={path:`/blog/:column?`,categories:[`blog`],example:`/caixin/blog/zhangwuchang`,parameters:{column:`博客名称，可在博客主页的 URL 找到`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`用户博客`,maintainers:[],handler:c,description:`通过提取文章全文，以提供比官方源更佳的阅读体验.`};async function c(s){let c=s.req.param(`column`),{limit:l=20}=s.req.query();if(c){if(!i(c))throw new r(`Invalid column`);let l=`https://${c}.blog.caixin.com`,{data:u}=await n(l),d=o(u),f=d(`div.indexMainConri > script[type="text/javascript"]`).text().slice(15).split(`;`)[0].replaceAll(/\s/g,``),p=f.match(/id:"(\d+)"/)[1],m=f.match(/name:"(.*?)"/)[1],h=f.match(/avatar:"(.*?)"/)[1],g=f.match(/introduce:"(.*?)"/)[1],{data:{data:_}}=await n(`https://blog.caixin.com/blog-api/post/posts`,{searchParams:{page:1,size:s.req.query(`limit`)?Number.parseInt(s.req.query(`limit`)):20,content:``,authorId:p,sort:`publishTime`,direction:`DESC`}}),v=_.map(t=>({title:t.title,description:t.brief,author:t.displayName,link:t.guid.replace(`http://`,`https://`),pubDate:e(t.publishTime,`x`)})),y=await Promise.all(v.map(e=>t.tryGet(e.link,()=>a(e))));return{title:`财新博客 - ${m}`,link:l,description:g,image:h,item:y}}else{let{data:r}=await n(`https://blog.caixin.com/blog-api/post/index`,{searchParams:{page:1,size:l}}),i=r.data.map(t=>({title:t.title,description:t.brief,author:t.authorName,link:t.postUrl.replace(`http://`,`https://`),pubDate:e(t.publishTime,`x`)})),o=await Promise.all(i.map(e=>t.tryGet(e.link,()=>a(e))));return{title:`财新博客 - 全部`,link:`https://blog.caixin.com`,item:o}}}export{s as route};