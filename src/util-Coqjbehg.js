import{__dirname as e,init_esm_shims as t}from"./esm-shims-CGUM9TC6.js";import{parseRelativeDate as n}from"./parse-date-D4osZfpm.js";import{cache_default as r}from"./cache-GwMhal7i.js";import{art as i}from"./render-DOz85fGU.js";import{got_default as a}from"./got-CB83B8oA.js";import{timezone as o}from"./timezone-BrNu6iXe.js";import s from"node:path";import{load as c}from"cheerio";import"rfc4648";t();const l=`https://www.zaobao.com`,u=a.extend({headers:{Referer:l}}),d=async(t,a)=>{let d=await u.get(l+a),p=c(d.data),m=p(`.card-listing .card .content-header a`);m.length===0&&(m=p(`[data-testid="article-list"] article a.article-link`));let h=p(`meta[property="og:title"]`).attr(`content`),g=await Promise.all(m.toArray().map(t=>{let a=p(t),d=a.attr(`href`);if(d[0]!==`/`){let e=a.find(`a`).text(),t=a.find(`.meta-published-date`);t.length===0&&(t=a.find(`.datestamp`));let r,i;if(t.length!==0){r=t.text().trim();let e=r.split(`/`);e.reverse(),r=e.join(`-`),i=n(r),i=i===r?void 0:o(i,8)}return{title:e,description:e,pubDate:i,link:d}}return d=l+d,r.tryGet(d,async()=>{let t=await u.get(d),n=c(t.data),r,a;if(n(`#seo-article-page`).text()===``){r=n(`h1.article-title`).text();let e=n(`head script[type='application/ld+json']`).eq(0).text().replaceAll(/[\u0000-\u001F\u007F-\u009F]/g,``);a=new Date(JSON.parse(e)?.datePublished)}else{let e=n(`#seo-article-page`).text().replaceAll(/[\u0000-\u001F\u007F-\u009F]/g,``),t=JSON.parse(e);r=t[`@graph`][0]?.headline,a=new Date(t[`@graph`][0]?.datePublished)}n(`.overlay-microtransaction`).remove(),n(`#video-freemium-player`).remove(),n(`script`).remove(),n(`.bff-google-ad`).remove(),n(`.bff-recommend-article`).remove();let o=n(`.articleBody`);o.length===0&&(n(`.read-on-app-cover`).remove(),n(`astro-island`).remove(),n(`.further-reading`).remove(),o=n(`.article-body`));let l=o.html(),p=f(n);return{title:r,description:i(s.join(e,`templates/zaobao-1e13b3a5.art`),{articleBody:l,imageDataArray:p}),pubDate:a,link:d}})}));return{title:h,resultList:g}},f=e=>{let t=[],n=[`.inline-figure-img`,`.body-content .loadme picture img`,`.inline-figure-gallery`,`#carousel-article`];for(let r of n)if(e(r).length){let n=e(r===`#carousel-article`?`#carousel-article .carousel-inner`:r).html();n&&(n=n.replaceAll(/\/\/.*\.com\/s3fs-public/g,`//static.zaobao.com/s3fs-public`).replaceAll(`s3/files`,`s3fs-public`),t.push({type:r===`.body-content .loadme picture img`?`data`:`normalHTML`,html:n,...r===`.body-content .loadme picture img`&&{src:e(`.body-content .loadme picture source`).attr(`data-srcset`),title:e(r).attr(`title`)}}))}return t};export{d as parseList};