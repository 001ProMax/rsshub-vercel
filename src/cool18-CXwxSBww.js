import"./esm-shims-CGUM9TC6.js";import"./config-C9m9eBw5.js";import"./logger-CC3afzWM.js";import{parseDate as e}from"./parse-date-D4osZfpm.js";import"./dist-0j_z2rfc.js";import{cache_default as t}from"./cache-GwMhal7i.js";import{ofetch_default as n}from"./ofetch-ZUQ1sEMc.js";import{load as r}from"cheerio";const i={path:`/:id?/:type?/:keyword?`,url:`cool18.com`,example:`cool18.com/bbs4`,parameters:{id:`the name of the bbs`,type:"the type of the post. Can be `home`, `gold` or `threadsearch`. Default: `home`",keyword:`the keyword to search.`,pageSize:`the number of posts to fetch. If the type is not in search, you can type any words. Default: 10`},categories:[`bbs`],radar:[{source:[`cool18.com/:id/`],target:`/:id/:type?/:keyword?`}],name:`禁忌书屋`,maintainers:[`nczitzk`,`Gabrlie`],handler:a,features:{nsfw:!0}};async function a(i){let{id:a=`bbs4`,type:o=`home`,keyword:s}=i.req.param(),c=`https://www.cool18.com/`+a+`/index.php`,l=o===`home`?``:o===`gold`?`?app=forum&act=gold`:`?action=search&act=threadsearch&app=forum&keywords=${s}&submit=查询`,u=c+l,d=await n(u),f=r(d),p=i.req.query(`limit`)?Number.parseInt(i.req.query(`limit`)):20,m=o===`home`?JSON.parse(f(`script:contains("_PageData")`).text().match(/const\s+_PageData\s*=\s*(\[[\s\S]*?]);/)?.[1]||`[]`).slice(0,p).map(t=>({title:t.subject,link:`${c}?app=forum&act=threadview&tid=${t.tid}`,pubDate:e(t.dateline,`MM/DD/YY`),author:t.username,category:t.type,description:``})):f(`#d_list ul li, #thread_list li, .t_l .t_subject`).slice(0,p).toArray().map(t=>{let n=f(t).find(`a`).first();return{title:n.text(),link:`${c}/${n.attr(`href`)}`,pubDate:e(f(t).find(`i`).text(),`MM/DD/YY`),author:f(t).find(`a`).last().text(),category:n.find(`span`).first().text(),description:``}}),h=await Promise.all(m.map(e=>t.tryGet(e.link,async()=>{let t=await n(e.link),i=r(t),a=i(`pre`);if(a.length>0){let t=a.html();e.description=t?t.replaceAll(/<font color="#E6E6DD">cool18.com<\/font>/g,``):``}return e})));return{title:f(`title`).text(),link:u,item:h}}export{i as route};