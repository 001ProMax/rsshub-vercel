import{__dirname as e,init_esm_shims as t}from"./esm-shims-CtP6w_ML.js";import{config as n}from"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import{ofetch_default as r}from"./ofetch-CWQqZcqz.js";import{cache_default as i}from"./cache-CvppK6AM.js";import{art as a}from"./render-DE4LRFBD.js";import{md5 as o}from"./md5-BJqXla8f.js";import{invalid_parameter_default as s}from"./invalid-parameter-CvwVNf6G.js";import c from"node:path";import l from"dayjs";import u from"dayjs/plugin/utc.js";import d from"dayjs/plugin/timezone.js";t(),l.extend(u),l.extend(d);const f=`trending-all-in-one`,p=`https://raw.githubusercontent.com/huqi-pr/trending-in-one/master/raw`,m=`YYYY-MM-DD`,h={"toutiao-search":{baseUrl:`https://so.toutiao.com/search?keyword=`,name:`今日头条热搜`},"weibo-search":{baseUrl:`https://s.weibo.com/weibo?q=`,name:`微博热搜`},"zhihu-search":{baseUrl:`https://www.zhihu.com/search?q=`,name:`知乎热搜`},"zhihu-questions":{baseUrl:`https://www.zhihu.com/search?type=question&q=`,name:`知乎热门话题`},"zhihu-video":{baseUrl:`https://www.zhihu.com/search?type=video&q=`,name:`知乎热门视频`}},g={"toutiao-search":({word:e})=>({url:h[`toutiao-search`].baseUrl+encodeURIComponent(e),title:e}),"weibo-search":({title:e})=>({url:h[`weibo-search`].baseUrl+encodeURIComponent(e),title:e}),"zhihu-questions":e=>e,"zhihu-search":({query:e})=>{let t=e.trim();return{url:h[`zhihu-search`].baseUrl+encodeURIComponent(t),title:t}},"zhihu-video":e=>e},_=(e,t)=>t.some(t=>e.includes(t)),v=e=>l.tz(e,`Asia/Shanghai`),y=e=>t=>t.map(t=>g[e](t)),b=e=>t=>t.filter(({title:t})=>_(t,e)),x=async(e=[],t=[],i)=>{let a=e=>i.tryGet(e,()=>r(e),n.cache.contentExpire,!1),o=await Promise.all(t.map(async t=>({dateTime:t,data:await Promise.all(Object.keys(h).map(async n=>({name:h[n].name,data:await a(`${p}/${n}/${t.format(m)}.json`).then(y(n)).then(b(e))})))})));for(let e of o)e.count=e.data.reduce((e,{data:t})=>e+t.length,0);if(o=o.filter(({count:e})=>e>0),o.length===0)return o;let s=i.get(f+`:latest-items`),c=o[0];if(c.newItemCount=0,c.count>0&&s){for(let e in c.data)for(let t of c.data[e].data)t.new=!(t.url in s),c.newItemCount+=t.new?1:0;let e=c.data.reduce((e,{data:t})=>{for(let n of t)e[n.url]=!0;return e},{});i.set(f+`:latest-items`,e,n.cache.contentExpire),c.count=Object.keys(e).length}return o},S=e=>[`https://tophub.today/search?e=tophub&q=${e}`,`https://www.baidu.com/s?wd=${e}`,`https://www.google.com/search?q=${e}`,`https://www.zhihu.com/search?type=content&q=${e}`,`https://s.weibo.com/weibo/${e}`,`https://www.douyin.com/search/${e}`,`https://so.toutiao.com/search?keyword=${e}`],C=[`热榜`,`百度`,`谷歌`,`知乎`,`微博`,`抖音`,`头条`],w=({dateTime:t,data:n,count:r,newItemCount:i},s,l)=>{let u=t.endOf(`day`),d=l?new Date:u.toDate(),f=l&&i?i+`🆕`:r;return{title:`${s.join(`, `)} | ${t.format(m)} 热点追踪 (${f})`,author:`Trending All In One`,pubDate:d,description:a(c.join(e,`templates/content-6a767bc2.art`),{data:n,queries:s.map(e=>({links:S(encodeURIComponent(e)).map((e,t)=>`<a href="${e}" rel="noopener noreferrer" target="_blank">${C[t]}</a>`),key:e}))}),guid:`trending-all-in-one-${u.toISOString()}-${o(JSON.stringify(n))}-${s.join(`-`)}`}},T={path:`/:keywords/:numberOfDays?`,categories:[`other`],example:`/trending/唐山,打人/3`,parameters:{keywords:`通过逗号区隔的关键词列表`,numberOfDays:`向前追溯的天数，默认为3天`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`关键词聚合追踪`,maintainers:[`Jkker`],handler:E,description:`追踪各大热搜榜上包含特定关键词的条目。

当前收录榜单：*微博热搜*、*今日头条热搜*、*知乎热搜*、*知乎热门视频*、*知乎热门话题*。

数据源: [trending-in-one](https://github.com/huqi-pr/trending-in-one)`};async function E(e){if(e.req.param(`numberOfDays`)>14)throw new s(`days must be less than 14`);let t=e.req.param(`numberOfDays`)||3,n=l(v(new Date)),r=n.format(m),a=[];for(let e=0;e<t;e++){let t=n.subtract(e,`day`);a.push(t)}let c=e.req.param(`keywords`).replace(`，`,`,`).split(`,`).map(e=>e.trim()),u=c.join(`, `),d=await x(c,a,i).catch(()=>[]),f=d.length>0?d.map((e,t)=>w(e,c,t===0)):[{title:`${u} | ${r} 热点追踪 (0)`,author:`Trending All In One`,description:`近${t}日的热搜都不包含下列关键词：${u}<br>请耐心等待，或添加更多关键词试试。`,guid:`trending-all-in-one-${o(JSON.stringify(d))}-${c.join(`-`)}`}];return{title:`${u} | 热点聚合`,description:`${u} | 今日头条热搜，知乎热门视频，知乎热搜榜，知乎热门话题，微博热搜榜聚合追踪`,language:`zh-cn`,item:f}}export{T as route};