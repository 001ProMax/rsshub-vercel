import{__dirname as e,init_esm_shims as t}from"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CWQqZcqz.js";import"./helpers-RrXnNmv1.js";import{art as n}from"./render-DE4LRFBD.js";import{got_default as r}from"./got-BwctkUCD.js";import{fallback as i,queryToInteger as a}from"./readable-social-CZfNaCIB.js";import o from"node:path";t();const s={path:`/recommended/:type?/:routeParams?`,categories:[`social-media`],example:`/douban/recommended/tv`,parameters:{type:`片单类型剧集/电影，tv或movie，默认为tv`,routeParams:`额外参数；请参阅以下说明和表格`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`豆瓣每月推荐片单`,maintainers:[`honue`],handler:c,description:`| 额外参数 | 含义                   | 接受的值 | 默认值 |
| -------- | ---------------------- | -------- | ------ |
| playable | 仅看有可播放片源的影片 | 0/1      | 0      |
| score    | 筛选评分               | 0-10     | 0      |

  用例：\`/douban/recommended/tv/playable=0&score=8\`

::: tip
  整合了 /douban/list/ 路由，省去每月手动更新 id 参数，因为当月推荐剧集片单中，会有还未播出 / 开评分剧集、海外平台播出剧集，请自行考虑是否使用额外参数。
:::`};async function c(t){let s=t.req.param(`type`)||`tv`,c=`0ac44ae016490db2204ce0a042db2916`,l=`https://frodo.douban.com/api/v2/skynet/new_playlists?apikey=${c}&subject_type=${s}`,u=await r({method:`get`,url:l,headers:{"User-Agent":`MicroMessenger/`,Referer:`https://servicewechat.com/wx2f9b06c1de1ccfca/91/page-frame.html`}}),d=new Date,f=d.getFullYear(),p=d.getMonth()+1,m=p<10?`0`+p:p.toString(),h=u.data.data[0].items,g=h.find(e=>e.title.startsWith(`${f}年${m}月`)).id,_=Object.fromEntries(new URLSearchParams(t.req.param(`routeParams`))),v=i(void 0,a(_.playable),0),y=i(void 0,a(_.score),0);l=`https://m.douban.com/rexxar/api/v2/subject_collection/${g}/items?playable=${v}`,u=await r({method:`get`,url:l,headers:{Referer:`https://m.douban.com/subject_collection/${g}`}});let b=u.data.subject_collection.description;return h=u.data.subject_collection_items.filter(e=>{let t=e.rating?e.rating.value:0;return t>=y}).map(t=>{let r=t.title,i=t.url,a=n(o.join(e,`templates/list_description-833a570f.art`),{ranking_value:t.ranking_value,title:r,original_title:t.original_title,rate:t.rating?t.rating.value:null,card_subtitle:t.card_subtitle,description:t.cards?t.cards[0].content:t.abstract,cover:t.cover_url||t.cover?.url});return{title:r,link:i,description:a}}),{title:`豆瓣 - ${u.data.subject_collection.name}`,link:`https://m.douban.com/subject_collection/${g}`,item:h,description:b}}export{s as route};