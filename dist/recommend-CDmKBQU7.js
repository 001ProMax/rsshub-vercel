import"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import{logger_default as e}from"./logger-BlLSmUdl.js";import{ofetch_default as t}from"./ofetch-CWQqZcqz.js";import"./helpers-RrXnNmv1.js";import{cache_default as n}from"./cache-CvppK6AM.js";import{parseDate as r}from"./parse-date-DHsdom8D.js";import{md5 as i}from"./md5-BJqXla8f.js";import{got_default as a}from"./got-BwctkUCD.js";import{load as o}from"cheerio";const s=()=>n.tryGet(`51cto:token`,async()=>{let e=await t(`https://api-media.51cto.com/api/token-get`);return e.data.data.token},3600,!1),c=(e,t={},n,r)=>{t.timestamp=n,t.token=r;let a=Object.keys(t).sort();return i(i(e)+i(a+i(r)+n))},l={path:`/index/recommend`,categories:[`programming`],example:`/51cto/index/recommend`,radar:[{source:[`51cto.com/`]}],name:`推荐`,maintainers:[`cnkmmk`,`ovo-tim`],handler:f,url:`51cto.com/`},u=/'(WTKkN|bOYDu|wyeCN)':\s*(\d+)/g;async function d(n,i=``){let a=null,s=await t(n.url,{headers:{cookie:i}}),c=o(s);if(a=new URL(n.url).host===`ost.51cto.com`?c(`.posts-content`).html():c(`article`).html(),!a&&i===``)try{let e=s.match(u).slice(0,3),t=e.map(e=>Number(e.split(`:`)[1])),[r,i,a]=t,o=`__tst_status=`+(r+i+a)+`#;`;return await d(n,o)}catch(t){e.error(t)}return{title:n.title,link:n.url,pubDate:r(n.pubdate,8),description:a||n.abstract}}async function f(e){let t=`https://api-media.51cto.com`,r=`index/index/recommend`,i=await s(),o=Date.now(),l={page:1,page_size:e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`),10):50,limit_time:0,name_en:``},u=await a(`${t}/${r}`,{searchParams:{...l,timestamp:o,token:i,sign:c(r,l,o,i)}}),f=u.data.data.data.list,p=await Promise.all(f.map(e=>n.tryGet(e.url,async()=>await d(e))));return{title:`51CTO`,link:`https://www.51cto.com/`,description:`51cto - 推荐`,item:p}}export{l as route};