import"./esm-shims-CtP6w_ML.js";import{config as e}from"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import{ofetch_default as t}from"./ofetch-CWQqZcqz.js";import{cache_default as n}from"./cache-CvppK6AM.js";import"./render-DE4LRFBD.js";import{parseDate as r}from"./parse-date-DHsdom8D.js";import{not_found_default as i}from"./not-found-o393tAVF.js";import{ViewType as a}from"./types-Bi82qguM.js";import{config_not_found_default as o}from"./config-not-found-QwO11ree.js";import{getVideoUrl$1 as s,utils_default$30 as c}from"./utils-WUWAI-ZE.js";import*as l from"cheerio";const u={path:`/user/:username/:routeParams?`,categories:[`social-media`,`popular`],view:a.Videos,example:`/youtube/user/@JFlaMusic`,parameters:{username:`YouTuber handle with @`,routeParams:`Extra parameters, see the table below`},description:`:::tip Parameter
| Name       | Description                                                                         | Default |
| ---------- | ----------------------------------------------------------------------------------- | ------- |
| embed      | Whether to embed the video, fill in any value to disable embedding                  | embed   |
| filterShorts | Whether to filter out shorts from the feed, fill in any falsy value to show shorts | true    |
:::`,features:{requireConfig:[{name:`YOUTUBE_KEY`,description:" YouTube API Key, support multiple keys, split them with `,`, [API Key application](https://console.developers.google.com/)"}],requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`www.youtube.com/user/:username`,`www.youtube.com/:username`],target:`/user/:username`}],name:`Channel with user handle`,maintainers:[`DIYgod`,`pseudoyu`],handler:d};async function d(a){if(!e.youtube||!e.youtube.key)throw new o(`YouTube RSS is disabled due to the lack of <a href="https://docs.rsshub.app/deploy/config#route-specific-configurations">relevant config</a>`);let u=a.req.param(`username`),d=a.req.param(`routeParams`),f=new URLSearchParams(d),p=!f.get(`embed`),m=f.get(`filterShorts`),h=m===null||m===``||m===`true`,g;u.startsWith(`@`)&&(g=await n.tryGet(`youtube:handle:${u}`,async()=>{let e=`https://www.youtube.com/${u}`,r=await t(e),i=l.load(r),a=JSON.parse(i(`script`).text().match(/ytInitialData = ({.*?});/)?.[1]||`{}`),o=a.metadata.channelMetadataRenderer,s=o.externalId,d=o.title,f=o.avatar?.thumbnails?.[0]?.url,p=o.description,m=(await c.getChannelWithId(s,`contentDetails`,n)).data.items[0].contentDetails.relatedPlaylists.uploads;return{channelName:d,image:f,description:p,playlistId:m}}));let _=await(async()=>{if(g?.playlistId){let e=g.playlistId;return c.getPlaylistWithShortsFilter(e,h)}else{let e=await c.getChannelWithUsername(u,`contentDetails`,n),t=e.data.items;if(!t)throw new i(`The channel https://www.youtube.com/user/${u} does not exist.`);let r=t[0].id;return h?c.getPlaylistWithShortsFilter(r,h):t[0].contentDetails.relatedPlaylists.uploads}})(),v=await c.getPlaylistItems(_,`snippet`,n);if(!v)throw new i(`This channel doesn't have any content.`);return{title:`${g?.channelName||u} - YouTube`,link:u.startsWith(`@`)?`https://www.youtube.com/${u}`:`https://www.youtube.com/user/${u}`,description:g?.description||`YouTube user ${u}`,image:g?.image,item:v.data.items.filter(e=>e.snippet.title!==`Private video`&&e.snippet.title!==`Deleted video`).map(e=>{let t=e.snippet,n=t.resourceId.videoId,i=c.getThumbnail(t.thumbnails);return{title:t.title,description:c.renderDescription(p,n,i,c.formatDescription(t.description)),pubDate:r(t.publishedAt),link:`https://www.youtube.com/watch?v=${n}`,author:t.videoOwnerChannelTitle,image:i.url,attachments:[{url:s(n),mime_type:`text/html`}]}})}}export{u as route};