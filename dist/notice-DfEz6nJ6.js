import"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CWQqZcqz.js";import"./helpers-RrXnNmv1.js";import{cache_default as e}from"./cache-CvppK6AM.js";import{got_default as t}from"./got-BwctkUCD.js";import*as n from"node:url";import r from"querystring";const i=`http://jw.scut.edu.cn`,a=i+`/dist/`,o=i+`/zhinan/cms/toPosts.do`,s=i+`/zhinan/jw/api/v2/findInformNotice.do`,c=i+`/zhinan/jw/api/v2/getArticleInfo.do`,l=e=>`${i}/zhinan/cms/article/view.do?type=posts&id=${e}`,u=e=>`${i}/dist/#/detail/index?id=${e}&type=notice`,d={all:{title:`全部`,tag:`0`},course:{title:`选课`,tag:`1`},exam:{title:`考试`,tag:`2`},practice:{title:`实践`,tag:`3`},communication:{title:`交流`,tag:`4`},teacher:{title:`教师`,tag:`5`},info:{title:`信息`,tag:`6`}},f=e=>{let t=8,n=e.getTimezoneOffset()/60;return new Date(e.getTime()-60*60*1e3*(t+n))},p=e=>{let t=new Date(e);return t.setHours(8),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),f(t)},m=e=>!!e.link,h=e=>e.replaceAll(`src="/`,`src="${n.resolve(i,`.`)}`).replaceAll(`href="/`,`href="${n.resolve(i,`.`)}`),g=e=>{if(!e.success)throw Error(`article api error`)},_=e=>`<p>链接：<a href="${l(e)}">电脑版</a>&nbsp;|&nbsp;<a href="${u(e)}">手机版</a></p>`,v=e=>h(e.content)+_(e.id),y={path:`/jwc/notice/:category?`,categories:[`university`],example:`/scut/jwc/notice/all`,parameters:{category:"通知分类，默认为 `all`"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`教务处通知公告`,maintainers:[`imkero`],handler:b,description:`| 全部 | 选课   | 考试 | 实践     | 交流          | 教师    | 信息 |
| ---- | ------ | ---- | -------- | ------------- | ------- | ---- |
| all  | course | exam | practice | communication | teacher | info |`};async function b(n){let i=n.req.param(`category`)||`all`,u=d[i],f=r.stringify({pageNo:1,pageSize:20,tag:u.tag}),h=await t({method:`post`,url:`${s}?${f}`,headers:{Referer:a}});g(h.data);let _=h.data.data.list,y=await Promise.all(_.map(async n=>{let i=l(n.id),o=await e.get(i);if(o)return JSON.parse(o);let s=r.stringify({id:n.id,categoryType:``}),u=await t({method:`post`,url:`${c}?${s}`,headers:{Referer:a}});g(u.data);let d=u.data.data;d.id=n.id;let f=null;m(d)||(f=v(d));let h={title:d.name,link:i,description:f,pubDate:p(d.createDate).toUTCString()};return e.set(i,JSON.stringify(h)),h}));return{title:`华南理工大学教务处通知公告 - `+u.title,link:o,item:y}}export{y as route};