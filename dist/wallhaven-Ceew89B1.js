import"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CWQqZcqz.js";import"./helpers-RrXnNmv1.js";import{cache_default as e}from"./cache-CvppK6AM.js";import{parseDate as t}from"./parse-date-DHsdom8D.js";import{got_default as n}from"./got-BwctkUCD.js";import{load as r}from"cheerio";const i=`https://wallhaven.cc`,a={path:[`/search/:filter?/:needDetails?`,`/:filter?/:needDetails?`],categories:[`picture`],example:`/wallhaven/search/categories=110&purity=110&sorting=date_added&order=desc`,parameters:{filter:`Filter, empty by default`,needDetails:"Need Details, `true`/`yes` as yes, no by default"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`wallhaven.cc/`]}],name:`Search`,maintainers:[`nczitzk`,`Fatpandac`],handler:o,url:`wallhaven.cc/`,description:"::: tip\n  Subscribe pages starting with `https://wallhaven.cc/search`, fill the text after `?` as `filter` in the route. The following is an example:\n\n  The text after `?` is `q=id%3A711&sorting=random&ref=fp&seed=8g0dgd` for [Wallpaper Search: #landscape - wallhaven.cc](https://wallhaven.cc/search?q=id%3A711&sorting=random&ref=fp&seed=8g0dgd), so the route is [/wallhaven/q=id%3A711&sorting=random&ref=fp&seed=8g0dgd](https://rsshub.app/wallhaven/q=id%3A711&sorting=random&ref=fp&seed=8g0dgd)\n:::"};async function o(a){let o=a.req.param(`filter`)??`latest`,s=/t|y/i.test(a.req.param(`needDetails`)??`false`),c=`${i}/${o.indexOf(`=`)>0?`search?${o.replaceAll(/page=\d+/g,`page=1`)}`:o}`,l=await n.get(c),u=r(l.data),d=u(`li > figure.thumb`).slice(0,a.req.query(`limit`)?Number.parseInt(a.req.query(`limit`)):24).map((e,t)=>({title:u(t).find(`img.lazyload`).attr(`data-src`).split(`/`).pop(),description:u(t).html().match(/<img.*?>/)[0],link:u(t).find(`a.preview`).attr(`href`)})).get();return s&&(d=await Promise.all(d.map(i=>e.tryGet(i.link,async()=>{let e=await n({method:`get`,url:i.link}),a=r(e.data);return i.title=a(`meta[name="title"]`).attr(`content`),i.author=a(`.username`).text(),i.pubDate=t(a(`time`).attr(`datetime`)),i.category=a(`.tagname`).toArray().map(e=>a(e).text()),i.description=a(`div.scrollbox`).html(),i})))),{title:u(`title`).text(),link:c,item:d}}export{a as route};