import{config as e}from"./config-DYqAlsU3.js";import{logger_default as t}from"./logger-BlLSmUdl.js";import{ofetch_default as n}from"./ofetch-CWQqZcqz.js";import{cache_default as r}from"./cache-CvppK6AM.js";import{parseDate as i}from"./parse-date-DHsdom8D.js";import{timezone as a}from"./timezone-CCdTtC9I.js";import*as o from"cheerio";import s from"crypto-js";const c=[`globalThis`,`headless`,`languages`,`permHook`,`vendor`,`webDriverValue`,`webdriver`],l=`https://www.myzaker.com`,u=(e,t=20)=>{for(let n=0;n<1e8;n++){let r=s.SHA256(e+n).toString(),i=0;for(let e of r){if(e!==`0`){i+=4-Number.parseInt(e,16).toString(2).length;break}i+=4}if(i>=t)return n}return 0},d=e=>{let t=`0`.repeat(16);return s.enc.Utf8.parse((e+t).slice(0,16))},f=(e,t)=>{let n=s.enc.Utf8.parse(`1234567890123456`);return s.AES.encrypt(JSON.stringify(e),d(t),{iv:n,padding:s.pad.Pkcs7})},p=(e,t)=>f(e,t).ciphertext.toString(),m=async i=>{let a=`zaker:cookie`,o=3600,s=await r.get(a,!1);if(s)return JSON.parse(s);let d=`https://challenge.rivers.chaitin.cn/captcha/api`,f=await n.raw(i),m=f.headers.getSetCookie().find(e=>e.startsWith(`sl-session`))?.split(`;`)[0].split(`sl-session=`)[1],h=f._data.match(/once_id:\s*"(.*?)",/)?.[1];if(t.debug(`getSafeLineCookie: sl-session=${m}, onceId=${h}`),!/window\.captcha/.test(f._data))return t.debug(`getSafeLineCookie: Failed to get once_id`),{cookie:f.headers.getSetCookie().map(e=>e.split(`;`)[0]).join(`; `),data:f._data};let g=await n(`${d}/seed`,{headers:{Referer:`${l}/`},query:{once_id:h,v:`1.0.0`,hints:c.sort(()=>Math.random()-.5).join(`,`)}}),_=e.ua,v=g.seed,y=Math.trunc(Math.random()*2e3+1e3);t.debug(`getSafeLineCookie: ua=${_}, seed=${v}, takeTime=${y}`);let b=p({resolution:`1920x1080`,languages:[`en-US`],useragents:[_,_,_],hint:0,salt:String(u(v,16)),taketime:y},v),x=await n(`${d}/inspect`,{method:`POST`,headers:{Referer:`${l}/`,"Content-Type":`text/plain`},query:{seed:v},body:b});if(t.debug(`getSafeLineCookie: inspectResponse=${JSON.stringify(x)}`),x.reason)return t.error(`getSafeLineCookie: reason=${x.reason}`),{cookie:f.headers.getSetCookie().map(e=>e.split(`;`)[0]).join(`; `),data:f._data};let S=await n.raw(i,{headers:{Cookie:`sl-session=${m}; sl_waf_recap=${x.jwt}`}}),C=S.headers.getSetCookie().map(e=>e.split(`;`)[0]).join(`; `);return t.debug(`getSafeLineCookie: ${C}`),r.set(a,JSON.stringify(C),o),{cookie:C,data:S._data}},h=e=>{let t=JSON.parse(e(`script:contains("window.WinPageData")`).text().match(/window\.WinPageData\s*=\s*({.*})/)?.[1]??`{}`);return t.data.article.map(e=>({title:e.title,description:e.desc,link:`https:`+e.url,author:e.author_name,pubDate:a(i(e.date,`MM月DD日`),8),category:e.tag.map(e=>e.tag),image:e.thumbnail_mpic}))},g=async(e,t)=>{let r=await n(e.link,{headers:{Cookie:t}}),i=o.load(r),a=i(`div.article_content div`);return a.find(`img`).each((e,t)=>{let n=i(t);n.attr(`src`,n.attr(`data-original`)),n.removeAttr(`data-original`)}),e.description=a.html(),e};export{l as baseUrl$34,g as fetchItem,m as getSafeLineCookieWithData,h as parseList$10};