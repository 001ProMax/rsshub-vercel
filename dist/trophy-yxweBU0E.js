import"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CWQqZcqz.js";import"./helpers-RrXnNmv1.js";import{got_default as e}from"./got-BwctkUCD.js";import{load as t}from"cheerio";const n={path:`/trophy/:id`,categories:[`game`],example:`/ps/trophy/DIYgod_`,parameters:{id:`User ID`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`PlayStation Network user trophy`,maintainers:[`DIYgod`],handler:r};async function r(n){let r=n.req.param(`id`),i=await e({method:`get`,url:`https://psnprofiles.com/${r}?order=last-trophy`}),a=t(i.data),o=a(`.zebra tr`).filter(function(){return a(this).find(`.progress-bar span`).text()!==`0%`}).map((e,t)=>a(t).find(`.title`).attr(`href`)).get().slice(0,3),s=await Promise.all(o.map(async n=>{let r=`https://psnprofiles.com`+n+`?order=date&trophies=earned&lang=zh-cn`,i=await e({method:`get`,url:r}),a=t(i.data),o=a(`.zebra tr.completed`),s=o.map((e,t)=>{t=a(t);let n={Platinum:`白金`,Gold:`金`,Silver:`银`,Bronze:`铜`};return{title:t.find(`.title`).text()+` - `+a(`.page h3`).eq(0).text().trim().replace(` Trophies`,``),description:`<img src="${t.find(`.trophy source`).attr(`srcset`).split(` `)[1]}"><br>${t.find(`.title`).parent().contents().filter(function(){return this.nodeType===3}).text().trim()}<br>等级：${n[t.find(`td`).eq(5).find(`img`).attr(`title`)]}<br>珍贵度：${t.find(`.hover-show .typo-top`).text()}`,link:`https://psnprofiles.com`+t.find(`.title`).attr(`href`),pubDate:new Date(+new Date(t.find(`.typo-top-date nobr`).contents().filter(function(){return this.nodeType===3}).text()+` `+t.find(`.typo-bottom-date`).text())+8*60*60*1e3).toUTCString()}}).get();return s})),c=[];for(let e of s)c=[...c,...e];return c=c.sort((e,t)=>new Date(t.pubDate)-new Date(e.pubDate)),{title:`${r} 的 PSN 奖杯`,link:`https://psnprofiles.com/${r}/log`,item:c}}export{n as route};