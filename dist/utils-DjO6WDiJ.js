import{config as e}from"./config-DYqAlsU3.js";import{cache_default as t}from"./cache-CvppK6AM.js";import{parseDate as n}from"./parse-date-DHsdom8D.js";import{got_default as r}from"./got-BwctkUCD.js";import{load as i}from"cheerio";const a=`https://api.ruguoapp.com/1.0/mediaMeta/play?type=ORIGINAL_POST`,o=(e,t)=>e.posts.map(e=>{let r,i,a,o,s;switch(e.type){case`ORIGINAL_POST`:o=e.content,s=`https://m.okjike.com/originalPosts/${e.id}`;break;default:o=`未知类型，请前往GitHub提交issue`,s=`https://github.com/DIYgod/RSSHub/issues`}let c=``,l=``;if(e.user&&(l=e.user.screenName,t.req.param(`showUid`)&&(c+=`<span>用户昵称：${l} <br> Username：${e.user.username}</span><br>`)),e.linkInfo){let t=e.linkInfo.originalLinkUrl||e.linkInfo.linkUrl;new URL(t).host===`mp.weixin.qq.com`&&(s=t);let n=e.linkInfo.audio||e.audio;if(n){let e=n.image.picUrl||n.image.thumbnailUrl,i=t,a=n.title,o=n.author;r=`${a} - ${o}`,c+=`
            <img src="${e}">
            <a href="${i}">${r}</a>
        `}let o=e.linkInfo.video||e.video;if(o){let n=o.image.picUrl||o.image.thumbnailUrl,r=t,a=Math.floor(o.duration/6e4);i=e.linkInfo.title,c+=`
            <img src="${n}">
            <a href="${r}">${i||`观看视频`} - 约${a}分钟</a>
        `}if(!n&&!o&&t){a=e.linkInfo.title;let n=a||`访问原文`,r=e.linkInfo.pictureUrl,i=`<img src="${r}">`;c+=`
            ${r?i:``}
            <a href="${t}">${n}</a>
        `}}if(c+=c?`<br>${o}`:o,e.pictures)for(let t of e.pictures)if(t.format===`gif`)c+=`<img src="${t.picUrl.split(`?imageMogr2/`)[0]}">`;else{let e=/\.[\da-z]+?\?imageMogr2/.test(t.picUrl)?t.picUrl.split(`?imageMogr2/`)[0]:t.picUrl.replace(/thumbnail\/.+/,``);c+=`<br><img src="${e}">`}e.video&&(c+=`<br><video src="${e.video.url}" controls></video>`);let u=r||i||o||a||`无题`;return{title:u,description:c.trim().replaceAll(`
`,`<br>`),pubDate:n(e.createdAt),author:l,link:s}}),s=async(n,o)=>{let s=await t.tryGet(o,async()=>{let e=await r(o),t=e.data,n=i(t),s=n(`[type = "application/json"]`).html(),c=JSON.parse(s).props.pageProps;return c.posts=await Promise.all(c.posts.map(async e=>{if(!e.video)return e;let t=`${a}&id=${e.id}`,n=await r(t);return e.video=n.data,e})),c},!1,e.cache.routeExpire);if(s.length===0)return{title:`主题 ID 不存在，或该主题暂无内容`};let c=s.topic;return s.result={title:`${c.content} - 即刻圈子`,link:o,description:c.briefIntro,image:c.squarePicture.picUrl||c.squarePicture.middlePicUrl||c.squarePicture.thumbnailUrl},s};export{s as constructTopicEntry,o as topicDataHanding};