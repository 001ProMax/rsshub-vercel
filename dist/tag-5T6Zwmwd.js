import"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CWQqZcqz.js";import"./helpers-RrXnNmv1.js";import{cache_default as e}from"./cache-CvppK6AM.js";import"./render-DE4LRFBD.js";import"./parse-date-DHsdom8D.js";import{got_default as t}from"./got-BwctkUCD.js";import{apiUrl as n,baseUrl$2 as r,getBParam as i,getBuildId$1 as a,getGToken as o,parseItem$1 as s,parseList as c}from"./utils-B27nAN2Q.js";const l={path:`/tag/:tagId/:lang?`,categories:[`finance`],example:`/followin/tag/177008`,parameters:{tagId:`Tag ID, can be found in URL`,lang:"Language, see table above, `en` by default"},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`followin.io/:lang/tag/:tagId`,`followin.io/tag/:tagId`]}],name:`Tag`,maintainers:[`TonyRL`],handler:u};async function u(l){let{tagId:u,lang:d=`en`}=l.req.param(),{limit:f=20}=l.req.query(),p=await a(e.tryGet),m=await e.tryGet(`followin:tag:${u}:${d}`,async()=>{let{data:e}=await t(`${r}/_next/data/${p}/${d}/tag/${u}.json`),{queries:n}=e.pageProps.dehydratedState,{base_info:i}=n.find(e=>e.queryKey[0]===`/tag/info/v2`).state.data;return i}),h=await o(e.tryGet),g=i(d),{data:_}=await t.post(`${n}/feed/list/tag`,{headers:{"x-bparam":JSON.stringify(g),"x-gtoken":h},json:{count:f,id:Number.parseInt(u),type:`tag_discussion_feed`}});if(_.code!==2e3)throw Error(_.msg);let v=c(_.data.list.slice(0,f),d,p),y=await Promise.all(v.map(t=>s(t,e.tryGet)));return{title:`${m.name} - Followin`,description:m.description,link:`${r}/${d}/tag/${u}`,image:m.logo,language:d,item:y}}export{l as route};