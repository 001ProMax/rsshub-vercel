import"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CWQqZcqz.js";import"./helpers-RrXnNmv1.js";import{parseDate as e}from"./parse-date-DHsdom8D.js";import{got_default as t}from"./got-BwctkUCD.js";import{load as n}from"cheerio";import{JSDOM as r}from"jsdom";const i={path:`/tag/:name?/:type?`,categories:[`social-media`,`popular`],example:`/lofter/tag/cosplay/date`,parameters:{name:"tag name, such as `名侦探柯南`, `摄影` by default",type:`ranking type, see below, new by default`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},name:`Tag`,maintainers:[`hoilc`,`nczitzk`,`LucunJi`],handler:a,description:`| new  | date | week | month | total |
| ---- | ---- | ---- | ----- | ----- |
| 最新 | 日榜 | 周榜 | 月榜  | 总榜  |`};async function a(i){let a=i.req.param(`name`)??`摄影`,o=i.req.param(`type`)??`new`,s=20,c=0,l=`https://www.lofter.com`,u=`${l}/tag/${a}/${o}`,d=`${l}/dwr/call/plaincall/TagBean.getCommonTagExcellentAuthors.dwr`,f=await t({method:`post`,url:d,body:new URLSearchParams({callCount:1,scriptSessionId:"${scriptSessionId}187",httpSessionId:``,"c0-scriptName":`TagBean`,"c0-methodName":`search`,"c0-id":`0`,"c0-param0":`string:${encodeURI(a)}`,"c0-param1":`number:0`,"c0-param2":`string:`,"c0-param3":`string:${o}`,"c0-param4":`boolean:false`,"c0-param5":`number:0`,"c0-param6":`number:${s}`,"c0-param7":`number:${c}`,"c0-param8":`number:0`,batchId:493053})}),p=new r(`<script>if (dwr == null) var dwr = {};
        if (dwr.engine == null) dwr.engine = {};
        dwr.engine._remoteHandleCallback = function () {
            this.data = arguments;
        };
        ${f.data}</script>`,{runScripts:`dangerously`}),m=p.window.dwr.engine.data[2],h={new:`最新`,date:`日榜`,week:`周榜`,month:`月榜`,total:`最热`}[o]??``,g=m.map(t=>{let r=t.post,i=``;if(r.embed){let e=JSON.parse(r.embed);(e.h256Url||e.video_down_url)&&(i=`<video src="${e.h256Url??e.video_down_url}" poster="${e.video_img_url??``}" controls="controls"></video>`)}let a=r.photoLinks?JSON.parse(r.photoLinks).reduce((e,t)=>e+`<img src="${t.orign}"/>`,``):``,o=n(r.digest),s=o.text();return{author:r.blogInfo.blogNickName,link:r.blogPageUrl,title:r.title||`${r.blogInfo.blogNickName}${s?`：${s}`:``}`,pubDate:e(r.publishTime),description:i+a+o.html(),category:r.tagList}});return{title:`${a} - ${h} | LOFTER`,link:u,item:g}}export{i as route};