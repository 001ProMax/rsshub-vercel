import"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import{ofetch_default as e}from"./ofetch-CWQqZcqz.js";import"./cache-CvppK6AM.js";import{parseDate as t}from"./parse-date-DHsdom8D.js";import{ViewType as n}from"./types-Bi82qguM.js";import{fetchArticle as r}from"./utils-CYh0aYG1.js";import i from"p-map";const a={path:`/mobile/:path{.+}?`,categories:[`traditional-media`],example:`/apnews/mobile/ap-top-news`,view:n.Articles,parameters:{path:{description:`Corresponding path from AP News website`,default:`ap-top-news`}},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`apnews.com/`]}],name:`News (from mobile client API)`,maintainers:[`dzx-dzx`],handler:o};async function o(n){let a=n.req.param(`path`)?`/${n.req.param(`path`)}`:`/hub/ap-top-news`,o=`https://apnews.com/graphql/delivery/ap/v1`,s=await e(o,{query:{operationName:`ContentPageQuery`,variables:{path:a},extensions:{persistedQuery:{version:1,sha256Hash:`3bc305abbf62e9e632403a74cc86dc1cba51156d2313f09b3779efec51fc3acb`}}}}),c=s.data.Screen,l=[...c.main.filter(e=>e.__typename===`ColumnContainer`).flatMap(e=>e.columns),...c.main.filter(e=>e.__typename!==`ColumnContainer`)].filter(e=>e.__typename!==`GoogleDfPAdModule`).flatMap(e=>{switch(e.__typename){case`PageListModule`:return e.items;case`VideoPlaylistModule`:return e.playlist;default:return}}).filter(Boolean).map(e=>{if(e.__typename===`PagePromo`)return{title:e.title,link:e.url,pubDate:t(e.publishDateStamp),category:e.category,description:e.description,guid:e.id};if(e.__typename===`VideoPlaylistItem`)return{title:e.title,link:e.url,description:e.description,guid:e.contentId}}).filter(Boolean).sort((e,t)=>t.pubDate-e.pubDate).slice(0,n.req.query(`limit`)?Number.parseInt(n.req.query(`limit`),10):20),u=n.req.query(`fulltext`)===`true`?await i(l,e=>r(e),{concurrency:10}):l;return{title:c.category??c.title,item:u,link:`https://apnews.com`}}export{a as route};