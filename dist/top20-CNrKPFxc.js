import{__dirname as e,init_esm_shims as t}from"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CWQqZcqz.js";import"./helpers-RrXnNmv1.js";import{cache_default as n}from"./cache-CvppK6AM.js";import{art as r}from"./render-DE4LRFBD.js";import{parseDate as i,parseRelativeDate as a}from"./parse-date-DHsdom8D.js";import{got_default as o}from"./got-BwctkUCD.js";import s from"node:path";import{load as c}from"cheerio";t();const l=t=>r(s.join(e,`templates/description-4270576b.art`),{content:t});r.defaults.imports.parseContent=l;const u={path:`/top20`,categories:[`blog`],example:`/zhubai/top20`,parameters:{},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!1,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`analy.zhubai.love/`]}],name:`上周热门 TOP 20`,maintainers:[`nczitzk`],handler:d,url:`analy.zhubai.love/`};async function d(e){let t=e.req.query(`limit`)?Number.parseInt(e.req.query(`limit`)):20,r=`http://analy.zhubai.wiki`,s=`https://open.zhubai.wiki`,u=new URL(`a/zb/s/ht/pl/wk`,s).href,{data:d}=await o.post(u),f=d.data.slice(0,t).map(e=>({title:e.pn,link:e.pu??e.pq??e.fp,description:e.pa,author:e.zn,pubDate:a(e.lu.replace(/\.\d+/,``))}));f=await Promise.all(f.map(e=>n.tryGet(e.link,async()=>{let t=e.link.match(/\/(?:pl|pq|fp)\/([\w-]+)\/(\d+)/),{data:n}=await o(`https://${t[1]}.zhubai.love/api/posts/${t[2]}`);return e.title=n.title??e.title,e.description=n.content?l(JSON.parse(n.content)):e.description,e.author=n.author?.name??e.author,e.pubDate=n.created_at?i(n.created_at):e.pubDate,e})));let{data:p}=await o(r),m=c(p),h=m(`link[rel="apple-touch-icon"]`).prop(`href`);return{item:f,title:`${m(`meta[property="og:title"]`).prop(`content`)} - TOP20`,link:r,description:m(`meta[property="og:description"]`).prop(`content`),language:m(`html`).prop(`lang`),image:m(`meta[property="og:image"]`).prop(`content`),icon:h,logo:h,subtitle:m(`meta[property="og:description"]`).prop(`content`),author:m(`meta[name="twitter:site"]`).prop(`content`)}}export{u as route};