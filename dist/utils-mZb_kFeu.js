import{__dirname as e,init_esm_shims as t}from"./esm-shims-CtP6w_ML.js";import{config as n}from"./config-DYqAlsU3.js";import{cache_default as r}from"./cache-CvppK6AM.js";import{art as i}from"./render-DE4LRFBD.js";import{parseDate as a}from"./parse-date-DHsdom8D.js";import{got_default as o}from"./got-BwctkUCD.js";import{config_not_found_default as s}from"./config-not-found-QwO11ree.js";import c from"node:path";import{load as l}from"cheerio";t();const u=`jmcomic1.me`,d=new Set([`18comic.vip`,`18comic.org`,`jmcomic.me`,`jmcomic1.me`,`jm-comic3.art`,`jm-comic.club`,`jm-comic2.ark`]),f=e=>{if(!n.feature.allow_user_supply_unsafe_domain&&!d.has(e))throw new s(`This RSS is disabled unless 'ALLOW_USER_SUPPLY_UNSAFE_DOMAIN' is set to 'true'.`);return`https://${e}`},p=async(t,n,s)=>{n=n.replace(/\?$/,``);let u=await o(n),d=l(u.data),f=d(`.video-title`).slice(0,t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`)):20).toArray().map(e=>(e=d(e),{title:e.text().trim(),link:`${s}${e.prev().find(`a`).attr(`href`)}`,guid:`18comic:${e.prev().find(`a`).attr(`href`)}`}));return f=await Promise.all(f.map(t=>r.tryGet(t.guid,async()=>{let n=await o(t.link),r=l(n.data);return t.pubDate=a(r(`div[itemprop="datePublished"]`).first().attr(`content`)),t.updated=a(r(`div[itemprop="datePublished"]`).last().attr(`content`)),t.category=r(`span[data-type="tags"]`).first().find(`a`).toArray().map(e=>d(e).text()),t.author=r(`span[data-type="author"]`).first().find(`a`).toArray().map(e=>d(e).text()).join(`, `),t.description=i(c.join(e,`templates/description-afe7e434.art`),{introduction:r(`#intro-block .p-t-5`).text(),images:r(`.img_zoom_img img`).toArray().map(e=>r(e).attr(`data-original`)),cover:r(`.thumb-overlay img`).first().attr(`src`),category:t.category}),t}))),{title:d(`title`).text(),link:n,item:f,description:d(`meta[property="og:description"]`).attr(`content`),allowEmpty:!0}};export{p as ProcessItems,u as defaultDomain,f as getRootUrl};