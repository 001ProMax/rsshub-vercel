import"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CWQqZcqz.js";import"./helpers-RrXnNmv1.js";import{parseDate as e}from"./parse-date-DHsdom8D.js";import{got_default as t}from"./got-BwctkUCD.js";import{load as n}from"cheerio";import r from"lz-string";let i=``;const a=e=>{let t=100,n=0;return e(`h4`).toArray().map(r=>{let a=e(r).text();for(;!e(r.next).hasClass(`chapter-list`);)r=r.next;return r=r.next,e(r).children(`ul`).toArray().reverse().reduce((t,n)=>[...t,...e(n).children(`li`).toArray()],[]).map(r=>{let o=e(r).children(`a`),s=new Date(new Date(e.pubDate)-t++*1e3);return o.find(`em`).length>0&&(s=new Date(new Date(e.pubDate)-n++*1e3),e.newChapterCnt++),{link:new URL(o.attr(`href`),i).href,title:o.attr(`title`),pub_date:s,num:o.find(`i`).text(),category:a}})}).reduce((e,t)=>[...e,...t])},o={path:[`/comic/:id/:chapterCnt?`,`/:domain?/comic/:id/:chapterCnt?`],categories:[`anime`],example:`/manhuagui/comic/22942/5`,parameters:{id:`漫画ID`,chapterCnt:`返回章节的数量，默认为0，返回所有章节`},features:{requireConfig:!1,requirePuppeteer:!1,antiCrawler:!0,supportBT:!1,supportPodcast:!1,supportScihub:!1},radar:[{source:[`www.mhgui.com/comic/:id/`],target:`/comic/:id`}],name:`漫画更新`,maintainers:[`MegrezZhu`],handler:s};async function s(o){let{id:s,domain:c}=o.req.param();i=c===`mhgui`?`https://www.mhgui.com`:c===`twmanhuagui`?`https://tw.manhuagui.com`:`https://www.manhuagui.com`;let l=Number(o.req.param(`chapterCnt`)||0),{data:u}=await t(`${i}/comic/${s}/`),d=n(u);if(d(`#__VIEWSTATE`).length>0){let e=r.decompressFromBase64(d(`#__VIEWSTATE`).val());e&&(d(`#erroraudit_show`).replaceWith(e),d(`#__VIEWSTATE`).remove())}let f=d(`.book-title > h1`).text(),p=d(`#intro-all`).text(),m=d(`.book-cover img`).attr(`src`),h=/最近[于於].+更新至/;if(d(`.status > span`).text().indexOf(`已下架`)>0)return{title:`看漫画 - ${f} 已下架`,link:`${i}/comic/${s}/`,description:p,item:[{link:`${i}/comic/${s}/`,title:f,description:`已下架`}]};{let t=d(`.status > span`).text().match(h)[0].replace(/最近[于於] \[/,``).replace(`] 更新至`,``);d.pubDate=e(t),d.newChapterCnt=0;let n=a(d),r=e=>({link:e.link,title:e.title,pubDate:e.pub_date,category:e.category,description:`
            <h1>${e.num}</h1>
            <img src='${m}' />
        `.trim()}),o=n.map(e=>r(e)),c=o.length;return l>0&&(c=Math.max(l,d.newChapterCnt)),{title:`看漫画 - ${f}`,link:`${i}/comic/${s}/`,description:p,item:o.slice(0,c)}}}export{o as route};