import"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CWQqZcqz.js";import"./helpers-RrXnNmv1.js";import{cache_default as e}from"./cache-CvppK6AM.js";import{parseDate as t}from"./parse-date-DHsdom8D.js";import{got_default as n}from"./got-BwctkUCD.js";import{load as r}from"cheerio";const i={path:`/:id?/:type?/:keyword?`,radar:[{source:[`cool18.com/`]}],name:`Unknown`,maintainers:[`nczitzk`],handler:a,url:`cool18.com/`};async function a(i){let a=i.req.param(`id`)??`bbs4`,o=i.req.param(`type`)??``,s=i.req.param(`keyword`)??``,c=`https://www.cool18.com`,l=`${c}/${a}/index.php`,u=`${l}${s&&o?o===`gold`?`?app=forum&act=gold`:`?action=search&act=threadsearch&app=forum&${o}=${s}&submit=${o===`type`?`查询`:`栏目搜索`}`:``}`,d=await n({method:`get`,url:u}),f=r(d.data),p=f(`#d_list ul li, #thread_list li, .t_l .t_subject`).slice(0,i.req.query(`limit`)?Number.parseInt(i.req.query(`limit`)):20).toArray().map(e=>{e=f(e);let t=e.find(`a`).first();return{link:`${c}/${a}/${t.attr(`href`)}`}});return p=await Promise.all(p.map(i=>e.tryGet(i.link,async()=>{let e=await n({method:`get`,url:i.link}),a=r(e.data);return i.title=a(`title`).text().replace(` - cool18.com`,``),i.author=e.data.match(/送交者: .*>(.*)<.*\[/)[1],i.pubDate=t(e.data.match(/于 (.*) 已读/)[1]).toUTCString(),i.description=a(`pre`).html().replaceAll(/<font color="#E6E6DD">cool18.com<\/font>/g,``),i}))),{title:f(`title`).text(),link:u,item:p}}export{i as route};