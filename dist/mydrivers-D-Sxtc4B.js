import{__dirname as e,init_esm_shims as t}from"./esm-shims-CtP6w_ML.js";import"./config-DYqAlsU3.js";import"./logger-BlLSmUdl.js";import"./ofetch-CWQqZcqz.js";import"./helpers-RrXnNmv1.js";import{cache_default as n}from"./cache-CvppK6AM.js";import{art as r}from"./render-DE4LRFBD.js";import{parseDate as i}from"./parse-date-DHsdom8D.js";import{got_default as a}from"./got-BwctkUCD.js";import{timezone as o}from"./timezone-CCdTtC9I.js";import{categories as s,convertToQueryString as c,getInfo as l,processItems$8 as u,rootUrl$16 as d,title as f}from"./util-cQYLWM8Q.js";import p from"node:path";import{load as m}from"cheerio";t();const h={path:`/:category{.+}?`,name:`Unknown`,maintainers:[],handler:g};async function g(t){let{category:h=`new`}=t.req.param(),g=``;/^(\w+\/\w+)$/.test(h)||(g=`${f} - ${Object.hasOwn(s,h)?s[h]:s[Object.keys(s)[0]]}`,h=`ac/${h}`);let _=t.req.query(`limit`)?Number.parseInt(t.req.query(`limit`),10):20,v=c(h),y=new URL(`newsclass.aspx${v}`,d).href,b=new URL(`m/newslist.ashx${v}`,d).href,{data:x}=await a(b),S=m(x),C=S(`li[data-id]`).slice(0,_).toArray().map(t=>(t=S(t),{title:t.find(`div.news_title`).text(),link:new URL(t.find(`div.news_title span.newst a`).prop(`href`),d).href,description:r(p.join(e,`templates/description-8ef00cc6.art`),{image:t.find(`a.newsimg img`).prop(`src`)}),author:t.find(`p.tname`).text(),guid:t.prop(`data-id`),pubDate:o(i(t.find(`p.ttime`).text()),8),comments:t.find(`a.tpinglun`).text()?Number.parseInt(t.find(`a.tpinglun`).text(),10):0}));return C=await u(C,n.tryGet),{...await l(y,n.tryGet),...Object.fromEntries(Object.entries({item:C,title:g}).filter(([e])=>e))}}export{h as route};